{"mappings":"6PAAwCA,EAAKC,EAAKC,GAYhD,OAXID,KAAOD,EACTG,OAAOC,eAAeJ,EAAKC,EAAK,CAC9BC,MAAOA,EACPG,YAAY,EACZC,cAAc,EACdC,UAAU,IAGZP,EAAIC,GAAOC,EAGNF,aCV6BQ,GACpC,IAAK,IAAIC,EAAI,EAAGA,EAAIC,UAAUC,OAAQF,IAAK,CACzC,IAAIG,EAAyB,MAAhBF,UAAUD,GAAaC,UAAUD,GAAK,GAC/CI,EAAUV,OAAOW,KAAKF,GAEkB,mBAAjCT,OAAOY,wBAChBF,EAAUA,EAAQG,OAAOb,OAAOY,sBAAsBH,GAAQK,QAAO,SAAUC,GAC7E,OAAOf,OAAOgB,yBAAyBP,EAAQM,GAAKb,gBAIxDQ,EAAQO,SAAQ,SAAUnB,GACxBoB,EAAeb,EAAQP,EAAKW,EAAOX,OAIvC,OAAOO,aCdkCc,GACzC,gBCLyCA,GACzC,GAAIC,MAAMC,QAAQF,GAAM,CACtB,IAAK,IAAIb,EAAI,EAAGgB,EAAO,IAAIF,MAAMD,EAAIX,QAASF,EAAIa,EAAIX,OAAQF,IAC5DgB,EAAKhB,GAAKa,EAAIb,GAGhB,OAAOgB,GDDFC,CAAkBJ,aELcK,GACvC,GAAIC,OAAOC,YAAY1B,OAAOwB,IAAkD,uBAAzCxB,OAAO2B,UAAUC,SAASC,KAAKL,GAAgC,OAAOJ,MAAMU,KAAKN,GFIvFO,CAAgBZ,eGJjD,MAAM,IAAIa,UAAU,mDHIqCC,4upHIG3D,aAEA,IAAIC,GAAe,EAGfC,EAAQ,CACVC,WAAY,SAASC,GACnB,MAAoB,kBAATA,EACF,IAAIC,MAAM,yBAA2BD,EACxC,4BAENH,EAAeG,EACPA,EAAQ,8BACZ,+BAGNE,IAAK,WACH,GAAsB,iBAAXC,OAAqB,CAC9B,GAAIN,EACF,OAEqB,oBAAZO,SAAkD,mBAAhBA,QAAQF,KACnDE,QAAQF,IAAIG,MAAMD,QAASlC,aAajCoC,eAAgB,SAASC,EAAUC,EAAMC,GACvC,IAAIC,EAAQH,EAASG,MAAMF,GAC3B,OAAOE,GAASA,EAAMvC,QAAUsC,GAAOE,SAASD,EAAMD,GAAM,KAS9DG,cAAe,WAEb,IAAIC,EAAS,CACbA,QAAiB,KACjBA,QAAiB,MAGjB,GAAsB,oBAAXV,SAA2BA,OAAOW,UAE3C,OADAD,EAAOE,QAAU,iBACVF,EAIT,GAAIC,UAAUE,gBACZH,EAAOE,QAAU,UACjBF,EAAOI,QAAUC,KAAKZ,eAAeQ,UAAUK,UAAS,sBAC7B,QAGtB,GAAIL,UAAUM,mBAEnB,GAAIjB,OAAOkB,wBACTR,EAAOE,QAAU,SACjBF,EAAOI,QAAUC,KAAKZ,eAAeQ,UAAUK,UAAS,2BAC1B,OAgB9B,CAAA,IAAIL,UAAUK,UAAUT,MAAK,wBAS3B,OAFAG,EAAOE,QAAU,2EAEVF,EARPA,EAAOE,QAAU,SACjBF,EAAOI,QAAUC,KAAKZ,eAAeQ,UAAUK,UAAS,0BAC3B,OAW5B,CAAA,IAAIL,UAAUQ,eACjBR,UAAUK,UAAUT,MAAK,sBAQ3B,OADAG,EAAOE,QAAU,2BACVF,EAPPA,EAAOE,QAAU,OACjBF,EAAOI,QAAUC,KAAKZ,eAAeQ,UAAUK,UAAS,qBAC9B,GAQ5B,OAAON,IAKXU,EAAAC,QAAiB,CACftB,IAAKJ,EAAMI,IACXH,WAAYD,EAAMC,WAClB0B,eAAgB3B,EAAMc,gBACtBN,eAAgBR,EAAMQ,qDCxHxB,8BACIJ,iBACAuB,eAEAC,EAAa,CACfC,gBAAiB,WACfxB,OAAOyB,YAAczB,OAAOyB,aAAezB,OAAO0B,mBAGpDC,YAAa,WACW,iBAAX3B,QAAuBA,OAAO4B,qBAAuB,YAC5D5B,OAAO4B,kBAAkBzC,YAC3B3B,OAAOC,eAAeuC,OAAO4B,kBAAkBzC,UAAW,UAAW,CACnE0C,IAAK,WACH,OAAOd,KAAKe,UAEdC,IAAK,SAASC,GACZ,IAAIC,EAAOlB,KACPA,KAAKe,WACPf,KAAKmB,oBAAoB,QAASnB,KAAKe,UACvCf,KAAKmB,oBAAoB,YAAanB,KAAKoB,eAE7CpB,KAAKqB,iBAAiB,QAASrB,KAAKe,SAAWE,GAC/CjB,KAAKqB,iBAAiB,YAAarB,KAAKoB,aAAY,SAAYE,GAG9DA,EAAEC,OAAOF,iBAAiB,YAAY,SAASG,GAC7C,IAAIC,EAAQ,IAAIC,MAAM,SACtBD,EAAME,MAAQH,EAAGG,MACjBF,EAAMG,SAAW,CAACD,MAAOH,EAAGG,OAC5BF,EAAMI,QAAU,CAACP,EAAEC,QACnBL,EAAKY,cAAcL,MAErBH,EAAEC,OAAOQ,YAAYrE,QAAO,SAAUiE,GACpC,IAAIF,EAAQ,IAAIC,MAAM,SACtBD,EAAME,MAAQA,EACdF,EAAMG,SAAW,CAACD,MAAOA,GACzBF,EAAMI,QAAU,CAACP,EAAEC,QACnBvB,KAAK8B,cAAcL,IACnBO,KAAKhC,QACPgC,KAAKhC,WAMfiC,iBAAkB,WACM,iBAAXhD,QACLA,OAAOiD,oBACP,cAAejD,OAAOiD,iBAAiB9D,YAEzC3B,OAAOC,eAAeuC,OAAOiD,iBAAiB9D,UAAW,YAAa,CACpE0C,IAAK,WACH,OAAOd,KAAKmC,YAEdnB,IAAK,SAASO,GACZ,IAAIL,EAAOlB,KAEXA,KAAKmC,WAAaZ,EACdvB,KAAKoC,KACPC,IAAIC,gBAAgBtC,KAAKoC,KAGtBb,GAILvB,KAAKoC,IAAMC,IAAIE,gBAAgBhB,GAG/BA,EAAOF,iBAAiB,YAAY,WAC9BH,EAAKkB,KACPC,IAAIC,gBAAgBpB,EAAKkB,KAE3BlB,EAAKkB,IAAMC,IAAIE,gBAAgBhB,MAEjCA,EAAOF,iBAAiB,eAAe,WACjCH,EAAKkB,KACPC,IAAIC,gBAAgBpB,EAAKkB,KAE3BlB,EAAKkB,IAAMC,IAAIE,gBAAgBhB,OAhB/BvB,KAAKoC,IAAM,OAwBvBI,mBAAoB,WAElBvD,OAAO4B,kBAAoB,SAAS4B,EAAUC,KAGpC,kBACJD,GAAYA,EAASE,qBACvBF,EAASG,cAAgBH,EAASE,oBAGpC,IAAIE,EAAK,IAAI1C,wBAAwBsC,EAAUC,GAC3CI,EAAeD,EAAGE,SAASf,KAAKa,GAoEpC,OAnEAA,EAAGE,SAAW,SAASC,EAAUC,EAAiBC,GAChD,IAAIhC,EAAOlB,KACPmD,EAAOnG,UAIX,GAAIA,UAAUC,OAAS,GAAyB,mBAAb+F,EACjC,OAAOF,EAAaE,EAAUC,GAGhC,IAAIG,EAAkB,SAASC,GAC7B,IAAIC,EAAiB,GAcrB,OAbcD,EAAS1D,SACfjC,SAAQ,SAAS6F,GACvB,IAAIC,EAAgB,CAClBC,GAAIF,EAAOE,GACXC,UAAWH,EAAOG,UAClBC,KAAMJ,EAAOI,MAEfJ,EAAOK,QAAQlG,SAAQ,SAASmG,GAC9BL,EAAcK,GAAQN,EAAOO,KAAKD,MAEpCP,EAAeE,EAAcC,IAAMD,KAG9BF,GAILS,EAAe,SAASC,EAAOC,GACjC,IAAIC,EAAM,IAAIC,IAAI1H,OAAOW,KAAK4G,GAAOE,KAAI,SAAS3H,GAChD,MAAM,CAACA,EAAKyH,EAAMzH,QAMpB,OAJA0H,EAAcA,GAAeD,EAC7BvH,OAAOW,KAAK6G,GAAavG,SAAQ,SAASnB,GACxC2H,EAAI3H,GAAO0H,EAAY1H,MAElB2H,GAGT,GAAIlH,UAAUC,QAAU,EAAG,CACzB,IAAImH,EAA0B,SAASf,GACrCF,EAAK,GAAGY,EAAaX,EAAgBC,MAGvC,OAAOP,EAAa3D,MAAMa,KAAM,CAACoE,EAC7BpH,UAAU,KAIhB,OAAO,IAAIqH,SAAQ,SAASC,EAASC,GACf,IAAhBpB,EAAKlG,QAAoC,iBAAb+F,EAC9BF,EAAa3D,MAAM+B,EAAM,CACvB,SAASmC,GACPiB,EAAQP,EAAaX,EAAgBC,MACpCkB,IAGLzB,EAAa3D,MAAM+B,EAAM,CACvB,SAASmC,GACPiB,EAAQP,EAAaX,EAAgBC,GACjCA,EAAS1D,YACZ4E,OAENC,KAAKvB,EAAiBC,IAGpBL,GAET5D,OAAO4B,kBAAkBzC,UAAY+B,wBAAwB/B,UAGzD+B,wBAAwBsE,qBAC1BhI,OAAOC,eAAeuC,OAAO4B,kBAAmB,sBAAuB,CACrEC,IAAK,WACH,OAAOX,wBAAwBsE,uBAKrC,CAAC,cAAe,gBAAgB/G,SAAQ,SAASgH,GAC/C,IAAIC,EAAexE,wBAAwB/B,UAAUsG,GACrDvE,wBAAwB/B,UAAUsG,GAAU,WAC1C,IAAIxD,EAAOlB,KACX,GAAIhD,UAAUC,OAAS,GAA2B,IAArBD,UAAUC,QACX,iBAAjBD,UAAU,GAAkB,CACrC,IAAI4H,EAA4B,IAArB5H,UAAUC,OAAeD,UAAU,QAAK6H,EACnD,OAAO,IAAIR,SAAQ,SAASC,EAASC,GACnCI,EAAaxF,MAAM+B,EAAM,CAACoD,EAASC,EAAQK,OAG/C,OAAOD,EAAaxF,MAAMa,KAAMhD,eAKlC8H,EAAiB/E,QAAU,IAC3B,CAAC,sBAAuB,uBAAwB,mBAC3CrC,SAAQ,SAASgH,GAChB,IAAIC,EAAexE,wBAAwB/B,UAAUsG,GACrDvE,wBAAwB/B,UAAUsG,GAAU,WAC1C,IAAIvB,EAAOnG,UACPkE,EAAOlB,KACP+E,EAAU,IAAIV,SAAQ,SAASC,EAASC,GAC1CI,EAAaxF,MAAM+B,EAAM,CAACiC,EAAK,GAAImB,EAASC,OAE9C,OAAIpB,EAAKlG,OAAS,EACT8H,EAEFA,EAAQP,MAAK,WAClBrB,EAAK,GAAGhE,MAAM,KAAM,OAEtB,SAAS6F,GACH7B,EAAKlG,QAAU,GACjBkG,EAAK,GAAGhE,MAAM,KAAM,CAAC6F,WAQnC,CAAC,sBAAuB,uBAAwB,mBAC3CtH,SAAQ,SAASgH,GAChB,IAAIC,EAAexE,wBAAwB/B,UAAUsG,GACrDvE,wBAAwB/B,UAAUsG,GAAU,WAG1C,OAFA1H,UAAU,GAAK,IAAiB,oBAAX0H,EACjBO,gBAAkBC,uBAAuBlI,UAAU,IAChD2H,EAAaxF,MAAMa,KAAMhD,eAKxC,IAAImI,EACAtE,kBAAkBzC,UAAUgH,gBAChCvE,kBAAkBzC,UAAUgH,gBAAkB,WAC5C,OAAKpI,UAAU,GAMRmI,EAAsBhG,MAAMa,KAAMhD,YALnCA,UAAU,IACZA,UAAU,GAAGmC,MAAM,MAEdkF,QAAQC,cASvBjE,EAAAC,QAAiB,CACfG,gBAAiBD,EAAWC,gBAC5BG,YAAaJ,EAAWI,YACxBqB,iBAAkBzB,EAAWyB,iBAC7BO,mBAAoBhC,EAAWgC,mBAC/B6C,iBAAkBC,EAAA,+CC/PpB,8BACItG,IAGJqB,EAAAC,QAAiB,WACf,IAAIiF,EAAuB,SAASC,GAClC,GAAiB,iBAANA,GAAkBA,EAAEC,WAAaD,EAAEE,SAC5C,OAAOF,EAET,IAAIG,EAAK,GA4CT,OA3CAlJ,OAAOW,KAAKoI,GAAG9H,SAAQ,SAASnB,GAC9B,GAAY,YAARA,GAA6B,aAARA,GAA8B,gBAARA,EAA/C,CAGA,IAAIqJ,EAAuB,iBAAXJ,EAAEjJ,GAAqBiJ,EAAEjJ,GAAO,CAACsJ,MAAOL,EAAEjJ,SAC1CsI,IAAZe,EAAEE,OAA0C,iBAAZF,EAAEE,QACpCF,EAAEG,IAAMH,EAAEI,IAAMJ,EAAEE,OAEpB,IAAIG,EAAW,SAASC,EAAQrC,GAC9B,OAAIqC,EACKA,EAASrC,EAAKsC,OAAO,GAAGC,cAAgBvC,EAAKwC,MAAM,GAE3C,aAATxC,EAAuB,WAAaA,GAE9C,QAAgBgB,IAAZe,EAAEC,MAAqB,CACzBF,EAAGD,SAAWC,EAAGD,UAAY,GAC7B,IAAIY,EAAK,GACc,iBAAZV,EAAEC,OACXS,EAAGL,EAAS,MAAO1J,IAAQqJ,EAAEC,MAC7BF,EAAGD,SAASa,KAAKD,IACjBA,EAAK,IACFL,EAAS,MAAO1J,IAAQqJ,EAAEC,MAC7BF,EAAGD,SAASa,KAAKD,KAEjBA,EAAGL,EAAS,GAAI1J,IAAQqJ,EAAEC,MAC1BF,EAAGD,SAASa,KAAKD,SAGLzB,IAAZe,EAAEE,OAA0C,iBAAZF,EAAEE,OACpCH,EAAGF,UAAYE,EAAGF,WAAa,GAC/BE,EAAGF,UAAUQ,EAAS,GAAI1J,IAAQqJ,EAAEE,OAEpC,CAAC,MAAO,OAAOpI,SAAQ,SAAS8I,QACf3B,IAAXe,EAAEY,KACJb,EAAGF,UAAYE,EAAGF,WAAa,GAC/BE,EAAGF,UAAUQ,EAASO,EAAKjK,IAAQqJ,EAAEY,WAKzChB,EAAEiB,WACJd,EAAGD,UAAYC,EAAGD,UAAY,IAAIpI,OAAOkI,EAAEiB,WAEtCd,GAGLe,EAAmB,SAASC,EAAaC,GAK3C,IAJAD,EAAcE,KAAKC,MAAMD,KAAKE,UAAUJ,MACrBA,EAAYK,QAC7BL,EAAYK,MAAQzB,EAAqBoB,EAAYK,QAEnDL,GAA4C,iBAAtBA,EAAYM,MAAoB,CAExD,IAAIC,EAAOP,EAAYM,MAAME,WAG7B,IAFAD,EAAOA,IAA0B,iBAATA,EAAqBA,EAAO,CAACrB,MAAOqB,OAE/B,SAAfA,EAAKpB,OAAmC,gBAAfoB,EAAKpB,OACf,SAAfoB,EAAKrB,OAAmC,gBAAfqB,EAAKrB,UACtCjG,UAAUQ,aAAagH,0BACvBxH,UAAUQ,aAAagH,0BAA0BD,qBAC9CR,EAAYM,MAAME,WACN,gBAAfD,EAAKpB,OAA0C,gBAAfoB,EAAKrB,OAEvC,OAAOjG,UAAUQ,aAAaiH,mBAC7B7C,MAAK,SAAS8C,GAIb,IAAIC,GAHJD,EAAUA,EAAQ/J,QAAO,SAASiK,GAChC,MAAkB,eAAXA,EAAEC,SAEQC,MAAK,SAASF,GAC/B,OAAiD,IAA1CA,EAAEG,MAAMC,cAAcC,QAAQ,YAChCP,EAAQrK,QAAUqK,EAAQA,EAAQrK,OAAS,GAOlD,OANIsK,IACFZ,EAAYM,MAAMa,SAAWZ,EAAKpB,MAAQ,CAACA,MAAOyB,EAAKO,UACb,CAACjC,MAAO0B,EAAKO,WAEzDnB,EAAYM,MAAQ1B,EAAqBoB,EAAYM,SAC7C,WAAaJ,KAAKE,UAAUJ,IAC7BC,EAAKD,MAIlBA,EAAYM,MAAQ1B,EAAqBoB,EAAYM,OAGvD,SADQ,WAAaJ,KAAKE,UAAUJ,IAC7BC,EAAKD,IAGVoB,EAAa,SAASzG,GACxB,MAAO,CACLuC,KAAI,CACFmE,sBAAuB,kBACvBC,4BAA6B,wBAC7B3G,EAAEuC,OAASvC,EAAEuC,KACfqE,QAAS5G,EAAE4G,QACXC,WAAY7G,EAAE8G,eACd/J,SAAU,WACR,OAAO2B,KAAK6D,MAAQ7D,KAAKkI,SAAW,MAAQlI,KAAKkI,WAavDtI,UAAUyI,aARU,SAAS1B,EAAa2B,EAAWC,GACnD7B,EAAiBC,GAAa,SAASnB,GACrC5F,UAAUM,mBAAmBsF,EAAG8C,GAAW,SAAShH,GAClDiH,EAAQR,EAAWzG,WAQzB,IAAIkH,EAAuB,SAAS7B,GAClC,OAAO,IAAItC,SAAQ,SAASC,EAASC,GACnC3E,UAAUyI,aAAa1B,EAAarC,EAASC,OAyBjD,GArBK3E,UAAUQ,eACbR,UAAUQ,aAAe,CACvBiI,aAAcG,EACdnB,iBAAkB,WAChB,OAAO,IAAIhD,SAAQ,SAASC,GAC1B,IAAImE,EAAQ,CAACzB,MAAO,aAAcC,MAAO,cACzC,OAAOyB,iBAAiBC,YAAW,SAASrB,GAC1ChD,EAAQgD,EAAQpD,KAAI,SAAS0E,GAC3B,MAAO,CAACjB,MAAOiB,EAAOjB,MACdF,KAAMgB,EAAMG,EAAOnB,MACnBK,SAAUc,EAAOnF,GACjBoF,QAAS,iBAUxBjJ,UAAUQ,aAAaiI,aAIrB,CAIL,IAAIS,EAAmBlJ,UAAUQ,aAAaiI,aAC1CrG,KAAKpC,UAAUQ,cACnBR,UAAUQ,aAAaiI,aAAe,SAASU,GAC7C,OAAOrC,EAAiBqC,GAAI,SAASvD,GACnC,OAAOsD,EAAiBtD,GAAGhB,MAAK,SAASjD,GACvC,GAAIiE,EAAEwB,QAAUzF,EAAOyH,iBAAiB/L,QACpCuI,EAAEyB,QAAU1F,EAAO0H,iBAAiBhM,OAItC,MAHAsE,EAAOQ,YAAYrE,SAAQ,SAASiE,GAClCA,EAAMuH,UAEF,IAAIC,aAAa,GAAI,iBAE7B,OAAO5H,KACN,SAASD,GACV,OAAO+C,QAAQE,OAAOwD,EAAWzG,gBArBvC1B,UAAUQ,aAAaiI,aAAe,SAAS1B,GAC7C,OAAO6B,EAAqB7B,SA4BuB,IAA5C/G,UAAUQ,aAAaiB,mBAChCzB,UAAUQ,aAAaiB,iBAAmB,aAChC,sDAG8C,IAA/CzB,UAAUQ,aAAae,sBAChCvB,UAAUQ,aAAae,oBAAsB,aACnC,0FC1Ld,2CAGIZ,eAEA6I,EAAW,CACb5G,mBAAoB,WAClB,GAAIvD,OAAOoK,eAAgB,CAGpBpK,OAAOgG,kBACVhG,OAAOgG,gBAAkB,SAAS9B,GAChC,OAAOA,IAMNlE,OAAOiG,wBACVjG,OAAOiG,sBAAwB,SAAS/B,GACtC,OAAOA,IAKX,IAAImG,EAAiB7M,OAAOgB,yBACxBiL,iBAAiBtK,UAAW,WAChC3B,OAAOC,eAAegM,iBAAiBtK,UAAW,UAAW,CAC3D4C,IAAK,SAASxE,GACZ8M,EAAetI,IAAI1C,KAAK0B,KAAMxD,GAC9B,IAAI+M,EAAK,IAAI7H,MAAM,WACnB6H,EAAGC,QAAUhN,EACbwD,KAAK8B,cAAcyH,MAKzBtK,OAAO4B,kBAAoB,SAAS4I,GAClC,IAAIvI,EAAOlB,KAEP0J,EAAeC,SAASC,yBAwC5B,GAvCA,CAAC,mBAAoB,sBAAuB,iBACvClM,SAAQ,SAASgH,GAChBxD,EAAKwD,GAAUgF,EAAahF,GAAQ1C,KAAK0H,MAG/C1J,KAAK6J,eAAiB,KACtB7J,KAAK8J,YAAc,KACnB9J,KAAK+J,QAAU,KACf/J,KAAKgK,eAAiB,KACtBhK,KAAKiK,uBAAyB,KAC9BjK,KAAKkK,2BAA6B,KAClClK,KAAKmK,oBAAsB,KAC3BnK,KAAKoK,cAAgB,KAErBpK,KAAKqK,aAAe,GACpBrK,KAAKsK,cAAgB,GACrBtK,KAAKuK,gBAAkB,WACrB,OAAOrJ,EAAKmJ,cAEdrK,KAAKwK,iBAAmB,WACtB,OAAOtJ,EAAKoJ,eAGdtK,KAAKyK,iBAAmB,IAAIvF,sBAAsB,CAChDvB,KAAM,GACN+G,IAAK,KAEP1K,KAAK2K,kBAAoB,IAAIzF,sBAAsB,CACjDvB,KAAM,GACN+G,IAAK,KAEP1K,KAAK4K,eAAiB,SACtB5K,KAAK6K,mBAAqB,MAC1B7K,KAAK8K,kBAAoB,MAEzB9K,KAAK+K,WAAa,CAChBC,aAAc,MACdC,WAAY,IAEVxB,GAAUA,EAAO9G,mBACnB,OAAQ8G,EAAO9G,oBACb,IAAK,MACL,IAAK,QACH3C,KAAK+K,WAAWC,aAAevB,EAAO9G,mBACtC,MACF,IAAK,OAEH,MAAM,IAAIlE,UAAU,2CAQ1B,GAFAuB,KAAKkL,YAAczB,GAAkC,eAAxBA,EAAO0B,aAEhC1B,GAAUA,EAAOwB,WAAY,CAK/B,IAAIA,EAAapE,KAAKC,MAAMD,KAAKE,UAAU0C,EAAOwB,aAClDjL,KAAK+K,WAAWE,WAAaA,EAAW1N,QAAO,SAAS6N,GACtD,GAAIA,GAAUA,EAAOC,KAAM,CACzB,IAAIA,EAAOD,EAAOC,KAWlB,MAVoB,iBAATA,IACTA,EAAO,CAACA,OAEVA,EAAOA,EAAK9N,QAAO,SAAS+N,GAC1B,OAAiC,IAAzBA,EAAIzD,QAAQ,WACiB,IAAjCyD,EAAIzD,QAAQ,mBACc,IAA1ByD,EAAIzD,QAAQ,WACc,IAAzByD,EAAIzD,QAAQ,UAAc0D,EACVxL,SAAW,SAC/B,IAGL,OAAO,KAGXC,KAAKwL,QAAU/B,EAIfzJ,KAAKyL,aAAe,GAKpBzL,KAAK0L,0BAA4B,IAGnCzM,OAAO4B,kBAAkBzC,UAAUuN,wBAA0B,WAC3D,IAAIzK,EAAOlB,KACP4L,EAAWC,EAAAC,cAAuB5K,EAAKuJ,iBAAiBC,KAG5D1K,KAAK0L,0BAA0BhO,SAAQ,SAAS+D,GAE9C,IADWA,EAAMsK,WAAqD,IAAxCtP,OAAOW,KAAKqE,EAAMsK,WAAW9O,OAEzD,IAAK,IAAI+O,EAAI,EAAGA,EAAIJ,EAAS3O,OAAQ+O,KACwB,IAAvDJ,EAASI,GAAGnE,QAAQ,iCACtB+D,EAASI,IAAM,gCAIb,IADGvK,EAAMsK,UAAUA,UAAUlE,QAAQ,yBAE3C+D,EAASnK,EAAMsK,UAAUE,cAAgB,IACrC,KAAOxK,EAAMsK,UAAUA,UAAY,SAEzC7K,EAAKuJ,iBAAiBC,IAAMkB,EAASM,KAAK,IAC1ChL,EAAKY,cAAcL,GACS,OAAxBP,EAAK2I,gBACP3I,EAAK2I,eAAepI,GAEjBA,EAAMsK,WAAwC,aAA3B7K,EAAK4J,oBACZ5J,EAAKuK,aAAaU,OAAM,SAASC,GAC9C,OAAOA,EAAYC,aACmB,cAAlCD,EAAYC,YAAYC,WAG5BpL,EAAK4J,kBAAoB,eAI/B9K,KAAK0L,0BAA4B,IAGnCzM,OAAO4B,kBAAkBzC,UAAUmO,iBAAmB,WACpD,OAAOvM,KAAKwL,SAGdvM,OAAO4B,kBAAkBzC,UAAUoO,UAAY,SAASjL,GAGtD,IAAIkL,EAAelL,EAAOmL,QAC1BnL,EAAOQ,YAAYrE,SAAQ,SAASiE,EAAOgL,GACzC,IAAIC,EAAcH,EAAa1K,YAAY4K,GAC3ChL,EAAMN,iBAAiB,WAAW,SAASI,GACzCmL,EAAYpD,QAAU/H,EAAM+H,cAGhCxJ,KAAKqK,aAAa9D,KAAKkG,GACvBzM,KAAK6M,+BAGP5N,OAAO4B,kBAAkBzC,UAAU0O,aAAe,SAASvL,GACzD,IAAIoL,EAAM3M,KAAKqK,aAAaxC,QAAQtG,GAChCoL,GAAM,IACR3M,KAAKqK,aAAa0C,OAAOJ,EAAK,GAC9B3M,KAAK6M,gCAIT5N,OAAO4B,kBAAkBzC,UAAU4O,WAAa,WAC9C,OAAOhN,KAAKyL,aAAalO,QAAO,SAAS6O,GACvC,QAASA,EAAYa,aAEtB/I,KAAI,SAASkI,GACZ,OAAOA,EAAYa,cAIvBhO,OAAO4B,kBAAkBzC,UAAU8O,aAAe,WAChD,OAAOlN,KAAKyL,aAAalO,QAAO,SAAS6O,GACvC,QAASA,EAAYe,eAEtBjJ,KAAI,SAASkI,GACZ,OAAOA,EAAYe,gBAKvBlO,OAAO4B,kBAAkBzC,UAAUgP,uBAC/B,SAASC,EAAmBC,GAC1B,IAAIC,EAAqB,CACvBC,OAAQ,GACRC,iBAAkB,GAClBC,cAAe,IA2CjB,OAzCAL,EAAkBG,OAAO9P,SAAQ,SAASiQ,GACxC,IAAK,IAAI5Q,EAAI,EAAGA,EAAIuQ,EAAmBE,OAAOvQ,OAAQF,IAAK,CACzD,IAAI6Q,EAASN,EAAmBE,OAAOzQ,GACvC,GAAI4Q,EAAO9J,KAAK+D,gBAAkBgG,EAAO/J,KAAK+D,eAC1C+F,EAAOE,YAAcD,EAAOC,UAAW,CAEzCD,EAAOE,YAAcC,KAAKhI,IAAI4H,EAAOG,YACjCF,EAAOE,aAEXP,EAAmBC,OAAOjH,KAAKqH,GAG/BA,EAAOI,aAAeJ,EAAOI,aAAazQ,QAAO,SAAS0Q,GACxD,IAAK,IAAIjC,EAAI,EAAGA,EAAI2B,EAAOK,aAAa/Q,OAAQ+O,IAC9C,GAAI2B,EAAOK,aAAahC,GAAGrI,OAASsK,EAAGtK,MACnCgK,EAAOK,aAAahC,GAAGkC,YAAcD,EAAGC,UAC1C,OAAO,EAGX,OAAO,KAIT,WAKNb,EAAkBI,iBACb/P,SAAQ,SAASyQ,GAChB,IAAK,IAAIpR,EAAI,EAAGA,EAAIuQ,EAAmBG,iBAAiBxQ,OACnDF,IAAK,CACR,IAAIqR,EAAmBd,EAAmBG,iBAAiB1Q,GAC3D,GAAIoR,EAAiBE,MAAQD,EAAiBC,IAAK,CACjDd,EAAmBE,iBAAiBlH,KAAK6H,GACzC,WAMHb,GAIbtO,OAAO4B,kBAAkBzC,UAAUkQ,4BAC/B,SAASC,EAAKtC,GACZ,IAAI/K,EAAOlB,KACPqM,EAAc,IAAIhD,eAAenI,EAAK6J,YACtCyD,EAAe,IAAIC,gBAAgBpC,GACvCA,EAAYqC,iBAAmB,SAASC,GACtC,IAAIlN,EAAQ,IAAIC,MAAM,gBACtBD,EAAMsK,UAAY,CAAC6C,OAAQL,EAAKtC,cAAeA,GAE/C,IAAI4C,EAAOF,EAAI5C,UACX+C,GAAOD,GAAqC,IAA7BpS,OAAOW,KAAKyR,GAAM5R,OAEjC6R,QAGwBjK,IAAtBwH,EAAYC,QACdD,EAAYC,MAAQ,aAQtB7K,EAAMsK,UAAUA,UACZ,sDAGJ8C,EAAKE,UAAuC,SAA3BP,EAAaO,UAAuB,EAAI,EACzDtN,EAAMsK,UAAUA,UAAYF,EAAAmD,eAAwBH,IAItD,IAAIjD,EAAWC,EAAAC,cAAuB5K,EAAKuJ,iBAAiBC,MAEpD,IADJjJ,EAAMsK,UAAUA,UAAUlE,QAAQ,uBAEpC+D,EAASnK,EAAMsK,UAAUE,cAAgB,IACrC,KAAOxK,EAAMsK,UAAUA,UAAY,OAEvCH,EAASnK,EAAMsK,UAAUE,cAAgB,IACrC,0BAEN/K,EAAKuJ,iBAAiBC,IAAMkB,EAASM,KAAK,IAE1C,IAAI+C,EAAW/N,EAAKuK,aAAaU,OAAM,SAASC,GAC9C,OAAOA,EAAYC,aACmB,cAAlCD,EAAYC,YAAYC,SAK9B,OAAQpL,EAAK4J,mBACX,IAAK,MACH5J,EAAKwK,0BAA0BnF,KAAK9E,GAChCqN,GAAOG,GACT/N,EAAKwK,0BAA0BnF,KAC3B,IAAI7E,MAAM,iBAEhB,MACF,IAAK,YACHR,EAAKyK,0BACLzK,EAAKY,cAAcL,GACS,OAAxBP,EAAK2I,gBACP3I,EAAK2I,eAAepI,GAElBwN,IACF/N,EAAKY,cAAc,IAAIJ,MAAM,iBACD,OAAxBR,EAAK2I,gBACP3I,EAAK2I,eAAe,IAAInI,MAAM,iBAEhCR,EAAK4J,kBAAoB,cAUjC0D,EAAaU,iBAAmB,WAC9BhO,EAAKiO,0BAGP,IAAIC,EAAgB,IAAIC,iBAAiBb,GAUzC,OATAY,EAAcE,kBAAoB,WAChCpO,EAAKiO,0BAEPC,EAAcG,QAAU,WAEtBH,EAAc9C,MAAQ,SACtBpL,EAAKiO,0BAGA,CACL9C,YAAaA,EACbmC,aAAcA,EACdY,cAAeA,IAKvBnQ,OAAO4B,kBAAkBzC,UAAUoR,YAAc,SAASpD,EACtDqD,EAAMC,GACR,IAAIC,EAAS3P,KAAKoN,uBAAuBhB,EAAYiB,kBACjDjB,EAAYkB,oBACZmC,GAAQrD,EAAYa,YACtB0C,EAAOC,UAAYxD,EAAYyD,uBAC/BF,EAAOG,KAAO,CACZC,MAAOlE,EAAAmE,YAEL5D,EAAY6D,uBAAuBhT,SACrC0S,EAAOG,KAAKI,KAAO9D,EAAY6D,uBAAuB,GAAGC,MAE3D9D,EAAYa,UAAUwC,KAAKE,IAEzBD,GAAQtD,EAAYe,cAEG,UAArBf,EAAY3E,MACT2E,EAAY6D,wBACjB7D,EAAY6D,uBAAuBvS,SAAQ,SAASyS,UAC3CA,EAAEC,OAGbT,EAAOC,UAAYxD,EAAY6D,uBAC/BN,EAAOG,KAAO,CACZC,MAAO3D,EAAY2D,OAEjB3D,EAAYyD,uBAAuB5S,SACrC0S,EAAOG,KAAKI,KAAO9D,EAAYyD,uBAAuB,GAAGK,MAE3D9D,EAAYe,YAAYkD,QAAQV,KAIpC1Q,OAAO4B,kBAAkBzC,UAAUkS,oBAC/B,SAASC,GACP,IACI3E,EACA4E,EAFAtP,EAAOlB,KAGX,GAAyB,UAArBuQ,EAAY5M,KAIV3D,KAAKyQ,gBAGP7E,EAAWC,EAAAC,cAAuByE,EAAY7F,KAC9C8F,EAAc5E,EAAS8E,QACvB9E,EAASlO,SAAQ,SAASiT,EAAc1E,GACtC,IAAI2E,EAAO/E,EAAAgF,mBAA4BF,GACvCzP,EAAKuP,cAAcxE,GAAeoB,kBAAoBuD,KAExD5Q,KAAKyL,aAAezL,KAAKyQ,qBAClBzQ,KAAKyQ,oBAET,GAAyB,WAArBF,EAAY5M,KAAmB,CACxCiI,EAAWC,EAAAC,cAAuB5K,EAAKyJ,kBAAkBD,KACzD8F,EAAc5E,EAAS8E,QACvB,IAAII,EAAYjF,EAAAkF,YAAqBP,EACjC,cAAcvT,OAAS,EAC3B2O,EAASlO,SAAQ,SAASiT,EAAc1E,GACtC,IAAIG,EAAclL,EAAKuK,aAAaQ,GAChCI,EAAcD,EAAYC,YAC1BmC,EAAepC,EAAYoC,aAC3BY,EAAgBhD,EAAYgD,cAC5B/B,EAAoBjB,EAAYiB,kBAChCC,EAAqBlB,EAAYkB,mBAKrC,KAF0B,MADXqD,EAAaK,MAAM,KAAM,GAAG,GACtCA,MAAM,IAAK,GAAG,MAED5E,EAAY6E,cAAe,CAC3C,IAAIC,EAAsBrF,EAAAsF,iBACtBR,EAAcH,GAClB,GAAIM,EAAW,CACb,IAAIM,EAAQvF,EAAAkF,YAAqBJ,EAAc,gBAC9CzM,KAAI,SAAS2K,GACZ,OAAOhD,EAAAwF,eAAwBxC,MAEhCtR,QAAO,SAASsR,GACf,MAA0B,MAAnBA,EAAKE,aAKVqC,EAAMnU,QACRuR,EAAa8C,oBAAoBF,GAGrC,IAAIG,EAAuB1F,EAAA2F,kBACvBb,EAAcH,GACdM,IACFS,EAAqBE,KAAO,UAGzBvQ,EAAKgK,aAAiC,IAAlBe,IACvBuC,EAAakD,MAAMrF,EAAa6E,EAC5BJ,EAAY,cAAgB,cAChC1B,EAAcsC,MAAMH,IAItB,IAAI5B,EAASzO,EAAKkM,uBAAuBC,EACrCC,GAIJpM,EAAKsO,YAAYpD,EACbuD,EAAOnC,OAAOvQ,OAAS,GACvB,OASV,OAJA+C,KAAKyK,iBAAmB,CACtB9G,KAAM4M,EAAY5M,KAClB+G,IAAK6F,EAAY7F,KAEX6F,EAAY5M,MAClB,IAAK,QACH3D,KAAK2R,sBAAsB,oBAC3B,MACF,IAAK,SACH3R,KAAK2R,sBAAsB,UAC3B,cAEA,MAAM,IAAIlT,UAAU,qBAAuB8R,EAAY5M,KACnD,KAMR,IAAIiO,EAAc5U,UAAUC,OAAS,GACX,mBAAjBD,UAAU,GACnB,GAAI4U,EAAa,CACf,IAAIC,EAAK7U,UAAU,GACnBiC,OAAO6S,YAAW,WAChBD,IAC+B,QAA3B3Q,EAAK4J,oBACP5J,EAAK4J,kBAAoB,aAE3B5J,EAAKyK,4BACJ,GAEL,IAAIwE,EAAI9L,QAAQC,UAUhB,OATA6L,EAAE3L,MAAK,WACAoN,IAC4B,QAA3B1Q,EAAK4J,oBACP5J,EAAK4J,kBAAoB,aAG3B7L,OAAO6S,WAAW5Q,EAAKyK,wBAAwB3J,KAAKd,GAAO,SAGxDiP,GAGblR,OAAO4B,kBAAkBzC,UAAU2T,qBAC/B,SAASxB,GACP,IAAIrP,EAAOlB,KACPuB,EAAS,IAAIb,YACbsR,EAAe,GACfpG,EAAWC,EAAAC,cAAuByE,EAAY7F,KAC9C8F,EAAc5E,EAAS8E,QACvBI,EAAYjF,EAAAkF,YAAqBP,EACjC,cAAcvT,OAAS,EAyL3B,OAxLA+C,KAAKkL,YAAcW,EAAAkF,YAAqBP,EACpC,mBAAmBvT,OAAS,EAChC2O,EAASlO,SAAQ,SAASiT,EAAc1E,GACtC,IACIgG,EADQpG,EAAAqG,WAAoBvB,GACd,GAAGwB,OAAO,GAAGnB,MAAM,KACjCvJ,EAAOwK,EAAM,GACbG,EAAwB,MAAbH,EAAM,GACjBI,EAAYxG,EAAAyG,aAAsB3B,EAAcH,GAEhDjC,EAAM1C,EAAAkF,YAAqBJ,EAAc,UAQ7C,GANEpC,EADEA,EAAItR,OACAsR,EAAI,GAAG4D,OAAO,GAEdtG,EAAA0G,qBAIK,gBAAT9K,GAAuC,cAAbwK,EAAM,GAApC,CAQA,IAAI7F,EACAC,EACAmC,EACAY,EACAnC,EACAE,EACA0C,EACAI,EACA5C,EAEA1L,EAGAuP,EACAK,EAWAxB,EAbAzC,EAAqBzB,EAAAgF,mBAA4BF,GAGhDyB,IACHlB,EAAsBrF,EAAAsF,iBAA0BR,EAC5CH,IACJe,EAAuB1F,EAAA2F,kBAA2Bb,EAC9CH,IACiBiB,KAAO,UAE9BxB,EACIpE,EAAA2G,2BAAoC7B,GAKxC,IAAI8B,EAAa5G,EAAAkF,YAAqBJ,EAAc,WAC/CzM,KAAI,SAASwO,GACZ,OAAO7G,EAAA8G,eAAwBD,MAEhCnV,QAAO,SAASjB,GACf,MAAyB,UAAlBA,EAAIsW,aACV,GACHH,IACF1C,EAAQ0C,EAAWjW,OAGrB,IAAIqW,EAAahH,EAAAkF,YAAqBJ,EAClC,sBAAuBH,GAAavT,OAAS,EAC7CmU,EAAQvF,EAAAkF,YAAqBJ,EAAc,gBAC1CzM,KAAI,SAAS2K,GACZ,OAAOhD,EAAAwF,eAAwBxC,MAEhCtR,QAAO,SAASsR,GACf,MAA0B,MAAnBA,EAAKE,aAElB,GAAyB,UAArBwB,EAAY5M,MAAqByO,EAkEL,WAArB7B,EAAY5M,MAAsByO,IAE3C/F,GADAD,EAAclL,EAAKuK,aAAaQ,IACNI,YAC1BmC,EAAepC,EAAYoC,aAC3BY,EAAgBhD,EAAYgD,cAC5BnC,EAAYb,EAAYa,UACxBE,EAAcf,EAAYe,YAC1B0C,EAAyBzD,EAAYyD,uBACrCxC,EAAoBjB,EAAYiB,kBAEhCnM,EAAKuK,aAAaQ,GAAegE,uBAC7BA,EACJ/O,EAAKuK,aAAaQ,GAAeqB,mBAC7BA,EACJpM,EAAKuK,aAAaQ,GAAe8D,MAAQA,GAEpCe,GAAa+B,IAAezB,EAAMnU,QACrCuR,EAAa8C,oBAAoBF,GAE9BlQ,EAAKgK,aAAiC,IAAlBe,IACvBuC,EAAakD,MAAMrF,EAAa6E,EAC5B,eACJ9B,EAAcsC,MAAMH,IAGtBrQ,EAAKsO,YAAYpD,EACC,aAAdiG,GAA0C,aAAdA,EACd,aAAdA,GAA0C,aAAdA,IAE5BlF,GACe,aAAdkF,GAA0C,aAAdA,SAMxBjG,EAAYe,aALnBxL,EAAQwL,EAAYxL,MACpBqQ,EAAazL,KAAK,CAAC5E,EAAOwL,IAC1B5L,EAAOuR,SAASnR,SAnG2B,CAC7C,IAkCMoR,EAlCFC,EAAa9R,EAAKgK,aAAee,EAAgB,EAAI,CACvDI,YAAanL,EAAKuK,aAAa,GAAGY,YAClCmC,aAActN,EAAKuK,aAAa,GAAG+C,aACnCY,cAAelO,EAAKuK,aAAa,GAAG2D,eAClClO,EAAKoN,4BAA4BC,EAAKtC,GA4B1C,GA1BI4G,GACFG,EAAWxE,aAAa8C,oBAAoBF,IAG9C/D,EAAoB4F,eAAeC,gBAAgBzL,IAIjC+F,OAASH,EAAkBG,OAAOjQ,QAChD,SAAS4V,GACP,MAAsB,QAAfA,EAAMtP,QAGnBgM,EAAyB,CAAC,CACxBK,KAAgC,MAAzB,EAAIjE,EAAgB,KAK7BtK,GAFAwL,EAAc,IAAI8F,eAAeD,EAAW5D,cAAe3H,IAEvC9F,MACpBqQ,EAAazL,KAAK,CAAC5E,EAAOwL,IAG1B5L,EAAOuR,SAASnR,GAGZT,EAAKmJ,aAAapN,OAAS,GAC3BiE,EAAKmJ,aAAa,GAAGtI,YAAY9E,QAAUgP,EAEhC,UAATxE,EACFsL,EAAa7R,EAAKmJ,aAAa,GAAGrB,iBAAiB,GACjC,UAATvB,IACTsL,EAAa7R,EAAKmJ,aAAa,GAAGpB,iBAAiB,IAEjD8J,IACF9F,EAAY,IAAImG,aAAaL,EACzBC,EAAW5D,gBAInBlO,EAAKuK,aAAaQ,GAAiB,CACjCI,YAAa2G,EAAW3G,YACxBmC,aAAcwE,EAAWxE,aACzBY,cAAe4D,EAAW5D,cAC1B/B,kBAAmBA,EACnBC,mBAAoBA,EACpBL,UAAWA,EACXE,YAAaA,EACb1F,KAAMA,EACN8G,IAAKA,EACLwB,MAAOA,EACPF,uBAAwBA,EACxBI,uBAAwBA,GAI1B/O,EAAKsO,YAAYtO,EAAKuK,aAAaQ,IAC/B,EACc,aAAdoG,GAA0C,aAAdA,SAxHhCnR,EAAKuK,aAAaQ,GAAiB,CACjCsC,IAAKA,EACL0C,eAAe,MAgKrBjR,KAAK2K,kBAAoB,CACvBhH,KAAM4M,EAAY5M,KAClB+G,IAAK6F,EAAY7F,KAEX6F,EAAY5M,MAClB,IAAK,QACH3D,KAAK2R,sBAAsB,qBAC3B,MACF,IAAK,SACH3R,KAAK2R,sBAAsB,UAC3B,cAEA,MAAM,IAAIlT,UAAU,qBAAuB8R,EAAY5M,KACnD,KAiCR,OA/BIpC,EAAOQ,YAAY9E,SACrBiE,EAAKoJ,cAAc/D,KAAKhF,GACxBtC,OAAO6S,YAAW,WAChB,IAAIrQ,EAAQ,IAAIC,MAAM,aACtBD,EAAMF,OAASA,EACfL,EAAKY,cAAcL,GACM,OAArBP,EAAK4I,aACP7K,OAAO6S,YAAW,WAChB5Q,EAAK4I,YAAYrI,KAChB,GAGLuQ,EAAatU,SAAQ,SAAS2V,GAC5B,IAAI1R,EAAQ0R,EAAK,GACbzR,EAAWyR,EAAK,GAChBC,EAAa,IAAI5R,MAAM,SAC3B4R,EAAW3R,MAAQA,EACnB2R,EAAW1R,SAAWA,EACtB0R,EAAWzR,QAAU,CAACN,GACtBL,EAAKY,cAAcL,GACE,OAAjBP,EAAK6I,SACP9K,OAAO6S,YAAW,WAChB5Q,EAAK6I,QAAQuJ,KACZ,QAGN,IAEDtW,UAAUC,OAAS,GAA6B,mBAAjBD,UAAU,IAC3CiC,OAAO6S,WAAW9U,UAAU,GAAI,GAE3BqH,QAAQC,WAGrBrF,OAAO4B,kBAAkBzC,UAAUmV,MAAQ,WACzCvT,KAAKyL,aAAa/N,SAAQ,SAAS0O,GAM7BA,EAAYoC,cACdpC,EAAYoC,aAAatF,OAEvBkD,EAAYgD,eACdhD,EAAYgD,cAAclG,OAExBkD,EAAYa,WACdb,EAAYa,UAAU/D,OAEpBkD,EAAYe,aACdf,EAAYe,YAAYjE,UAI5BlJ,KAAK2R,sBAAsB,WAI7B1S,OAAO4B,kBAAkBzC,UAAUuT,sBAC/B,SAAS6B,GACPxT,KAAK4K,eAAiB4I,EACtB,IAAI/R,EAAQ,IAAIC,MAAM,wBACtB1B,KAAK8B,cAAcL,GACiB,OAAhCzB,KAAKiK,wBACPjK,KAAKiK,uBAAuBxI,IAKpCxC,OAAO4B,kBAAkBzC,UAAUyO,4BAC/B,WAEE,IAAIpL,EAAQ,IAAIC,MAAM,qBACtB1B,KAAK8B,cAAcL,GACc,OAA7BzB,KAAKmK,qBACPnK,KAAKmK,oBAAoB1I,IAKjCxC,OAAO4B,kBAAkBzC,UAAU+Q,uBAAyB,WAC1D,IACIqE,EACAC,EAAS,CACXC,IAAO,EACPC,OAAQ,EACRC,WAAY,EACZC,SAAU,EACVC,UAAW,EACXC,UAAW,EACXC,OAAQ,GAsBV,GApBAhU,KAAKyL,aAAa/N,SAAQ,SAAS0O,GACjCqH,EAAOrH,EAAYoC,aAAalC,SAChCmH,EAAOrH,EAAYgD,cAAc9C,YAGnCmH,EAAOK,WAAaL,EAAOM,UAE3BP,EAAW,MACPC,EAAOO,OAAS,EAClBR,EAAW,SACFC,EAAOG,WAAa,GAAKH,EAAOI,SAAW,EACpDL,EAAW,aACFC,EAAOQ,aAAe,EAC/BT,EAAW,eACFC,EAAOC,IAAM,EACtBF,EAAW,OACFC,EAAOK,UAAY,GAAKL,EAAOM,UAAY,KACpDP,EAAW,aAGTA,IA/BOxT,KA+BW6K,mBAAoB,CA/B/B7K,KAgCJ6K,mBAAqB2I,EAC1B,IAAI/R,EAAQ,IAAIC,MAAM,4BACtB1B,KAAK8B,cAAcL,GACqB,OAApCzB,KAAKkK,4BACPlK,KAAKkK,2BAA2BzI,KAKtCxC,OAAO4B,kBAAkBzC,UAAU8V,YAAc,WAC/C,IAIIC,EAJAjT,EAAOlB,KACX,GAAIA,KAAKyQ,cACP,MAAM,IAAI1R,MAAM,sDAGO,IAArB/B,UAAUC,QAAwC,mBAAjBD,UAAU,GAC7CmX,EAAenX,UAAU,GACK,IAArBA,UAAUC,SACnBkX,EAAenX,UAAU,IAG3B,IAAIoX,EAAS,GACTC,EAAiB,EACjBC,EAAiB,EAOrB,GALItU,KAAKqK,aAAapN,SACpBoX,EAAiBrU,KAAKqK,aAAa,GAAGrB,iBAAiB/L,OACvDqX,EAAiBtU,KAAKqK,aAAa,GAAGpB,iBAAiBhM,QAGrDkX,EAAc,CAEhB,GAAIA,EAAa1O,WAAa0O,EAAazO,SACzC,MAAM,IAAIjH,UACN,6DAEmCoG,IAArCsP,EAAaI,sBACfF,EAAiBF,EAAaI,0BAES1P,IAArCsP,EAAaK,sBACfF,EAAiBH,EAAaK,yBAG9BxU,KAAKqK,aAAapN,QAEpB+C,KAAKqK,aAAa,GAAGtI,YAAYrE,SAAQ,SAASiE,GAChDyS,EAAO7N,KAAK,CACVkB,KAAM9F,EAAM8F,KACZ9F,MAAOA,EACP8S,YAA4B,UAAf9S,EAAM8F,KACf4M,EAAiB,EAAIC,EAAiB,IAEzB,UAAf3S,EAAM8F,KACR4M,IACwB,UAAf1S,EAAM8F,MACf6M,OAKCD,EAAiB,GAAKC,EAAiB,GACxCD,EAAiB,IACnBD,EAAO7N,KAAK,CACVkB,KAAM,QACNgN,aAAa,IAEfJ,KAEEC,EAAiB,IACnBF,EAAO7N,KAAK,CACVkB,KAAM,QACNgN,aAAa,IAEfH,KAIJ,IAAI5J,EAAMmB,EAAA6I,0BACNjJ,EAAe,GACnB2I,EAAO1W,SAAQ,SAASuU,EAAOhG,GAG7B,IA0BIgB,EACAE,EA3BAxL,EAAQsQ,EAAMtQ,MACd8F,EAAOwK,EAAMxK,KACb8G,EAAM1C,EAAA0G,qBAENS,EAAa9R,EAAKgK,aAAee,EAAgB,EAAI,CACvDI,YAAaZ,EAAa,GAAGY,YAC7BmC,aAAc/C,EAAa,GAAG+C,aAC9BY,cAAe3D,EAAa,GAAG2D,eAC7BlO,EAAKoN,4BAA4BC,EAAKtC,GAEtCoB,EAAoB+F,aAAaF,gBAAgBzL,GAGrD4F,EAAkBG,OAASH,EAAkBG,OAAOjQ,QAChD,SAAS4V,GACP,MAAsB,QAAfA,EAAMtP,QAEnBwJ,EAAkBG,OAAO9P,SAAQ,SAASyV,GAGrB,SAAfA,EAAMtP,WAC0CgB,IAAhDsO,EAAMwB,WAAW,6BACnBxB,EAAMwB,WAAW,2BAA6B,QAQlD,IAAI9E,EAAyB,CAAC,CAC5BK,KAAgC,MAAzB,EAAIjE,EAAgB,KAEzBtK,IACFsL,EAAY,IAAImG,aAAazR,EAAOqR,EAAW5D,gBAG7C6C,EAAMwC,cACRtH,EAAc,IAAI8F,eAAeD,EAAW5D,cAAe3H,IAG7DgE,EAAaQ,GAAiB,CAC5BI,YAAa2G,EAAW3G,YACxBmC,aAAcwE,EAAWxE,aACzBY,cAAe4D,EAAW5D,cAC1B/B,kBAAmBA,EACnBC,mBAAoB,KACpBL,UAAWA,EACXE,YAAaA,EACb1F,KAAMA,EACN8G,IAAKA,EACLsB,uBAAwBA,EACxBI,uBAAwB,SAGxBjQ,KAAKkL,cACPR,GAAO,kBAAoBe,EAAavH,KAAI,SAAS0Q,GACnD,OAAOA,EAAErG,OACRrC,KAAK,KAAO,QAEjBkI,EAAO1W,SAAQ,SAASuU,EAAOhG,GAC7B,IAAIG,EAAcX,EAAaQ,GAC/BvB,GAAOmB,EAAAgJ,kBAA2BzI,EAC9BA,EAAYiB,kBAAmB,QAASnM,EAAKmJ,aAAa,OAGhErK,KAAKyQ,cAAgBhF,EACrB,IAAIqJ,EAAO,IAAI5P,sBAAsB,CACnCvB,KAAM,QACN+G,IAAKA,IAKP,OAHI1N,UAAUC,QAAkC,mBAAjBD,UAAU,IACvCiC,OAAO6S,WAAW9U,UAAU,GAAI,EAAG8X,GAE9BzQ,QAAQC,QAAQwQ,IAGzB7V,OAAO4B,kBAAkBzC,UAAU2W,aAAe,WAChD,IAAI7T,EAAOlB,KAEP0K,EAAMmB,EAAA6I,0BACN1U,KAAKkL,cACPR,GAAO,kBAAoB1K,KAAKyL,aAAavH,KAAI,SAAS0Q,GACxD,OAAOA,EAAErG,OACRrC,KAAK,KAAO,QAEjBlM,KAAKyL,aAAa/N,SAAQ,SAAS0O,GACjC,GAAIA,EAAY6E,cACdvG,GAAO,+DAEQ0B,EAAYmC,IAAM,WAHnC,CAOA,IAAIhB,EAAqBrM,EAAKkM,uBAC1BhB,EAAYiB,kBACZjB,EAAYkB,oBAEhB5C,GAAOmB,EAAAgJ,kBAA2BzI,EAAamB,EAC3C,SAAUrM,EAAKmJ,aAAa,QAGlC,IAAIyK,EAAO,IAAI5P,sBAAsB,CACnCvB,KAAM,SACN+G,IAAKA,IAKP,OAHI1N,UAAUC,QAAkC,mBAAjBD,UAAU,IACvCiC,OAAO6S,WAAW9U,UAAU,GAAI,EAAG8X,GAE9BzQ,QAAQC,QAAQwQ,IAGzB7V,OAAO4B,kBAAkBzC,UAAUgH,gBAAkB,SAAS2G,GAC5D,GAAKA,EAIE,CACL,IAAIiJ,EAAajJ,EAAUE,cAC3B,GAAIF,EAAU6C,OACZ,IAAK,IAAI7R,EAAI,EAAGA,EAAIiD,KAAKyL,aAAaxO,OAAQF,IAC5C,GAAIiD,KAAKyL,aAAa1O,GAAGwR,MAAQxC,EAAU6C,OAAQ,CACjDoG,EAAajY,EACb,MAIN,IAAIkY,EAAcjV,KAAKyL,aAAauJ,GACpC,GAAIC,EAAa,CACf,IAAIpG,EAAOpS,OAAOW,KAAK2O,EAAUA,WAAW9O,OAAS,EACjD4O,EAAAwF,eAAwBtF,EAAUA,WAAa,GAEnD,GAAsB,QAAlB8C,EAAKqG,WAAqC,IAAdrG,EAAKsG,MAA4B,IAAdtG,EAAKsG,MACtD,OAGF,GAAuB,MAAnBtG,EAAKE,UACP,OAGgB,oBAAdF,EAAKlL,OACPkL,EAAO,IAEToG,EAAYzG,aAAa4G,mBAAmBvG,GAG5C,IAAIjD,EAAWC,EAAAC,cAAuB9L,KAAK2K,kBAAkBD,KAC7DkB,EAASoJ,EAAa,KAAOnG,EAAKlL,KAAOoI,EAAUA,UAAUsJ,OACvD,uBAAyB,OAC/BrV,KAAK2K,kBAAkBD,IAAMkB,EAASM,KAAK,UAnC7ClM,KAAKyL,aAAa/N,SAAQ,SAAS0O,GACjCA,EAAYoC,aAAa4G,mBAAmB,OAwChD,OAHIpY,UAAUC,OAAS,GAA6B,mBAAjBD,UAAU,IAC3CiC,OAAO6S,WAAW9U,UAAU,GAAI,GAE3BqH,QAAQC,WAGjBrF,OAAO4B,kBAAkBzC,UAAU2E,SAAW,WAC5C,IAAIuS,EAAW,GACftV,KAAKyL,aAAa/N,SAAQ,SAAS0O,GACjC,CAAC,YAAa,cAAe,cAAe,eACxC,iBAAiB1O,SAAQ,SAASgH,GAC5B0H,EAAY1H,IACd4Q,EAAS/O,KAAK6F,EAAY1H,GAAQ3B,kBAI5C,IAAI8O,EAAK7U,UAAUC,OAAS,GAA6B,mBAAjBD,UAAU,IAC9CA,UAAU,GACd,OAAO,IAAIqH,SAAQ,SAASC,GAE1B,IAAIiR,EAAU,IAAIpR,IAClBE,QAAQmR,IAAIF,GAAU9Q,MAAK,SAASiR,GAClCA,EAAI/X,SAAQ,SAASiC,GACnBlD,OAAOW,KAAKuC,GAAQjC,SAAQ,SAAS+F,GACnC8R,EAAQvU,IAAIyC,EAAI9D,EAAO8D,IACvB8R,EAAQ9R,GAAM9D,EAAO8D,SAGrBoO,GACF5S,OAAO6S,WAAWD,EAAI,EAAG0D,GAE3BjR,EAAQiR,YAQlBlV,EAAAC,QAAiB,CACfkC,mBAAoB4G,EAAS5G,mBAC7B6C,iBAAkBC,EAAA,+CCpmCpB,aAGA,IAAIoQ,EAAW,CAIfA,mBAA8B,WAC5B,OAAO3H,KAAK4H,SAAStX,SAAS,IAAI8T,OAAO,EAAG,MAI9CuD,EAAS1F,WAAa0F,EAASnD,qBAG/BmD,EAASxD,WAAa,SAAS0D,GAC7B,OAAOA,EAAKP,OAAOrE,MAAM,MAAM9M,KAAI,SAASwO,GAC1C,OAAOA,EAAK2C,WAIhBK,EAAS5J,cAAgB,SAAS8J,GAEhC,OADYA,EAAK5E,MAAM,QACV9M,KAAI,SAAS2R,EAAMC,GAC9B,OAAQA,EAAQ,EAAI,KAAOD,EAAOA,GAAMR,OAAS,WAKrDK,EAAS3E,YAAc,SAAS6E,EAAM1P,GACpC,OAAOwP,EAASxD,WAAW0D,GAAMrY,QAAO,SAASmV,GAC/C,OAAgC,IAAzBA,EAAK7K,QAAQ3B,OAOxBwP,EAASrE,eAAiB,SAASqB,GAoBjC,IAnBA,IAAIqD,EAQAhK,EAAY,CACdiK,YANAD,EADmC,IAAjCrD,EAAK7K,QAAQ,gBACP6K,EAAKuD,UAAU,IAAIjF,MAAM,KAEzB0B,EAAKuD,UAAU,IAAIjF,MAAM,MAIf,GAClBjC,UAAWgH,EAAM,GACjBb,SAAUa,EAAM,GAAGnO,cACnBsO,SAAUzW,SAASsW,EAAM,GAAI,IAC7BI,GAAIJ,EAAM,GACVZ,KAAM1V,SAASsW,EAAM,GAAI,IAEzBpS,KAAMoS,EAAM,IAGLhZ,EAAI,EAAGA,EAAIgZ,EAAM9Y,OAAQF,GAAK,EACrC,OAAQgZ,EAAMhZ,IACZ,IAAK,QACHgP,EAAUqK,eAAiBL,EAAMhZ,EAAI,GACrC,MACF,IAAK,QACHgP,EAAUsK,YAAc5W,SAASsW,EAAMhZ,EAAI,GAAI,IAC/C,MACF,IAAK,UACHgP,EAAUuK,QAAUP,EAAMhZ,EAAI,GAC9B,cAEAgP,EAAUgK,EAAMhZ,IAAMgZ,EAAMhZ,EAAI,GAItC,OAAOgP,GAIT2J,EAAS1G,eAAiB,SAASjD,GACjC,IAAIrB,EAAM,GACVA,EAAInE,KAAKwF,EAAUiK,YACnBtL,EAAInE,KAAKwF,EAAUgD,WACnBrE,EAAInE,KAAKwF,EAAUmJ,SAAS9O,eAC5BsE,EAAInE,KAAKwF,EAAUmK,UACnBxL,EAAInE,KAAKwF,EAAUoK,IACnBzL,EAAInE,KAAKwF,EAAUoJ,MAEnB,IAAIxR,EAAOoI,EAAUpI,KAcrB,OAbA+G,EAAInE,KAAK,OACTmE,EAAInE,KAAK5C,GACI,SAATA,GAAmBoI,EAAUqK,gBAC7BrK,EAAUsK,cACZ3L,EAAInE,KAAK,SACTmE,EAAInE,KAAKwF,EAAUqK,gBACnB1L,EAAInE,KAAK,SACTmE,EAAInE,KAAKwF,EAAUsK,cAEjBtK,EAAUuK,SAAgD,QAArCvK,EAAUmJ,SAAStN,gBAC1C8C,EAAInE,KAAK,WACTmE,EAAInE,KAAKwF,EAAUuK,UAEd,aAAe5L,EAAIwB,KAAK,MAKjCwJ,EAASa,gBAAkB,SAAS7D,GAClC,OAAOA,EAAKP,OAAO,IAAInB,MAAM,MAK/B0E,EAASc,YAAc,SAAS9D,GAC9B,IAAIqD,EAAQrD,EAAKP,OAAO,GAAGnB,MAAM,KAC7ByF,EAAS,CACXC,YAAajX,SAASsW,EAAMrF,QAAS,KASvC,OANAqF,EAAQA,EAAM,GAAG/E,MAAM,KAEvByF,EAAO5S,KAAOkS,EAAM,GACpBU,EAAO5I,UAAYpO,SAASsW,EAAM,GAAI,IAEtCU,EAAO3I,YAA+B,IAAjBiI,EAAM9Y,OAAewC,SAASsW,EAAM,GAAI,IAAM,EAC5DU,GAKTf,EAASiB,YAAc,SAASxD,GAC9B,IAAIyD,EAAKzD,EAAMuD,YAIf,YAHmC7R,IAA/BsO,EAAM0D,uBACRD,EAAKzD,EAAM0D,sBAEN,YAAcD,EAAK,IAAMzD,EAAMtP,KAAO,IAAMsP,EAAMtF,WAC9B,IAAtBsF,EAAMrF,YAAoB,IAAMqF,EAAMrF,YAAc,IAAM,QAMjE4H,EAASoB,YAAc,SAASpE,GAC9B,IAAIqD,EAAQrD,EAAKP,OAAO,GAAGnB,MAAM,KACjC,MAAO,CACLvN,GAAIhE,SAASsW,EAAM,GAAI,IACvB1D,UAAW0D,EAAM,GAAGlO,QAAQ,KAAO,EAAIkO,EAAM,GAAG/E,MAAM,KAAK,GAAK,WAChE3C,IAAK0H,EAAM,KAMfL,EAASqB,YAAc,SAASC,GAC9B,MAAO,aAAeA,EAAgBvT,IAAMuT,EAAgBC,cACvDD,EAAgB3E,WAA2C,aAA9B2E,EAAgB3E,UACxC,IAAM2E,EAAgB3E,UACtB,IACN,IAAM2E,EAAgB3I,IAAM,QAMlCqH,EAASwB,UAAY,SAASxE,GAI5B,IAHA,IACIyE,EADAV,EAAS,GAETV,EAAQrD,EAAKP,OAAOO,EAAK7K,QAAQ,KAAO,GAAGmJ,MAAM,KAC5ChF,EAAI,EAAGA,EAAI+J,EAAM9Y,OAAQ+O,IAEhCyK,GADAU,EAAKpB,EAAM/J,GAAGqJ,OAAOrE,MAAM,MACjB,GAAGqE,QAAU8B,EAAG,GAE5B,OAAOV,GAITf,EAAS0B,UAAY,SAASjE,GAC5B,IAAIT,EAAO,GACPkE,EAAKzD,EAAMuD,YAIf,QAHmC7R,IAA/BsO,EAAM0D,uBACRD,EAAKzD,EAAM0D,sBAET1D,EAAMwB,YAAclY,OAAOW,KAAK+V,EAAMwB,YAAY1X,OAAQ,CAC5D,IAAI0S,EAAS,GACblT,OAAOW,KAAK+V,EAAMwB,YAAYjX,SAAQ,SAAS2Z,GAC7C1H,EAAOpJ,KAAK8Q,EAAQ,IAAMlE,EAAMwB,WAAW0C,OAE7C3E,GAAQ,UAAYkE,EAAK,IAAMjH,EAAOzD,KAAK,KAAO,OAEpD,OAAOwG,GAKTgD,EAAS4B,YAAc,SAAS5E,GAC9B,IAAIqD,EAAQrD,EAAKP,OAAOO,EAAK7K,QAAQ,KAAO,GAAGmJ,MAAM,KACrD,MAAO,CACLrN,KAAMoS,EAAMrF,QACZxC,UAAW6H,EAAM7J,KAAK,OAI1BwJ,EAAS6B,YAAc,SAASpE,GAC9B,IAAIqE,EAAQ,GACRZ,EAAKzD,EAAMuD,YAYf,YAXmC7R,IAA/BsO,EAAM0D,uBACRD,EAAKzD,EAAM0D,sBAET1D,EAAMnF,cAAgBmF,EAAMnF,aAAa/Q,QAE3CkW,EAAMnF,aAAatQ,SAAQ,SAASuQ,GAClCuJ,GAAS,aAAeZ,EAAK,IAAM3I,EAAGtK,MACrCsK,EAAGC,WAAaD,EAAGC,UAAUjR,OAAS,IAAMgR,EAAGC,UAAY,IACxD,UAGDsJ,GAKT9B,EAAS/C,eAAiB,SAASD,GACjC,IAAI+E,EAAK/E,EAAK7K,QAAQ,KAClBkO,EAAQ,CACV7F,KAAMzQ,SAASiT,EAAKP,OAAO,EAAGsF,EAAK,GAAI,KAErCC,EAAQhF,EAAK7K,QAAQ,IAAK4P,GAO9B,OANIC,GAAQ,GACV3B,EAAMnD,UAAYF,EAAKP,OAAOsF,EAAK,EAAGC,EAAQD,EAAK,GACnD1B,EAAMvZ,MAAQkW,EAAKP,OAAOuF,EAAQ,IAElC3B,EAAMnD,UAAYF,EAAKP,OAAOsF,EAAK,GAE9B1B,GAKTL,EAASiC,OAAS,SAAShH,GACzB,IAAIpC,EAAMmH,EAAS3E,YAAYJ,EAAc,UAAU,GACvD,GAAIpC,EACF,OAAOA,EAAI4D,OAAO,IAItBuD,EAASkC,iBAAmB,SAASlF,GACnC,IAAIqD,EAAQrD,EAAKP,OAAO,IAAInB,MAAM,KAClC,MAAO,CACL6G,UAAW9B,EAAM,GAAGnO,cACpBpL,MAAOuZ,EAAM,KAOjBL,EAASlE,kBAAoB,SAASb,EAAcH,GAKlD,MAAO,CACLiB,KAAM,OACNqG,aANUpC,EAAS3E,YAAYJ,EAAeH,EAC5C,kBAKkBtM,IAAIwR,EAASkC,oBAKrClC,EAASqC,oBAAsB,SAASpI,EAAQqI,GAC9C,IAAItN,EAAM,WAAasN,EAAY,OAInC,OAHArI,EAAOmI,aAAapa,SAAQ,SAASua,GACnCvN,GAAO,iBAAmBuN,EAAGJ,UAAY,IAAMI,EAAGzb,MAAQ,UAErDkO,GAKTgL,EAASvE,iBAAmB,SAASR,EAAcH,GACjD,IAAIgH,EAAQ9B,EAASxD,WAAWvB,GAWhC,MARoB,CAClBuH,kBAFFV,EAAQA,EAAMla,OAAOoY,EAASxD,WAAW1B,KAEfjT,QAAO,SAASmV,GACtC,OAAwC,IAAjCA,EAAK7K,QAAQ,mBACnB,GAAGsK,OAAO,IACbgG,SAAUX,EAAMja,QAAO,SAASmV,GAC9B,OAAsC,IAA/BA,EAAK7K,QAAQ,iBACnB,GAAGsK,OAAO,MAMjBuD,EAAS0C,mBAAqB,SAASzI,GACrC,MAAO,eAAiBA,EAAOuI,iBAAxB,iBACYvI,EAAOwI,SAAW,QAIvCzC,EAAS7E,mBAAqB,SAASF,GASrC,IARA,IAAIJ,EAAc,CAChB/C,OAAQ,GACRC,iBAAkB,GAClBC,cAAe,GACfoC,KAAM,IAGJmC,EADQyD,EAASxD,WAAWvB,GACd,GAAGK,MAAM,KAClBjU,EAAI,EAAGA,EAAIkV,EAAMhV,OAAQF,IAAK,CACrC,IAAI6Z,EAAK3E,EAAMlV,GACXsb,EAAa3C,EAAS3E,YACtBJ,EAAc,YAAciG,EAAK,KAAK,GAC1C,GAAIyB,EAAY,CACd,IAAIlF,EAAQuC,EAASc,YAAY6B,GAC7BC,EAAQ5C,EAAS3E,YACjBJ,EAAc,UAAYiG,EAAK,KAQnC,OANAzD,EAAMwB,WAAa2D,EAAMrb,OAASyY,EAASwB,UAAUoB,EAAM,IAAM,GACjEnF,EAAMnF,aAAe0H,EAAS3E,YAC1BJ,EAAc,aAAeiG,EAAK,KACnC1S,IAAIwR,EAAS4B,aAChB/G,EAAY/C,OAAOjH,KAAK4M,GAEhBA,EAAMtP,KAAKuC,eACjB,IAAK,MACL,IAAK,SACHmK,EAAY7C,cAAcnH,KAAK4M,EAAMtP,KAAKuC,iBAWlD,OAJAsP,EAAS3E,YAAYJ,EAAc,aAAajT,SAAQ,SAASgV,GAC/DnC,EAAY9C,iBAAiBlH,KAAKmP,EAASoB,YAAYpE,OAGlDnC,GAKTmF,EAAS6C,oBAAsB,SAAS9Q,EAAMmJ,GAC5C,IAAIlG,EAAM,GAGVA,GAAO,KAAOjD,EAAO,IACrBiD,GAAOkG,EAAKpD,OAAOvQ,OAAS,EAAI,IAAM,IACtCyN,GAAO,sBACPA,GAAOkG,EAAKpD,OAAOtJ,KAAI,SAASiP,GAC9B,YAAmCtO,IAA/BsO,EAAM0D,qBACD1D,EAAM0D,qBAER1D,EAAMuD,eACZxK,KAAK,KAAO,OAEfxB,GAAO,uBACPA,GAAO,8BAGPkG,EAAKpD,OAAO9P,SAAQ,SAASyV,GAC3BzI,GAAOgL,EAASiB,YAAYxD,GAC5BzI,GAAOgL,EAAS0B,UAAUjE,GAC1BzI,GAAOgL,EAAS6B,YAAYpE,MAE9B,IAAIqF,EAAW,EAef,OAdA5H,EAAKpD,OAAO9P,SAAQ,SAASyV,GACvBA,EAAMqF,SAAWA,IACnBA,EAAWrF,EAAMqF,aAGjBA,EAAW,IACb9N,GAAO,cAAgB8N,EAAW,QAEpC9N,GAAO,iBAEPkG,EAAKnD,iBAAiB/P,SAAQ,SAAS+a,GACrC/N,GAAOgL,EAASqB,YAAY0B,MAGvB/N,GAKTgL,EAASlD,2BAA6B,SAAS7B,GAC7C,IAcI+H,EAdAC,EAAqB,GACrBpI,EAAcmF,EAAS7E,mBAAmBF,GAC1CiI,GAAsD,IAA7CrI,EAAY7C,cAAc7F,QAAQ,OAC3CgR,GAA4D,IAAhDtI,EAAY7C,cAAc7F,QAAQ,UAG9CiR,EAAQpD,EAAS3E,YAAYJ,EAAc,WAC9CzM,KAAI,SAASwO,GACZ,OAAOgD,EAAS/C,eAAeD,MAEhCnV,QAAO,SAASwY,GACf,MAA2B,UAApBA,EAAMnD,aAEXmG,EAAcD,EAAM7b,OAAS,GAAK6b,EAAM,GAAG5I,KAG3C8I,EAAQtD,EAAS3E,YAAYJ,EAAc,oBAC9CzM,KAAI,SAASwO,GACZ,IAAIqD,EAAQrD,EAAK1B,MAAM,KAEvB,OADA+E,EAAMrF,QACCqF,EAAM7R,KAAI,SAAS2R,GACxB,OAAOpW,SAASoW,EAAM,UAGtBmD,EAAM/b,OAAS,GAAK+b,EAAM,GAAG/b,OAAS,GAAK+b,EAAM,GAAG,KAAOD,IAC7DL,EAAgBM,EAAM,GAAG,IAG3BzI,EAAY/C,OAAO9P,SAAQ,SAASyV,GAClC,GAAiC,QAA7BA,EAAMtP,KAAKuC,eAA2B+M,EAAMwB,WAAWsE,IAAK,CAC9D,IAAIC,EAAW,CACbhJ,KAAM6I,EACNI,iBAAkB1Z,SAAS0T,EAAMwB,WAAWsE,IAAK,IACjD7I,IAAK,CACHF,KAAMwI,IAGVC,EAAmBpS,KAAK2S,GACpBN,KACFM,EAAWrS,KAAKC,MAAMD,KAAKE,UAAUmS,KAC5BE,IAAM,CACblJ,KAAMwI,EACNW,UAAWR,EAAY,aAAe,OAExCF,EAAmBpS,KAAK2S,QAII,IAA9BP,EAAmB1b,QAAgB8b,GACrCJ,EAAmBpS,KAAK,CACtB2J,KAAM6I,IAKV,IAAIO,EAAY5D,EAAS3E,YAAYJ,EAAc,MAWnD,OAVI2I,EAAUrc,SAC4B,IAApCqc,EAAU,GAAGzR,QAAQ,WACvByR,EAAY7Z,SAAS6Z,EAAU,GAAGnH,OAAO,GAAI,IACF,IAAlCmH,EAAU,GAAGzR,QAAQ,WAC9ByR,EAAY7Z,SAAS6Z,EAAU,GAAGnH,OAAO,GAAI,KAE/CwG,EAAmBjb,SAAQ,SAASiS,GAClCA,EAAO4J,WAAaD,MAGjBX,GAITjD,EAAS8D,oBAAsB,SAAS7I,GACtC,IAAI8I,EAAiB,GAKjBhH,EAAaiD,EAAS3E,YAAYJ,EAAc,WAC/CzM,KAAI,SAASwO,GACZ,OAAOgD,EAAS/C,eAAeD,MAEhCnV,QAAO,SAASjB,GACf,MAAyB,UAAlBA,EAAIsW,aACV,GACHH,IACFgH,EAAe1J,MAAQ0C,EAAWjW,MAClCid,EAAevJ,KAAOuC,EAAWvC,MAKnC,IAAIwJ,EAAQhE,EAAS3E,YAAYJ,EAAc,gBAC/C8I,EAAeE,YAAcD,EAAMzc,OAAS,EAC5Cwc,EAAeG,SAA4B,IAAjBF,EAAMzc,OAIhC,IAAI4c,EAAMnE,EAAS3E,YAAYJ,EAAc,cAG7C,OAFA8I,EAAeI,IAAMA,EAAI5c,OAAS,EAE3Bwc,GAKT/D,EAASoE,UAAY,SAASnJ,GAC5B,IAAIoJ,EACAC,EAAOtE,EAAS3E,YAAYJ,EAAc,WAC9C,GAAoB,IAAhBqJ,EAAK/c,OAEP,MAAO,CAACsE,QADRwY,EAAQC,EAAK,GAAG7H,OAAO,GAAGnB,MAAM,MACV,GAAIrP,MAAOoY,EAAM,IAEzC,IAAIE,EAAQvE,EAAS3E,YAAYJ,EAAc,WAC9CzM,KAAI,SAASwO,GACZ,OAAOgD,EAAS/C,eAAeD,MAEhCnV,QAAO,SAASwY,GACf,MAA2B,SAApBA,EAAMnD,aAEf,OAAIqH,EAAMhd,OAAS,EAEV,CAACsE,QADRwY,EAAQE,EAAM,GAAGzd,MAAMwU,MAAM,MACP,GAAIrP,MAAOoY,EAAM,SAFzC,GAMFrE,EAAShB,wBAA0B,WAEjC,MAAO,yFAMTgB,EAASb,kBAAoB,SAASzI,EAAawE,EAAMjN,EAAMpC,GAC7D,IAAImJ,EAAMgL,EAAS6C,oBAAoBnM,EAAY3E,KAAMmJ,GAyBzD,GAtBAlG,GAAOgL,EAAS0C,mBACZhM,EAAYC,YAAY6N,sBAG5BxP,GAAOgL,EAASqC,oBACZ3L,EAAYgD,cAAc8K,qBACjB,UAATvW,EAAmB,UAAY,UAEnC+G,GAAO,SAAW0B,EAAYmC,IAAM,OAEhCnC,EAAYiG,UACd3H,GAAO,KAAO0B,EAAYiG,UAAY,OAC7BjG,EAAYa,WAAab,EAAYe,YAC9CzC,GAAO,iBACE0B,EAAYa,UACrBvC,GAAO,iBACE0B,EAAYe,YACrBzC,GAAO,iBAEPA,GAAO,iBAGL0B,EAAYa,UAAW,CAEzB,IAAIkN,EAAO,QAAU5Y,EAAOkC,GAAK,IAC7B2I,EAAYa,UAAUtL,MAAM8B,GAAK,OACrCiH,GAAO,KAAOyP,EAGdzP,GAAO,UAAY0B,EAAYyD,uBAAuB,GAAGK,KACrD,IAAMiK,EACN/N,EAAYyD,uBAAuB,GAAGO,MACxC1F,GAAO,UAAY0B,EAAYyD,uBAAuB,GAAGO,IAAIF,KACzD,IAAMiK,EACVzP,GAAO,oBACH0B,EAAYyD,uBAAuB,GAAGK,KAAO,IAC7C9D,EAAYyD,uBAAuB,GAAGO,IAAIF,KAC1C,QAUR,OANAxF,GAAO,UAAY0B,EAAYyD,uBAAuB,GAAGK,KACrD,UAAYwF,EAAS1F,WAAa,OAClC5D,EAAYa,WAAab,EAAYyD,uBAAuB,GAAGO,MACjE1F,GAAO,UAAY0B,EAAYyD,uBAAuB,GAAGO,IAAIF,KACzD,UAAYwF,EAAS1F,WAAa,QAEjCtF,GAITgL,EAASpD,aAAe,SAAS3B,EAAcH,GAG7C,IADA,IAAIgH,EAAQ9B,EAASxD,WAAWvB,GACvB5T,EAAI,EAAGA,EAAIya,EAAMva,OAAQF,IAChC,OAAQya,EAAMza,IACZ,IAAK,aACL,IAAK,aACL,IAAK,aACL,IAAK,aACH,OAAOya,EAAMza,GAAGoV,OAAO,GAK7B,OAAI3B,EACKkF,EAASpD,aAAa9B,GAExB,YAGTkF,EAAS0E,QAAU,SAASzJ,GAG1B,OAFY+E,EAASxD,WAAWvB,GACd,GAAGK,MAAM,KACd,GAAGmB,OAAO,IAGzBuD,EAAS2E,WAAa,SAAS1J,GAC7B,MAAyC,MAAlCA,EAAaK,MAAM,IAAK,GAAG,IAIpC3Q,EAAAC,QAAiBoV,uCCrlBjB,aAGArV,EAAAC,QAAiB,WACf,IAYIwI,EAAmBlJ,UAAUQ,aAAaiI,aAC1CrG,KAAKpC,UAAUQ,cACnBR,UAAUQ,aAAaiI,aAAe,SAAS7C,GAC7C,OAAOsD,EAAiBtD,GAAG8U,OAAM,SAAShZ,GACxC,OAAO+C,QAAQE,OAhBF,SAASjD,GACxB,MAAO,CACLuC,KAAI,CAAGmE,sBAAuB,mBAAmB1G,EAAEuC,OAASvC,EAAEuC,KAC9DqE,QAAS5G,EAAE4G,QACXC,WAAY7G,EAAE6G,WACd9J,SAAU,WACR,OAAO2B,KAAK6D,OAUQkE,CAAWzG,8CCpBvC,8BAEIf,eAEAga,EAAc,CAChB3Z,YAAa,WACW,iBAAX3B,QAAuBA,OAAO4B,qBAAuB,YAC5D5B,OAAO4B,kBAAkBzC,YAC3B3B,OAAOC,eAAeuC,OAAO4B,kBAAkBzC,UAAW,UAAW,CACnE0C,IAAK,WACH,OAAOd,KAAKe,UAEdC,IAAK,SAASC,GACRjB,KAAKe,WACPf,KAAKmB,oBAAoB,QAASnB,KAAKe,UACvCf,KAAKmB,oBAAoB,YAAanB,KAAKoB,eAE7CpB,KAAKqB,iBAAiB,QAASrB,KAAKe,SAAWE,GAC/CjB,KAAKqB,iBAAiB,YAAarB,KAAKoB,aAAY,SAAYE,GAC9DA,EAAEC,OAAOQ,YAAYrE,QAAO,SAAUiE,GACpC,IAAIF,EAAQ,IAAIC,MAAM,SACtBD,EAAME,MAAQA,EACdF,EAAMG,SAAW,CAACD,MAAOA,GACzBF,EAAMI,QAAU,CAACP,EAAEC,QACnBvB,KAAK8B,cAAcL,IACnBO,KAAKhC,QACPgC,KAAKhC,WAMfiC,iBAAkB,WAEM,iBAAXhD,QACLA,OAAOiD,oBACP,cAAejD,OAAOiD,iBAAiB9D,YAEzC3B,OAAOC,eAAeuC,OAAOiD,iBAAiB9D,UAAW,YAAa,CACpE0C,IAAK,WACH,OAAOd,KAAKwa,cAEdxZ,IAAK,SAASO,GACZvB,KAAKwa,aAAejZ,MAO9BiB,mBAAoB,WAClB,GAAsB,iBAAXvD,SAAyBA,OAAO4B,mBACvC5B,OAAOwb,sBADX,CAKKxb,OAAO4B,oBACV5B,OAAO4B,kBAAoB,SAAS4B,EAAUC,GAC5C,GAAEgY,EAAiB3a,QAAU,IAGvB0C,GAAYA,EAASwI,WAAY,CAEnC,IADA,IAAI0P,EAAgB,GACX5d,EAAI,EAAGA,EAAI0F,EAASwI,WAAWhO,OAAQF,IAAK,CACnD,IAAIqO,EAAS3I,EAASwI,WAAWlO,GACjC,GAAIqO,EAAOwP,eAAe,QACxB,IAAK,IAAI5O,EAAI,EAAGA,EAAIZ,EAAOC,KAAKpO,OAAQ+O,IAAK,CAC3C,IAAI6O,EAAY,CACdvP,IAAKF,EAAOC,KAAKW,IAEoB,IAAnCZ,EAAOC,KAAKW,GAAGnE,QAAQ,UACzBgT,EAAUC,SAAW1P,EAAO0P,SAC5BD,EAAUE,WAAa3P,EAAO2P,YAEhCJ,EAAcpU,KAAKsU,QAGrBF,EAAcpU,KAAK9D,EAASwI,WAAWlO,IAG3C0F,EAASwI,WAAa0P,EAG1B,OAAO,IAAIF,qBAAqBhY,EAAUC,IAE5CzD,OAAO4B,kBAAkBzC,UAAYqc,qBAAqBrc,UAGtDqc,qBAAqBhW,qBACvBhI,OAAOC,eAAeuC,OAAO4B,kBAAmB,sBAAuB,CACrEC,IAAK,WACH,OAAO2Z,qBAAqBhW,uBAKlCxF,OAAOiG,sBAAwB8V,yBAC/B/b,OAAOgG,gBAAkBgW,oBAI3B,CAAC,sBAAuB,uBAAwB,mBAC3Cvd,SAAQ,SAASgH,GAChB,IAAIC,EAAe9D,kBAAkBzC,UAAUsG,GAC/C7D,kBAAkBzC,UAAUsG,GAAU,WAGpC,OAFA1H,UAAU,GAAK,IAAiB,oBAAX0H,EACjBO,gBAAkBC,uBAAuBlI,UAAU,IAChD2H,EAAaxF,MAAMa,KAAMhD,eAKxC,IAAImI,EACAtE,kBAAkBzC,UAAUgH,gBAWhC,GAVAvE,kBAAkBzC,UAAUgH,gBAAkB,WAC5C,OAAKpI,UAAU,GAMRmI,EAAsBhG,MAAMa,KAAMhD,YALnCA,UAAU,IACZA,UAAU,GAAGmC,MAAM,MAEdkF,QAAQC,YAKjBoW,EAAiB3a,QAAU,GAAI,CAE/B,IASImb,EAAiBra,kBAAkBzC,UAAU2E,SACjDlC,kBAAkBzC,UAAU2E,SAAW,SAASC,EAAUmY,EAAQC,GAChE,OAAOF,EAAe/b,MAAMa,KAAM,CAACgD,GAAY,OAC5CwB,MAAK,SAASR,GACb,OAba,SAASA,GAC1B,IAAIE,EAAM,IAAIC,IAKd,OAJA1H,OAAOW,KAAK4G,GAAOtG,SAAQ,SAASnB,GAClC2H,EAAIlD,IAAIzE,EAAKyH,EAAMzH,IACnB2H,EAAI3H,GAAOyH,EAAMzH,MAEZ2H,EAOIH,CAAaC,MAErBQ,KAAK2W,EAAQC,QAOxB/a,EAAAC,QAAiB,CACfM,YAAa2Z,EAAY3Z,YACzBqB,iBAAkBsY,EAAYtY,iBAC9BO,mBAAoB+X,EAAY/X,mBAChC6C,iBAAkBC,EAAA,+CCxJpB,8BAEItG,iBACAuB,eAGJF,EAAAC,QAAiB,WACf,IAAIyH,EAAa,SAASzG,GACxB,MAAO,CACLuC,KAAI,CACFwX,cAAe,kBACfrT,sBAAuB,mBACvB1G,EAAEuC,OAASvC,EAAEuC,KACfqE,QAAO,CACL,6BAA8B,wFAE9B5G,EAAE4G,UAAY5G,EAAE4G,QAClBC,WAAY7G,EAAE6G,WACd9J,SAAU,WACR,OAAO2B,KAAK6D,MAAQ7D,KAAKkI,SAAW,MAAQlI,KAAKkI,WAMnDoT,EAAgB,SAAS3U,EAAa2B,EAAWC,GACnD,IAAIgT,EAAqB,SAAS/V,GAChC,GAAiB,iBAANA,GAAkBA,EAAEgW,QAC7B,OAAOhW,EAET,IAAIgW,EAAU,GAqCd,OApCA/e,OAAOW,KAAKoI,GAAG9H,SAAQ,SAASnB,GAC9B,GAAY,YAARA,GAA6B,aAARA,GAA8B,gBAARA,EAA/C,CAGA,IAAIqJ,EAAIJ,EAAEjJ,GAA0B,iBAAXiJ,EAAEjJ,GACvBiJ,EAAEjJ,GAAO,CAACsJ,MAAOL,EAAEjJ,IAavB,QAZcsI,IAAVe,EAAEG,UACQlB,IAAVe,EAAEI,UAAiCnB,IAAZe,EAAEE,OAC3B0V,EAAQjV,KAAKhK,QAECsI,IAAZe,EAAEE,QACmB,iBAAZF,EAAEE,MACXF,EAAGG,IAAMH,EAAEI,IAAMJ,EAAEE,MAEnBN,EAAEjJ,GAAOqJ,EAAEE,aAENF,EAAEE,YAEKjB,IAAZe,EAAEC,MAAqB,CACzBL,EAAEiB,SAAWjB,EAAEiB,UAAY,GAC3B,IAAIH,EAAK,GACc,iBAAZV,EAAEC,MACXS,EAAG/J,GAAO,CAACwJ,IAAKH,EAAEC,MAAOG,IAAKJ,EAAEC,OAEhCS,EAAG/J,GAAOqJ,EAAEC,MAEdL,EAAEiB,SAASF,KAAKD,UACTV,EAAEC,MACJpJ,OAAOW,KAAKwI,GAAG3I,eACXuI,EAAEjJ,QAIXif,EAAQve,SACVuI,EAAEgW,QAAUA,GAEPhW,GAaT,OAXAmB,EAAcE,KAAKC,MAAMD,KAAKE,UAAUJ,IACtC8U,EAAiB1b,QAAU,OACnB,SAAW8G,KAAKE,UAAUJ,IAC9BA,EAAYK,QACdL,EAAYK,MAAQuU,EAAmB5U,EAAYK,QAEjDL,EAAYM,QACdN,EAAYM,MAAQsU,EAAmB5U,EAAYM,UAE7C,SAAWJ,KAAKE,UAAUJ,KAE7B/G,UAAUE,gBAAgB6G,EAAa2B,GAAW,SAAShH,GAChEiH,EAAQR,EAAWzG,QA6BvB,GAjBK1B,UAAUQ,eACbR,UAAUQ,aAAe,CAACiI,aARD,SAAS1B,GAClC,OAAO,IAAItC,SAAQ,SAASC,EAASC,GACnC+W,EAAc3U,EAAarC,EAASC,OAOpClD,iBAAkB,aAClBF,oBAAqB,eAGzBvB,UAAUQ,aAAaiH,iBACnBzH,UAAUQ,aAAaiH,kBAAoB,WACzC,OAAO,IAAIhD,SAAQ,SAASC,GAK1BA,EAJY,CACV,CAACmD,KAAM,aAAcK,SAAU,UAAWH,MAAO,GAAIkB,QAAS,IAC9D,CAACpB,KAAM,aAAcK,SAAU,UAAWH,MAAO,GAAIkB,QAAS,UAMtE4S,EAAiB1b,QAAU,GAAI,CAE/B,IAAI2b,EACA9b,UAAUQ,aAAaiH,iBAAiBrF,KAAKpC,UAAUQ,cAC3DR,UAAUQ,aAAaiH,iBAAmB,WACxC,OAAOqU,IAAsBlX,UAAKK,GAAW,SAASvD,GACpD,GAAe,kBAAXA,EAAEuC,KACJ,MAAO,GAET,MAAMvC,MAIZ,GAAEma,EAAiB1b,QAAU,GAAI,CAC/B,IAAI+I,EAAmBlJ,UAAUQ,aAAaiI,aAC1CrG,KAAKpC,UAAUQ,cACnBR,UAAUQ,aAAaiI,aAAe,SAAS7C,GAC7C,OAAOsD,EAAiBtD,GAAGhB,MAAK,SAASjD,GAEvC,GAAIiE,EAAEwB,QAAUzF,EAAOyH,iBAAiB/L,QACpCuI,EAAEyB,QAAU1F,EAAO0H,iBAAiBhM,OAItC,MAHAsE,EAAOQ,YAAYrE,SAAQ,SAASiE,GAClCA,EAAMuH,UAEF,IAAIC,aAAa,oCACA,iBAEzB,OAAO5H,KACN,SAASD,GACV,OAAO+C,QAAQE,OAAOwD,EAAWzG,QAIvC1B,UAAUyI,aAAe,SAAS1B,EAAa2B,EAAWC,GACxD,GAAEkT,EAAiB1b,QAAU,GAC3B,OAAOub,EAAc3U,EAAa2B,EAAWC,GAG/CrJ,QAAQyc,KAAK,mFAEb/b,UAAUQ,aAAaiI,aAAa1B,GAAanC,KAAK8D,EAAWC,0CCvJrE,aACA,IAAIqT,EAAa,CAQfvW,iBAAkB,WAChBzF,UAAUyI,aAAezI,UAAUM,qBAKvCG,EAAAC,QAAiB,CACf+E,iBAAkBuW,EAAWvW,gCCT7B,IAAIwW,EAAUvW,EAAA,SAAAtG,IACVuB,EAAiB+E,EAAA,SAAA/E,eAEWA,EACA+E,EAAA,SAAAlG,eACJkG,EAAA,SAAAzG,WAS5B,IAAIid,EAAaxW,EAAA,UAAmC,KAChDyW,EAAWzW,EAAA,UAA+B,KAC1C0W,EAAc1W,EAAA,UAAqC,KACnD2W,EAAa3W,EAAA,UAAmC,KAGpD,OAAQ/E,EAAeV,SACrB,IAAK,QACL,IAAK,SACH,IAAKic,IAAeA,EAAWtZ,mBAE7B,YADAqZ,EAAQ,wDAGVA,EAAQ,+BAEqBC,EAE7BA,EAAWzW,mBACXyW,EAAWrb,kBACXqb,EAAW7Z,mBACX6Z,EAAWtZ,qBACXsZ,EAAWlb,cACX,MACF,IAAK,UACH,IAAKob,IAAgBA,EAAYxZ,mBAE/B,YADAqZ,EAAQ,yDAGVA,EAAQ,gCAEqBG,EAE7BA,EAAY3W,mBACZ2W,EAAY/Z,mBACZ+Z,EAAYxZ,qBACZwZ,EAAYpb,cACZ,MACF,IAAK,OACH,IAAKmb,IAAaA,EAASvZ,mBAEzB,YADAqZ,EAAQ,yDAGVA,EAAQ,6BAEqBE,EAE7BA,EAAS1W,mBACT0W,EAASvZ,qBACT,MACF,IAAK,SACH,IAAKyZ,EAEH,YADAJ,EAAQ,wDAGVA,EAAQ,+BAEqBI,EAE7BA,EAAW5W,mBACX,cAEAwW,EAAQ,4BCtFdK,EAAiB,SAAUvV,EAAakL,GACpC,IAAIsK,EACAC,EAAgC,IAArBpf,UAAUC,OACrBof,EAAc,CAACpV,OAAO,EAAMD,OAAO,GAEnCsV,EAAS,wBACTC,EAAY,oBACZC,EAAe,8BASnB,OANKJ,IACDvK,EAAKlL,EACLA,EAAc0V,GAIO,oBAAdzc,WAA8BA,UAAUyI,aAY9C1B,EAAYK,OAAUL,EAAYM,WAUvCrH,UAAUQ,aAAaiI,aAAa1B,GACnCnC,MAAK,SAAUjD,GACZsQ,EAAG,KAAMtQ,MACV+Y,OAAM,SAAUtV,GACf,IAAIyX,EAIe,iBAARzX,GACPyX,EAAQ,IAAI1d,MAAM,qBAER8E,KADNmB,IAAQsX,GAAUtX,IAAQuX,EACbD,EAEAE,GAKjBC,EAAQzX,GACGnB,OAIH4Y,EAAMH,GACNtX,EAAInB,KAAOyY,EAEXtX,EAAInB,KAAO2Y,GAKvB3K,EAAG4K,QAxCHN,EAAQ,IAAIpd,MAAM,qBACZ8E,KAAO,wBAGNiO,YAAW,WACdD,EAAGsK,KACJ,MAjBHA,EAAQ,IAAIpd,MAAM,qBACZ8E,KAAO,oBAGNiO,YAAW,WACdD,EAAGsK,KACJ,KCrBJ,MAAMO,EAAW,CAAC,EAAC,GAAI,GAAK,EAAC,EAAI,GAAI,CAAC,GAAG,IAEnCC,EAAQD,EAASzf,OAYjB2f,EAAYF,EAASG,WCLlCC,EAFkB,CAAIC,EAAGvgB,EAAOkV,EAAO5C,IAAQjR,MAAMkf,GAAGC,KAAKxgB,EAAOkV,EAAO5C,GCb3E,MAAMmO,EAAIpf,MAAMO,UAAU8e,OAgBbC,EAAM,CAAIlc,EAAGmc,EAAGC,SAEfxY,IAARwY,EAAoBJ,EAAE3e,KAAK8e,EAAGnc,GAAKgc,EAAE3e,KAAK8e,EAAGnc,EAAGoc,OCMtDC,EAPgB,CAAIrc,EAAGmc,EAAGG,EAAM,KAAOJ,GAAM,CAAEE,EAAKG,EAAGzgB,KAC/CsgB,EAAItgB,GAAKkE,EAAEuc,EAAGzgB,EAAGqgB,EAAGC,GAEbA,IAEXD,EAAIG,GAAOH,GCtBf,MAAMK,EAAI5f,MAAMO,UAAUV,YAgB1BggB,EANiB,CAAIzc,EAAGmc,KACpBK,EAAEnf,KAAK8e,EAAGnc,GAEHmc,GCHJ,MAAMO,EAAS,CAAI5gB,EAAG6gB,KAAQ7gB,EAAE6gB,EAAGA,GAAGA,EAahCC,EAAO,CAAI9gB,EAAGqgB,IAAMA,EAAEO,EAAU5gB,EAAGqgB,EAAEngB,eCvBlD6gB,EAAe,s3HCcf,IAAMC,EAAOpU,SAASqU,cAAc,SAC9BC,EAAQF,EAAKC,cAAc,WAC3BE,EAASH,EAAKC,cAAc,WAE5BG,EAAOC,EAAAC,EAAA,CAAQ,CACjBC,OAAAJ,EACAK,mBAAoB,CAChB,yBAA0B,oBAC1B,8BAIFC,EAASL,EAAKM,aAAa,8BAC3BN,EAAKM,aAAa,qBAAuB,QACtCN,EAAKM,aAAa,2BAA6B,cAGlDC,GAASF,EACTG,EAAW,CAAEhb,KAAO6a,GAAS,QAAUzY,IAAK,SAAU6Y,IAAK,UAC3DC,EAAS,WAAM,OAAAV,EAAKW,QAAQH,IAC5BI,EAAW,SAAQ1H,OAAP2H,OAAK,IAAA3H,EAAGwH,IAAMxH,EAAO,OAAA8G,EAAKc,YAAY,CAAED,MAAAA,KAGpDE,EAAa5B,EAAIuB,EAAQ/B,EAAM,GAAI,GACnCqC,EAAe7B,EAAIyB,EAAUG,GAG7BE,EAAa9B,GAAI,WAAM,OAAAyB,MAAYjC,EAAM,GAAI,GAC7CuC,EAASN,IAGTO,EAAchC,GAAI,WAAM,OAAAyB,MAAYjC,EAAM,GAAI,GAE9CyC,EAAQC,EAAOL,GAAY7hB,OAAAkiB,EAAKJ,GAArB,CAAiCC,GAAuBG,EAAZF,IAEvDG,EAAU,EAAC,GAAI,EAAI,EAAG,GACtBC,EAAW,CAAC,EAAG,EAAG,EAAG,GAErBC,EAAQze,KAAK0e,YAAc,CAC7BC,WAAY,CAAEC,KAAM7B,EAAO8B,OAAO,GAClCC,YAAa,CAMTC,KAAM,kCAAkC7B,EAAAN,GASxCoC,OAAQ5C,GAAI,SAACF,EAAGjN,GAAO,MAAA,CAAEgQ,KAAM/C,EAAGgD,KAAMjQ,KAAM,CAAC,CAAC,IAAK,GAAI,CAAC,EAAG,MACzD,IAERkQ,KAAM,CAEFC,OAAQ,EACRC,OAAQ,KACRC,MAAO1D,EAAM,EAAG,GAChB2D,MAAO,IACPC,QAAAjB,EAASkB,SAAAjB,GAEbkB,WAAY,CAQRX,KAAM,8HAGAvB,EAAQ,iCAAmC,IAC7C,mCACAN,EAAAN,GAEJ+C,MAAOxB,EAAQyB,MAAO,EACtBJ,QAAAjB,EAASkB,SAAAjB,EASTQ,OAAQ5C,GAAI,SAACyD,EAAG5Q,GAGR,OAFA4Q,EAAEX,KAAOjQ,EAEF4Q,IAEX,CACI,CACIZ,KAAM,CAAC,EAAG,GAAIa,KAAMlE,EAAM,EAAG,GAC7B0D,MAAO1D,EAAM,EAAG,IAEpB,CACIqD,KAAM,CAAC,EAAG,GAAIa,KAAMlE,EAAM,EAAG,KAC7B0D,MAAO1D,EAAM,EAAG,KAGxB,IAERmE,KAAM,CAAEP,QAAAjB,EAASkB,SAAAjB,IAGfwB,EAAY,CAAElC,MAAO,CAAC,EAAG,EAAG,EAAG,GAAImC,MAAO,EAAGC,QAAS,GACtDC,EAASC,EAAA,GAAQJ,EAAS,CAAEjC,YAAaI,IAEzCkC,EAAajE,GAAI,SAACrc,GAAO,OAAMqgB,EAAA,GAADJ,EAAS,CAAEjC,YAAahe,MACxDme,GAEEoC,EAAelE,GAAI,SAACrc,GAAO,OAAMqgB,EAAA,GAADJ,EAAS,CAAEjC,YAAahe,MAC1Dke,GAEEsC,EAAcnE,GAAI,SAACrc,GAAO,OAAMqgB,EAAA,GAADJ,EAAS,CAAEjC,YAAahe,MACzDqe,GAEEoC,EAAavD,EAAK,CACpBwD,KAAAvD,EC1IW,kRD0ILwD,WAAY,CAAEC,SAAUjF,GAAakF,MAAAnF,EAC3CwE,MAAO,CAAEY,QAAQ,KAKfC,EAAa7D,EAAK,CACpB8B,KAAM,SAACza,EAAC6R,OAAU4K,EAAc5K,EAApB4I,KAA2B,YAAP,IAAdgC,EAAI7D,EAAAN,GAAJmE,GAClBC,SAAU,CAENC,MAAO,SAAC3c,EAAC6R,OAAU4K,EAAK5K,EAAX+I,KAAMjQ,OAAK,IAAL8R,EAAI,EAAJA,EAAchhB,EAACoW,EAAR8K,MACrB,OAAAlhB,MAAAA,EAAAA,EAAK4c,EAAQ1N,EAAE,EAAGgP,IAEvBgB,KAAMhC,EAAKiE,KAAK,QAChBpB,KAAM7C,EAAKiE,KAAK,QAChB5B,MAAOrC,EAAKiE,KAAK,SACjB/B,KAAMlC,EAAKiE,KAAK,QAChB1B,QAASvC,EAAKiE,KAAK,WACnBzB,SAAUxC,EAAKiE,KAAK,YACpBvB,MAAO1C,EAAKiE,KAAK,SACjBtB,MAAO3C,EAAKiE,KAAK,SACjBC,MAAOlE,EAAKmE,QAAQ,sBACpBC,OAAQpE,EAAKmE,QAAQ,wBAGzBrD,YAAa,SAACzZ,EAAC6R,OAAU4K,EAAK5K,EAAX+I,KAAMjQ,OAAK,IAAL8R,EAAI,EAAJA,EAAOO,EAA6BnL,EAA7BoL,GAAoC,YAAP,IAA7BD,EAAK3E,EAAQ1N,EAAGgP,GAAhBqD,cAI3BE,EAAgBC,GAErB,OAAOX,EAAW1E,GAAI,SAAC8C,GAAS,OAAA3jB,OAAOmmB,OAAOxC,EAAMuC,EAAOvC,KACvDuC,EAAMzC,OAAQ,aAIb2C,EAAqBC,GAC1B,IAAQjD,EAA4BF,EAA5BE,WAAYG,EAAgBL,EAAhBK,YACd/e,EAAI0c,EAAUmF,EAAM1D,EAAWniB,QAQrC,OANAygB,EAAKS,EAAK4E,MAAOvB,GACjBtC,EAAW,GAAGW,GAEd1B,EAAK4E,MAAMxB,EAAWtgB,IACtB+e,EAAYE,OAAO,GAAGuC,GAAKrD,EAAWne,GAE/ByhB,EAAgB1C,GAI3B,IAAMgD,EAAW7E,EAAK,CAClB8B,MAAQvB,EAAQ,2BAA6B,IAAIN,EE7LtC,+kHF8LX8D,SAAU,CACNe,KAAM,SAAQ5L,OAACzC,EAACyC,EAAPyL,KAAc,OAAAjF,EAAQjJ,EAAGwK,IAClC8D,KAAM,SAAQ7L,OAACzC,EAACyC,EAAPyL,KAAc,OAAAjF,EAAQjJ,EAAE,EAAGwK,IACpCkB,OAAQnC,EAAKiE,KAAK,UAClB7B,OAAQpC,EAAKiE,KAAK,UAClB5B,MAAOrC,EAAKiE,KAAK,SACjB3B,MAAOtC,EAAKiE,KAAK,SACjB1B,QAASvC,EAAKiE,KAAK,WACnBzB,SAAUxC,EAAKiE,KAAK,aAExBnD,YAAaI,IAgCjB,IAAM8D,EAAWhF,EAAK,CAClB8B,MAAQvB,EAAQ,+BAAiC,IAAIN,EGzO1C,s4EH0OX8D,SAAU,CACNC,MAAO,SAAQ9K,OAACzC,EAACyC,EAAPyL,KAAc,OAAAjF,EAAQjJ,EAAG0K,IACnCoB,QAASvC,EAAKiE,KAAK,WACnBzB,SAAUxC,EAAKiE,KAAK,wBAWnBgB,EAAK/L,OAAQzC,EAARyC,EAAEyL,KAEZD,EAAqBjO,GA9CrBuJ,EAAK4E,MAAM1B,GAEJ2B,EAASrD,EAAMU,MASvB,SAC0ByC,GACzB,IAAQlC,EAAejB,EAAfiB,WACAV,EAAWU,EAAXV,OAERxC,EAAKS,EAAK4E,MAAOvB,GACjBZ,EAAWP,KAAOH,EAAO,GAAGiC,MAAQtE,EAAQiF,EAAK,EAAGxD,GAEpD,IAAM+D,EAAI1F,EAAUmF,EAAMxD,EAAYriB,QAEtCkhB,EAAK4E,MAAMtB,EAAY4B,IACvBnD,EAAO,GAAGuC,GAAKnD,EAAY+D,GAEpBX,EAAgB9B,GA0BvB0C,CAAoB1O,GAZpBuJ,EAAK4E,MAAM7B,GAEJiC,EAASxD,EAAMsB,MAe1BhD,EAAM5c,iBAAiB,WAAW,WAC9B,IAAoBkiB,EAAsBtF,EAAlCuF,WAA4BC,EAAMxF,EAAnByF,YAEvBzF,EAAMoE,MAAQnE,EAAOmE,MAAQkB,EAC7BtF,EAAMsE,OAASrE,EAAOqE,OAASkB,EAC/B/F,GAAK,SAACF,GAAM,OAAAA,EAAEmG,OAAOJ,EAAGtF,EAAMyF,eAAcnE,GAE5CI,EAAMU,KAAKC,QAAUvS,KAAK/H,IAAIud,EAAGE,EAAG,KACpCxF,EAAM2F,OAGNlC,GAAW,WACPmB,EAAqB,GACrBA,EAAqB,MAIzB1E,EAAKgE,OAAM,WAAM,OAAAT,EAAW0B,SAGhCrF,EAAK1c,iBAAiB,SAAS,WAC3B,IAAMmE,EAAIuY,EAAK8F,UAEfre,EAAGA,EAAEse,SAAS,WAAa,SAAW,OAAO,cAGjD1F,EAAAlC,EAAA,CAAa,CAAEjV,OAAO,IAAQ,SAAC3F,EAAGC,GAC3BD,EAAKpC,QAAQyc,KAAKra,GACb,cAAe2c,EAASA,EAAM8F,UAAYxiB,EAC3C0c,EAAM7b,IAAMlB,KAAKmB,IAAIE,gBAAgBhB","sources":["node_modules/@swc/helpers/src/_define_property.js","node_modules/@swc/helpers/src/_object_spread.js","node_modules/@swc/helpers/src/_to_consumable_array.js","node_modules/@swc/helpers/src/_array_without_holes.js","node_modules/@swc/helpers/src/_iterable_to_array.js","node_modules/@swc/helpers/src/_non_iterable_spread.js","node_modules/webrtc-adapter/src/js/utils.js","node_modules/webrtc-adapter/src/js/chrome/chrome_shim.js","node_modules/webrtc-adapter/src/js/chrome/getusermedia.js","node_modules/webrtc-adapter/src/js/edge/edge_shim.js","node_modules/sdp/sdp.js","node_modules/webrtc-adapter/src/js/edge/getusermedia.js","node_modules/webrtc-adapter/src/js/firefox/firefox_shim.js","node_modules/webrtc-adapter/src/js/firefox/getusermedia.js","node_modules/webrtc-adapter/src/js/safari/safari_shim.js","node_modules/webrtc-adapter/src/js/adapter_core.js","node_modules/getusermedia/getusermedia.js","node_modules/@epok.tech/gl-screen-triangle/index.js","node_modules/@epok.tech/fn-lists/range.js","node_modules/@epok.tech/fn-lists/reduce.js","node_modules/@epok.tech/fn-lists/map.js","node_modules/@epok.tech/fn-lists/each.js","node_modules/@epok.tech/fn-lists/wrap-index.js","demo/spread.frag.glsl","demo/index.js","node_modules/@epok.tech/gl-screen-triangle/uv-texture.vert.glsl","index.frag.glsl","demo/view.frag.glsl"],"sourcesContent":["export default function _defineProperty(obj, key, value) {\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n\n  return obj;\n}\n","import defineProperty from './_define_property';\n\nexport default function _objectSpread(target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = arguments[i] != null ? arguments[i] : {};\n    var ownKeys = Object.keys(source);\n\n    if (typeof Object.getOwnPropertySymbols === 'function') {\n      ownKeys = ownKeys.concat(Object.getOwnPropertySymbols(source).filter(function (sym) {\n        return Object.getOwnPropertyDescriptor(source, sym).enumerable;\n      }));\n    }\n\n    ownKeys.forEach(function (key) {\n      defineProperty(target, key, source[key]);\n    });\n  }\n\n  return target;\n}","import arrayWithoutHoles from './_array_without_holes';\nimport iterableToArray from './_iterable_to_array';\nimport nonIterableSpread from './_non_iterable_spread';\n\nexport default function _toConsumableArray(arr) {\n  return arrayWithoutHoles(arr) || iterableToArray(arr) || nonIterableSpread();\n}\n","export default function _arrayWithoutHoles(arr) {\n  if (Array.isArray(arr)) {\n    for (var i = 0, arr2 = new Array(arr.length); i < arr.length; i++) {\n      arr2[i] = arr[i];\n    }\n\n    return arr2;\n  }\n}\n","export default function _iterableToArray(iter) {\n  if (Symbol.iterator in Object(iter) || Object.prototype.toString.call(iter) === \"[object Arguments]\") return Array.from(iter);\n}\n","export default function _nonIterableSpread() {\n  throw new TypeError(\"Invalid attempt to spread non-iterable instance\");\n}\n","/*\n *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n /* eslint-env node */\n'use strict';\n\nvar logDisabled_ = true;\n\n// Utility methods.\nvar utils = {\n  disableLog: function(bool) {\n    if (typeof bool !== 'boolean') {\n      return new Error('Argument type: ' + typeof bool +\n          '. Please use a boolean.');\n    }\n    logDisabled_ = bool;\n    return (bool) ? 'adapter.js logging disabled' :\n        'adapter.js logging enabled';\n  },\n\n  log: function() {\n    if (typeof window === 'object') {\n      if (logDisabled_) {\n        return;\n      }\n      if (typeof console !== 'undefined' && typeof console.log === 'function') {\n        console.log.apply(console, arguments);\n      }\n    }\n  },\n\n  /**\n   * Extract browser version out of the provided user agent string.\n   *\n   * @param {!string} uastring userAgent string.\n   * @param {!string} expr Regular expression used as match criteria.\n   * @param {!number} pos position in the version string to be returned.\n   * @return {!number} browser version.\n   */\n  extractVersion: function(uastring, expr, pos) {\n    var match = uastring.match(expr);\n    return match && match.length >= pos && parseInt(match[pos], 10);\n  },\n\n  /**\n   * Browser detector.\n   *\n   * @return {object} result containing browser and version\n   *     properties.\n   */\n  detectBrowser: function() {\n    // Returned result object.\n    var result = {};\n    result.browser = null;\n    result.version = null;\n\n    // Fail early if it's not a browser\n    if (typeof window === 'undefined' || !window.navigator) {\n      result.browser = 'Not a browser.';\n      return result;\n    }\n\n    // Firefox.\n    if (navigator.mozGetUserMedia) {\n      result.browser = 'firefox';\n      result.version = this.extractVersion(navigator.userAgent,\n          /Firefox\\/([0-9]+)\\./, 1);\n\n    // all webkit-based browsers\n    } else if (navigator.webkitGetUserMedia) {\n      // Chrome, Chromium, Webview, Opera, all use the chrome shim for now\n      if (window.webkitRTCPeerConnection) {\n        result.browser = 'chrome';\n        result.version = this.extractVersion(navigator.userAgent,\n          /Chrom(e|ium)\\/([0-9]+)\\./, 2);\n\n      // Safari or unknown webkit-based\n      // for the time being Safari has support for MediaStreams but not webRTC\n      } else {\n        // Safari UA substrings of interest for reference:\n        // - webkit version:           AppleWebKit/602.1.25 (also used in Op,Cr)\n        // - safari UI version:        Version/9.0.3 (unique to Safari)\n        // - safari UI webkit version: Safari/601.4.4 (also used in Op,Cr)\n        //\n        // if the webkit version and safari UI webkit versions are equals,\n        // ... this is a stable version.\n        //\n        // only the internal webkit version is important today to know if\n        // media streams are supported\n        //\n        if (navigator.userAgent.match(/Version\\/(\\d+).(\\d+)/)) {\n          result.browser = 'safari';\n          result.version = this.extractVersion(navigator.userAgent,\n            /AppleWebKit\\/([0-9]+)\\./, 1);\n\n        // unknown webkit-based browser\n        } else {\n          result.browser = 'Unsupported webkit-based browser ' +\n              'with GUM support but no WebRTC support.';\n          return result;\n        }\n      }\n\n    // Edge.\n    } else if (navigator.mediaDevices &&\n        navigator.userAgent.match(/Edge\\/(\\d+).(\\d+)$/)) {\n      result.browser = 'edge';\n      result.version = this.extractVersion(navigator.userAgent,\n          /Edge\\/(\\d+).(\\d+)$/, 2);\n\n    // Default fallthrough: not supported.\n    } else {\n      result.browser = 'Not a supported browser.';\n      return result;\n    }\n\n    return result;\n  }\n};\n\n// Export.\nmodule.exports = {\n  log: utils.log,\n  disableLog: utils.disableLog,\n  browserDetails: utils.detectBrowser(),\n  extractVersion: utils.extractVersion\n};\n","\n/*\n *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n /* eslint-env node */\n'use strict';\nvar logging = require('../utils.js').log;\nvar browserDetails = require('../utils.js').browserDetails;\n\nvar chromeShim = {\n  shimMediaStream: function() {\n    window.MediaStream = window.MediaStream || window.webkitMediaStream;\n  },\n\n  shimOnTrack: function() {\n    if (typeof window === 'object' && window.RTCPeerConnection && !('ontrack' in\n        window.RTCPeerConnection.prototype)) {\n      Object.defineProperty(window.RTCPeerConnection.prototype, 'ontrack', {\n        get: function() {\n          return this._ontrack;\n        },\n        set: function(f) {\n          var self = this;\n          if (this._ontrack) {\n            this.removeEventListener('track', this._ontrack);\n            this.removeEventListener('addstream', this._ontrackpoly);\n          }\n          this.addEventListener('track', this._ontrack = f);\n          this.addEventListener('addstream', this._ontrackpoly = function(e) {\n            // onaddstream does not fire when a track is added to an existing\n            // stream. But stream.onaddtrack is implemented so we use that.\n            e.stream.addEventListener('addtrack', function(te) {\n              var event = new Event('track');\n              event.track = te.track;\n              event.receiver = {track: te.track};\n              event.streams = [e.stream];\n              self.dispatchEvent(event);\n            });\n            e.stream.getTracks().forEach(function(track) {\n              var event = new Event('track');\n              event.track = track;\n              event.receiver = {track: track};\n              event.streams = [e.stream];\n              this.dispatchEvent(event);\n            }.bind(this));\n          }.bind(this));\n        }\n      });\n    }\n  },\n\n  shimSourceObject: function() {\n    if (typeof window === 'object') {\n      if (window.HTMLMediaElement &&\n        !('srcObject' in window.HTMLMediaElement.prototype)) {\n        // Shim the srcObject property, once, when HTMLMediaElement is found.\n        Object.defineProperty(window.HTMLMediaElement.prototype, 'srcObject', {\n          get: function() {\n            return this._srcObject;\n          },\n          set: function(stream) {\n            var self = this;\n            // Use _srcObject as a private property for this shim\n            this._srcObject = stream;\n            if (this.src) {\n              URL.revokeObjectURL(this.src);\n            }\n\n            if (!stream) {\n              this.src = '';\n              return;\n            }\n            this.src = URL.createObjectURL(stream);\n            // We need to recreate the blob url when a track is added or\n            // removed. Doing it manually since we want to avoid a recursion.\n            stream.addEventListener('addtrack', function() {\n              if (self.src) {\n                URL.revokeObjectURL(self.src);\n              }\n              self.src = URL.createObjectURL(stream);\n            });\n            stream.addEventListener('removetrack', function() {\n              if (self.src) {\n                URL.revokeObjectURL(self.src);\n              }\n              self.src = URL.createObjectURL(stream);\n            });\n          }\n        });\n      }\n    }\n  },\n\n  shimPeerConnection: function() {\n    // The RTCPeerConnection object.\n    window.RTCPeerConnection = function(pcConfig, pcConstraints) {\n      // Translate iceTransportPolicy to iceTransports,\n      // see https://code.google.com/p/webrtc/issues/detail?id=4869\n      logging('PeerConnection');\n      if (pcConfig && pcConfig.iceTransportPolicy) {\n        pcConfig.iceTransports = pcConfig.iceTransportPolicy;\n      }\n\n      var pc = new webkitRTCPeerConnection(pcConfig, pcConstraints);\n      var origGetStats = pc.getStats.bind(pc);\n      pc.getStats = function(selector, successCallback, errorCallback) {\n        var self = this;\n        var args = arguments;\n\n        // If selector is a function then we are in the old style stats so just\n        // pass back the original getStats format to avoid breaking old users.\n        if (arguments.length > 0 && typeof selector === 'function') {\n          return origGetStats(selector, successCallback);\n        }\n\n        var fixChromeStats_ = function(response) {\n          var standardReport = {};\n          var reports = response.result();\n          reports.forEach(function(report) {\n            var standardStats = {\n              id: report.id,\n              timestamp: report.timestamp,\n              type: report.type\n            };\n            report.names().forEach(function(name) {\n              standardStats[name] = report.stat(name);\n            });\n            standardReport[standardStats.id] = standardStats;\n          });\n\n          return standardReport;\n        };\n\n        // shim getStats with maplike support\n        var makeMapStats = function(stats, legacyStats) {\n          var map = new Map(Object.keys(stats).map(function(key) {\n            return[key, stats[key]];\n          }));\n          legacyStats = legacyStats || stats;\n          Object.keys(legacyStats).forEach(function(key) {\n            map[key] = legacyStats[key];\n          });\n          return map;\n        };\n\n        if (arguments.length >= 2) {\n          var successCallbackWrapper_ = function(response) {\n            args[1](makeMapStats(fixChromeStats_(response)));\n          };\n\n          return origGetStats.apply(this, [successCallbackWrapper_,\n              arguments[0]]);\n        }\n\n        // promise-support\n        return new Promise(function(resolve, reject) {\n          if (args.length === 1 && typeof selector === 'object') {\n            origGetStats.apply(self, [\n              function(response) {\n                resolve(makeMapStats(fixChromeStats_(response)));\n              }, reject]);\n          } else {\n            // Preserve legacy chrome stats only on legacy access of stats obj\n            origGetStats.apply(self, [\n              function(response) {\n                resolve(makeMapStats(fixChromeStats_(response),\n                    response.result()));\n              }, reject]);\n          }\n        }).then(successCallback, errorCallback);\n      };\n\n      return pc;\n    };\n    window.RTCPeerConnection.prototype = webkitRTCPeerConnection.prototype;\n\n    // wrap static methods. Currently just generateCertificate.\n    if (webkitRTCPeerConnection.generateCertificate) {\n      Object.defineProperty(window.RTCPeerConnection, 'generateCertificate', {\n        get: function() {\n          return webkitRTCPeerConnection.generateCertificate;\n        }\n      });\n    }\n\n    ['createOffer', 'createAnswer'].forEach(function(method) {\n      var nativeMethod = webkitRTCPeerConnection.prototype[method];\n      webkitRTCPeerConnection.prototype[method] = function() {\n        var self = this;\n        if (arguments.length < 1 || (arguments.length === 1 &&\n            typeof arguments[0] === 'object')) {\n          var opts = arguments.length === 1 ? arguments[0] : undefined;\n          return new Promise(function(resolve, reject) {\n            nativeMethod.apply(self, [resolve, reject, opts]);\n          });\n        }\n        return nativeMethod.apply(this, arguments);\n      };\n    });\n\n    // add promise support -- natively available in Chrome 51\n    if (browserDetails.version < 51) {\n      ['setLocalDescription', 'setRemoteDescription', 'addIceCandidate']\n          .forEach(function(method) {\n            var nativeMethod = webkitRTCPeerConnection.prototype[method];\n            webkitRTCPeerConnection.prototype[method] = function() {\n              var args = arguments;\n              var self = this;\n              var promise = new Promise(function(resolve, reject) {\n                nativeMethod.apply(self, [args[0], resolve, reject]);\n              });\n              if (args.length < 2) {\n                return promise;\n              }\n              return promise.then(function() {\n                args[1].apply(null, []);\n              },\n              function(err) {\n                if (args.length >= 3) {\n                  args[2].apply(null, [err]);\n                }\n              });\n            };\n          });\n    }\n\n    // shim implicit creation of RTCSessionDescription/RTCIceCandidate\n    ['setLocalDescription', 'setRemoteDescription', 'addIceCandidate']\n        .forEach(function(method) {\n          var nativeMethod = webkitRTCPeerConnection.prototype[method];\n          webkitRTCPeerConnection.prototype[method] = function() {\n            arguments[0] = new ((method === 'addIceCandidate') ?\n                RTCIceCandidate : RTCSessionDescription)(arguments[0]);\n            return nativeMethod.apply(this, arguments);\n          };\n        });\n\n    // support for addIceCandidate(null or undefined)\n    var nativeAddIceCandidate =\n        RTCPeerConnection.prototype.addIceCandidate;\n    RTCPeerConnection.prototype.addIceCandidate = function() {\n      if (!arguments[0]) {\n        if (arguments[1]) {\n          arguments[1].apply(null);\n        }\n        return Promise.resolve();\n      }\n      return nativeAddIceCandidate.apply(this, arguments);\n    };\n  }\n};\n\n\n// Expose public methods.\nmodule.exports = {\n  shimMediaStream: chromeShim.shimMediaStream,\n  shimOnTrack: chromeShim.shimOnTrack,\n  shimSourceObject: chromeShim.shimSourceObject,\n  shimPeerConnection: chromeShim.shimPeerConnection,\n  shimGetUserMedia: require('./getusermedia')\n};\n","/*\n *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n /* eslint-env node */\n'use strict';\nvar logging = require('../utils.js').log;\n\n// Expose public methods.\nmodule.exports = function() {\n  var constraintsToChrome_ = function(c) {\n    if (typeof c !== 'object' || c.mandatory || c.optional) {\n      return c;\n    }\n    var cc = {};\n    Object.keys(c).forEach(function(key) {\n      if (key === 'require' || key === 'advanced' || key === 'mediaSource') {\n        return;\n      }\n      var r = (typeof c[key] === 'object') ? c[key] : {ideal: c[key]};\n      if (r.exact !== undefined && typeof r.exact === 'number') {\n        r.min = r.max = r.exact;\n      }\n      var oldname_ = function(prefix, name) {\n        if (prefix) {\n          return prefix + name.charAt(0).toUpperCase() + name.slice(1);\n        }\n        return (name === 'deviceId') ? 'sourceId' : name;\n      };\n      if (r.ideal !== undefined) {\n        cc.optional = cc.optional || [];\n        var oc = {};\n        if (typeof r.ideal === 'number') {\n          oc[oldname_('min', key)] = r.ideal;\n          cc.optional.push(oc);\n          oc = {};\n          oc[oldname_('max', key)] = r.ideal;\n          cc.optional.push(oc);\n        } else {\n          oc[oldname_('', key)] = r.ideal;\n          cc.optional.push(oc);\n        }\n      }\n      if (r.exact !== undefined && typeof r.exact !== 'number') {\n        cc.mandatory = cc.mandatory || {};\n        cc.mandatory[oldname_('', key)] = r.exact;\n      } else {\n        ['min', 'max'].forEach(function(mix) {\n          if (r[mix] !== undefined) {\n            cc.mandatory = cc.mandatory || {};\n            cc.mandatory[oldname_(mix, key)] = r[mix];\n          }\n        });\n      }\n    });\n    if (c.advanced) {\n      cc.optional = (cc.optional || []).concat(c.advanced);\n    }\n    return cc;\n  };\n\n  var shimConstraints_ = function(constraints, func) {\n    constraints = JSON.parse(JSON.stringify(constraints));\n    if (constraints && constraints.audio) {\n      constraints.audio = constraintsToChrome_(constraints.audio);\n    }\n    if (constraints && typeof constraints.video === 'object') {\n      // Shim facingMode for mobile, where it defaults to \"user\".\n      var face = constraints.video.facingMode;\n      face = face && ((typeof face === 'object') ? face : {ideal: face});\n\n      if ((face && (face.exact === 'user' || face.exact === 'environment' ||\n                    face.ideal === 'user' || face.ideal === 'environment')) &&\n          !(navigator.mediaDevices.getSupportedConstraints &&\n            navigator.mediaDevices.getSupportedConstraints().facingMode)) {\n        delete constraints.video.facingMode;\n        if (face.exact === 'environment' || face.ideal === 'environment') {\n          // Look for \"back\" in label, or use last cam (typically back cam).\n          return navigator.mediaDevices.enumerateDevices()\n          .then(function(devices) {\n            devices = devices.filter(function(d) {\n              return d.kind === 'videoinput';\n            });\n            var back = devices.find(function(d) {\n              return d.label.toLowerCase().indexOf('back') !== -1;\n            }) || (devices.length && devices[devices.length - 1]);\n            if (back) {\n              constraints.video.deviceId = face.exact ? {exact: back.deviceId} :\n                                                        {ideal: back.deviceId};\n            }\n            constraints.video = constraintsToChrome_(constraints.video);\n            logging('chrome: ' + JSON.stringify(constraints));\n            return func(constraints);\n          });\n        }\n      }\n      constraints.video = constraintsToChrome_(constraints.video);\n    }\n    logging('chrome: ' + JSON.stringify(constraints));\n    return func(constraints);\n  };\n\n  var shimError_ = function(e) {\n    return {\n      name: {\n        PermissionDeniedError: 'NotAllowedError',\n        ConstraintNotSatisfiedError: 'OverconstrainedError'\n      }[e.name] || e.name,\n      message: e.message,\n      constraint: e.constraintName,\n      toString: function() {\n        return this.name + (this.message && ': ') + this.message;\n      }\n    };\n  };\n\n  var getUserMedia_ = function(constraints, onSuccess, onError) {\n    shimConstraints_(constraints, function(c) {\n      navigator.webkitGetUserMedia(c, onSuccess, function(e) {\n        onError(shimError_(e));\n      });\n    });\n  };\n\n  navigator.getUserMedia = getUserMedia_;\n\n  // Returns the result of getUserMedia as a Promise.\n  var getUserMediaPromise_ = function(constraints) {\n    return new Promise(function(resolve, reject) {\n      navigator.getUserMedia(constraints, resolve, reject);\n    });\n  };\n\n  if (!navigator.mediaDevices) {\n    navigator.mediaDevices = {\n      getUserMedia: getUserMediaPromise_,\n      enumerateDevices: function() {\n        return new Promise(function(resolve) {\n          var kinds = {audio: 'audioinput', video: 'videoinput'};\n          return MediaStreamTrack.getSources(function(devices) {\n            resolve(devices.map(function(device) {\n              return {label: device.label,\n                      kind: kinds[device.kind],\n                      deviceId: device.id,\n                      groupId: ''};\n            }));\n          });\n        });\n      }\n    };\n  }\n\n  // A shim for getUserMedia method on the mediaDevices object.\n  // TODO(KaptenJansson) remove once implemented in Chrome stable.\n  if (!navigator.mediaDevices.getUserMedia) {\n    navigator.mediaDevices.getUserMedia = function(constraints) {\n      return getUserMediaPromise_(constraints);\n    };\n  } else {\n    // Even though Chrome 45 has navigator.mediaDevices and a getUserMedia\n    // function which returns a Promise, it does not accept spec-style\n    // constraints.\n    var origGetUserMedia = navigator.mediaDevices.getUserMedia.\n        bind(navigator.mediaDevices);\n    navigator.mediaDevices.getUserMedia = function(cs) {\n      return shimConstraints_(cs, function(c) {\n        return origGetUserMedia(c).then(function(stream) {\n          if (c.audio && !stream.getAudioTracks().length ||\n              c.video && !stream.getVideoTracks().length) {\n            stream.getTracks().forEach(function(track) {\n              track.stop();\n            });\n            throw new DOMException('', 'NotFoundError');\n          }\n          return stream;\n        }, function(e) {\n          return Promise.reject(shimError_(e));\n        });\n      });\n    };\n  }\n\n  // Dummy devicechange event methods.\n  // TODO(KaptenJansson) remove once implemented in Chrome stable.\n  if (typeof navigator.mediaDevices.addEventListener === 'undefined') {\n    navigator.mediaDevices.addEventListener = function() {\n      logging('Dummy mediaDevices.addEventListener called.');\n    };\n  }\n  if (typeof navigator.mediaDevices.removeEventListener === 'undefined') {\n    navigator.mediaDevices.removeEventListener = function() {\n      logging('Dummy mediaDevices.removeEventListener called.');\n    };\n  }\n};\n","/*\n *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n /* eslint-env node */\n'use strict';\n\nvar SDPUtils = require('sdp');\nvar browserDetails = require('../utils').browserDetails;\n\nvar edgeShim = {\n  shimPeerConnection: function() {\n    if (window.RTCIceGatherer) {\n      // ORTC defines an RTCIceCandidate object but no constructor.\n      // Not implemented in Edge.\n      if (!window.RTCIceCandidate) {\n        window.RTCIceCandidate = function(args) {\n          return args;\n        };\n      }\n      // ORTC does not have a session description object but\n      // other browsers (i.e. Chrome) that will support both PC and ORTC\n      // in the future might have this defined already.\n      if (!window.RTCSessionDescription) {\n        window.RTCSessionDescription = function(args) {\n          return args;\n        };\n      }\n      // this adds an additional event listener to MediaStrackTrack that signals\n      // when a tracks enabled property was changed.\n      var origMSTEnabled = Object.getOwnPropertyDescriptor(\n          MediaStreamTrack.prototype, 'enabled');\n      Object.defineProperty(MediaStreamTrack.prototype, 'enabled', {\n        set: function(value) {\n          origMSTEnabled.set.call(this, value);\n          var ev = new Event('enabled');\n          ev.enabled = value;\n          this.dispatchEvent(ev);\n        }\n      });\n    }\n\n    window.RTCPeerConnection = function(config) {\n      var self = this;\n\n      var _eventTarget = document.createDocumentFragment();\n      ['addEventListener', 'removeEventListener', 'dispatchEvent']\n          .forEach(function(method) {\n            self[method] = _eventTarget[method].bind(_eventTarget);\n          });\n\n      this.onicecandidate = null;\n      this.onaddstream = null;\n      this.ontrack = null;\n      this.onremovestream = null;\n      this.onsignalingstatechange = null;\n      this.oniceconnectionstatechange = null;\n      this.onnegotiationneeded = null;\n      this.ondatachannel = null;\n\n      this.localStreams = [];\n      this.remoteStreams = [];\n      this.getLocalStreams = function() {\n        return self.localStreams;\n      };\n      this.getRemoteStreams = function() {\n        return self.remoteStreams;\n      };\n\n      this.localDescription = new RTCSessionDescription({\n        type: '',\n        sdp: ''\n      });\n      this.remoteDescription = new RTCSessionDescription({\n        type: '',\n        sdp: ''\n      });\n      this.signalingState = 'stable';\n      this.iceConnectionState = 'new';\n      this.iceGatheringState = 'new';\n\n      this.iceOptions = {\n        gatherPolicy: 'all',\n        iceServers: []\n      };\n      if (config && config.iceTransportPolicy) {\n        switch (config.iceTransportPolicy) {\n          case 'all':\n          case 'relay':\n            this.iceOptions.gatherPolicy = config.iceTransportPolicy;\n            break;\n          case 'none':\n            // FIXME: remove once implementation and spec have added this.\n            throw new TypeError('iceTransportPolicy \"none\" not supported');\n          default:\n            // don't set iceTransportPolicy.\n            break;\n        }\n      }\n      this.usingBundle = config && config.bundlePolicy === 'max-bundle';\n\n      if (config && config.iceServers) {\n        // Edge does not like\n        // 1) stun:\n        // 2) turn: that does not have all of turn:host:port?transport=udp\n        // 3) turn: with ipv6 addresses\n        var iceServers = JSON.parse(JSON.stringify(config.iceServers));\n        this.iceOptions.iceServers = iceServers.filter(function(server) {\n          if (server && server.urls) {\n            var urls = server.urls;\n            if (typeof urls === 'string') {\n              urls = [urls];\n            }\n            urls = urls.filter(function(url) {\n              return (url.indexOf('turn:') === 0 &&\n                  url.indexOf('transport=udp') !== -1 &&\n                  url.indexOf('turn:[') === -1) ||\n                  (url.indexOf('stun:') === 0 &&\n                    browserDetails.version >= 14393);\n            })[0];\n            return !!urls;\n          }\n          return false;\n        });\n      }\n      this._config = config;\n\n      // per-track iceGathers, iceTransports, dtlsTransports, rtpSenders, ...\n      // everything that is needed to describe a SDP m-line.\n      this.transceivers = [];\n\n      // since the iceGatherer is currently created in createOffer but we\n      // must not emit candidates until after setLocalDescription we buffer\n      // them in this array.\n      this._localIceCandidatesBuffer = [];\n    };\n\n    window.RTCPeerConnection.prototype._emitBufferedCandidates = function() {\n      var self = this;\n      var sections = SDPUtils.splitSections(self.localDescription.sdp);\n      // FIXME: need to apply ice candidates in a way which is async but\n      // in-order\n      this._localIceCandidatesBuffer.forEach(function(event) {\n        var end = !event.candidate || Object.keys(event.candidate).length === 0;\n        if (end) {\n          for (var j = 1; j < sections.length; j++) {\n            if (sections[j].indexOf('\\r\\na=end-of-candidates\\r\\n') === -1) {\n              sections[j] += 'a=end-of-candidates\\r\\n';\n            }\n          }\n        } else if (event.candidate.candidate.indexOf('typ endOfCandidates')\n            === -1) {\n          sections[event.candidate.sdpMLineIndex + 1] +=\n              'a=' + event.candidate.candidate + '\\r\\n';\n        }\n        self.localDescription.sdp = sections.join('');\n        self.dispatchEvent(event);\n        if (self.onicecandidate !== null) {\n          self.onicecandidate(event);\n        }\n        if (!event.candidate && self.iceGatheringState !== 'complete') {\n          var complete = self.transceivers.every(function(transceiver) {\n            return transceiver.iceGatherer &&\n                transceiver.iceGatherer.state === 'completed';\n          });\n          if (complete) {\n            self.iceGatheringState = 'complete';\n          }\n        }\n      });\n      this._localIceCandidatesBuffer = [];\n    };\n\n    window.RTCPeerConnection.prototype.getConfiguration = function() {\n      return this._config;\n    };\n\n    window.RTCPeerConnection.prototype.addStream = function(stream) {\n      // Clone is necessary for local demos mostly, attaching directly\n      // to two different senders does not work (build 10547).\n      var clonedStream = stream.clone();\n      stream.getTracks().forEach(function(track, idx) {\n        var clonedTrack = clonedStream.getTracks()[idx];\n        track.addEventListener('enabled', function(event) {\n          clonedTrack.enabled = event.enabled;\n        });\n      });\n      this.localStreams.push(clonedStream);\n      this._maybeFireNegotiationNeeded();\n    };\n\n    window.RTCPeerConnection.prototype.removeStream = function(stream) {\n      var idx = this.localStreams.indexOf(stream);\n      if (idx > -1) {\n        this.localStreams.splice(idx, 1);\n        this._maybeFireNegotiationNeeded();\n      }\n    };\n\n    window.RTCPeerConnection.prototype.getSenders = function() {\n      return this.transceivers.filter(function(transceiver) {\n        return !!transceiver.rtpSender;\n      })\n      .map(function(transceiver) {\n        return transceiver.rtpSender;\n      });\n    };\n\n    window.RTCPeerConnection.prototype.getReceivers = function() {\n      return this.transceivers.filter(function(transceiver) {\n        return !!transceiver.rtpReceiver;\n      })\n      .map(function(transceiver) {\n        return transceiver.rtpReceiver;\n      });\n    };\n\n    // Determines the intersection of local and remote capabilities.\n    window.RTCPeerConnection.prototype._getCommonCapabilities =\n        function(localCapabilities, remoteCapabilities) {\n          var commonCapabilities = {\n            codecs: [],\n            headerExtensions: [],\n            fecMechanisms: []\n          };\n          localCapabilities.codecs.forEach(function(lCodec) {\n            for (var i = 0; i < remoteCapabilities.codecs.length; i++) {\n              var rCodec = remoteCapabilities.codecs[i];\n              if (lCodec.name.toLowerCase() === rCodec.name.toLowerCase() &&\n                  lCodec.clockRate === rCodec.clockRate) {\n                // number of channels is the highest common number of channels\n                rCodec.numChannels = Math.min(lCodec.numChannels,\n                    rCodec.numChannels);\n                // push rCodec so we reply with offerer payload type\n                commonCapabilities.codecs.push(rCodec);\n\n                // determine common feedback mechanisms\n                rCodec.rtcpFeedback = rCodec.rtcpFeedback.filter(function(fb) {\n                  for (var j = 0; j < lCodec.rtcpFeedback.length; j++) {\n                    if (lCodec.rtcpFeedback[j].type === fb.type &&\n                        lCodec.rtcpFeedback[j].parameter === fb.parameter) {\n                      return true;\n                    }\n                  }\n                  return false;\n                });\n                // FIXME: also need to determine .parameters\n                //  see https://github.com/openpeer/ortc/issues/569\n                break;\n              }\n            }\n          });\n\n          localCapabilities.headerExtensions\n              .forEach(function(lHeaderExtension) {\n                for (var i = 0; i < remoteCapabilities.headerExtensions.length;\n                     i++) {\n                  var rHeaderExtension = remoteCapabilities.headerExtensions[i];\n                  if (lHeaderExtension.uri === rHeaderExtension.uri) {\n                    commonCapabilities.headerExtensions.push(rHeaderExtension);\n                    break;\n                  }\n                }\n              });\n\n          // FIXME: fecMechanisms\n          return commonCapabilities;\n        };\n\n    // Create ICE gatherer, ICE transport and DTLS transport.\n    window.RTCPeerConnection.prototype._createIceAndDtlsTransports =\n        function(mid, sdpMLineIndex) {\n          var self = this;\n          var iceGatherer = new RTCIceGatherer(self.iceOptions);\n          var iceTransport = new RTCIceTransport(iceGatherer);\n          iceGatherer.onlocalcandidate = function(evt) {\n            var event = new Event('icecandidate');\n            event.candidate = {sdpMid: mid, sdpMLineIndex: sdpMLineIndex};\n\n            var cand = evt.candidate;\n            var end = !cand || Object.keys(cand).length === 0;\n            // Edge emits an empty object for RTCIceCandidateComplete\n            if (end) {\n              // polyfill since RTCIceGatherer.state is not implemented in\n              // Edge 10547 yet.\n              if (iceGatherer.state === undefined) {\n                iceGatherer.state = 'completed';\n              }\n\n              // Emit a candidate with type endOfCandidates to make the samples\n              // work. Edge requires addIceCandidate with this empty candidate\n              // to start checking. The real solution is to signal\n              // end-of-candidates to the other side when getting the null\n              // candidate but some apps (like the samples) don't do that.\n              event.candidate.candidate =\n                  'candidate:1 1 udp 1 0.0.0.0 9 typ endOfCandidates';\n            } else {\n              // RTCIceCandidate doesn't have a component, needs to be added\n              cand.component = iceTransport.component === 'RTCP' ? 2 : 1;\n              event.candidate.candidate = SDPUtils.writeCandidate(cand);\n            }\n\n            // update local description.\n            var sections = SDPUtils.splitSections(self.localDescription.sdp);\n            if (event.candidate.candidate.indexOf('typ endOfCandidates')\n                === -1) {\n              sections[event.candidate.sdpMLineIndex + 1] +=\n                  'a=' + event.candidate.candidate + '\\r\\n';\n            } else {\n              sections[event.candidate.sdpMLineIndex + 1] +=\n                  'a=end-of-candidates\\r\\n';\n            }\n            self.localDescription.sdp = sections.join('');\n\n            var complete = self.transceivers.every(function(transceiver) {\n              return transceiver.iceGatherer &&\n                  transceiver.iceGatherer.state === 'completed';\n            });\n\n            // Emit candidate if localDescription is set.\n            // Also emits null candidate when all gatherers are complete.\n            switch (self.iceGatheringState) {\n              case 'new':\n                self._localIceCandidatesBuffer.push(event);\n                if (end && complete) {\n                  self._localIceCandidatesBuffer.push(\n                      new Event('icecandidate'));\n                }\n                break;\n              case 'gathering':\n                self._emitBufferedCandidates();\n                self.dispatchEvent(event);\n                if (self.onicecandidate !== null) {\n                  self.onicecandidate(event);\n                }\n                if (complete) {\n                  self.dispatchEvent(new Event('icecandidate'));\n                  if (self.onicecandidate !== null) {\n                    self.onicecandidate(new Event('icecandidate'));\n                  }\n                  self.iceGatheringState = 'complete';\n                }\n                break;\n              case 'complete':\n                // should not happen... currently!\n                break;\n              default: // no-op.\n                break;\n            }\n          };\n          iceTransport.onicestatechange = function() {\n            self._updateConnectionState();\n          };\n\n          var dtlsTransport = new RTCDtlsTransport(iceTransport);\n          dtlsTransport.ondtlsstatechange = function() {\n            self._updateConnectionState();\n          };\n          dtlsTransport.onerror = function() {\n            // onerror does not set state to failed by itself.\n            dtlsTransport.state = 'failed';\n            self._updateConnectionState();\n          };\n\n          return {\n            iceGatherer: iceGatherer,\n            iceTransport: iceTransport,\n            dtlsTransport: dtlsTransport\n          };\n        };\n\n    // Start the RTP Sender and Receiver for a transceiver.\n    window.RTCPeerConnection.prototype._transceive = function(transceiver,\n        send, recv) {\n      var params = this._getCommonCapabilities(transceiver.localCapabilities,\n          transceiver.remoteCapabilities);\n      if (send && transceiver.rtpSender) {\n        params.encodings = transceiver.sendEncodingParameters;\n        params.rtcp = {\n          cname: SDPUtils.localCName\n        };\n        if (transceiver.recvEncodingParameters.length) {\n          params.rtcp.ssrc = transceiver.recvEncodingParameters[0].ssrc;\n        }\n        transceiver.rtpSender.send(params);\n      }\n      if (recv && transceiver.rtpReceiver) {\n        // remove RTX field in Edge 14942\n        if (transceiver.kind === 'video'\n            && transceiver.recvEncodingParameters) {\n          transceiver.recvEncodingParameters.forEach(function(p) {\n            delete p.rtx;\n          });\n        }\n        params.encodings = transceiver.recvEncodingParameters;\n        params.rtcp = {\n          cname: transceiver.cname\n        };\n        if (transceiver.sendEncodingParameters.length) {\n          params.rtcp.ssrc = transceiver.sendEncodingParameters[0].ssrc;\n        }\n        transceiver.rtpReceiver.receive(params);\n      }\n    };\n\n    window.RTCPeerConnection.prototype.setLocalDescription =\n        function(description) {\n          var self = this;\n          var sections;\n          var sessionpart;\n          if (description.type === 'offer') {\n            // FIXME: What was the purpose of this empty if statement?\n            // if (!this._pendingOffer) {\n            // } else {\n            if (this._pendingOffer) {\n              // VERY limited support for SDP munging. Limited to:\n              // * changing the order of codecs\n              sections = SDPUtils.splitSections(description.sdp);\n              sessionpart = sections.shift();\n              sections.forEach(function(mediaSection, sdpMLineIndex) {\n                var caps = SDPUtils.parseRtpParameters(mediaSection);\n                self._pendingOffer[sdpMLineIndex].localCapabilities = caps;\n              });\n              this.transceivers = this._pendingOffer;\n              delete this._pendingOffer;\n            }\n          } else if (description.type === 'answer') {\n            sections = SDPUtils.splitSections(self.remoteDescription.sdp);\n            sessionpart = sections.shift();\n            var isIceLite = SDPUtils.matchPrefix(sessionpart,\n                'a=ice-lite').length > 0;\n            sections.forEach(function(mediaSection, sdpMLineIndex) {\n              var transceiver = self.transceivers[sdpMLineIndex];\n              var iceGatherer = transceiver.iceGatherer;\n              var iceTransport = transceiver.iceTransport;\n              var dtlsTransport = transceiver.dtlsTransport;\n              var localCapabilities = transceiver.localCapabilities;\n              var remoteCapabilities = transceiver.remoteCapabilities;\n\n              var rejected = mediaSection.split('\\n', 1)[0]\n                  .split(' ', 2)[1] === '0';\n\n              if (!rejected && !transceiver.isDatachannel) {\n                var remoteIceParameters = SDPUtils.getIceParameters(\n                    mediaSection, sessionpart);\n                if (isIceLite) {\n                  var cands = SDPUtils.matchPrefix(mediaSection, 'a=candidate:')\n                  .map(function(cand) {\n                    return SDPUtils.parseCandidate(cand);\n                  })\n                  .filter(function(cand) {\n                    return cand.component === '1';\n                  });\n                  // ice-lite only includes host candidates in the SDP so we can\n                  // use setRemoteCandidates (which implies an\n                  // RTCIceCandidateComplete)\n                  if (cands.length) {\n                    iceTransport.setRemoteCandidates(cands);\n                  }\n                }\n                var remoteDtlsParameters = SDPUtils.getDtlsParameters(\n                    mediaSection, sessionpart);\n                if (isIceLite) {\n                  remoteDtlsParameters.role = 'server';\n                }\n\n                if (!self.usingBundle || sdpMLineIndex === 0) {\n                  iceTransport.start(iceGatherer, remoteIceParameters,\n                      isIceLite ? 'controlling' : 'controlled');\n                  dtlsTransport.start(remoteDtlsParameters);\n                }\n\n                // Calculate intersection of capabilities.\n                var params = self._getCommonCapabilities(localCapabilities,\n                    remoteCapabilities);\n\n                // Start the RTCRtpSender. The RTCRtpReceiver for this\n                // transceiver has already been started in setRemoteDescription.\n                self._transceive(transceiver,\n                    params.codecs.length > 0,\n                    false);\n              }\n            });\n          }\n\n          this.localDescription = {\n            type: description.type,\n            sdp: description.sdp\n          };\n          switch (description.type) {\n            case 'offer':\n              this._updateSignalingState('have-local-offer');\n              break;\n            case 'answer':\n              this._updateSignalingState('stable');\n              break;\n            default:\n              throw new TypeError('unsupported type \"' + description.type +\n                  '\"');\n          }\n\n          // If a success callback was provided, emit ICE candidates after it\n          // has been executed. Otherwise, emit callback after the Promise is\n          // resolved.\n          var hasCallback = arguments.length > 1 &&\n            typeof arguments[1] === 'function';\n          if (hasCallback) {\n            var cb = arguments[1];\n            window.setTimeout(function() {\n              cb();\n              if (self.iceGatheringState === 'new') {\n                self.iceGatheringState = 'gathering';\n              }\n              self._emitBufferedCandidates();\n            }, 0);\n          }\n          var p = Promise.resolve();\n          p.then(function() {\n            if (!hasCallback) {\n              if (self.iceGatheringState === 'new') {\n                self.iceGatheringState = 'gathering';\n              }\n              // Usually candidates will be emitted earlier.\n              window.setTimeout(self._emitBufferedCandidates.bind(self), 500);\n            }\n          });\n          return p;\n        };\n\n    window.RTCPeerConnection.prototype.setRemoteDescription =\n        function(description) {\n          var self = this;\n          var stream = new MediaStream();\n          var receiverList = [];\n          var sections = SDPUtils.splitSections(description.sdp);\n          var sessionpart = sections.shift();\n          var isIceLite = SDPUtils.matchPrefix(sessionpart,\n              'a=ice-lite').length > 0;\n          this.usingBundle = SDPUtils.matchPrefix(sessionpart,\n              'a=group:BUNDLE ').length > 0;\n          sections.forEach(function(mediaSection, sdpMLineIndex) {\n            var lines = SDPUtils.splitLines(mediaSection);\n            var mline = lines[0].substr(2).split(' ');\n            var kind = mline[0];\n            var rejected = mline[1] === '0';\n            var direction = SDPUtils.getDirection(mediaSection, sessionpart);\n\n            var mid = SDPUtils.matchPrefix(mediaSection, 'a=mid:');\n            if (mid.length) {\n              mid = mid[0].substr(6);\n            } else {\n              mid = SDPUtils.generateIdentifier();\n            }\n\n            // Reject datachannels which are not implemented yet.\n            if (kind === 'application' && mline[2] === 'DTLS/SCTP') {\n              self.transceivers[sdpMLineIndex] = {\n                mid: mid,\n                isDatachannel: true\n              };\n              return;\n            }\n\n            var transceiver;\n            var iceGatherer;\n            var iceTransport;\n            var dtlsTransport;\n            var rtpSender;\n            var rtpReceiver;\n            var sendEncodingParameters;\n            var recvEncodingParameters;\n            var localCapabilities;\n\n            var track;\n            // FIXME: ensure the mediaSection has rtcp-mux set.\n            var remoteCapabilities = SDPUtils.parseRtpParameters(mediaSection);\n            var remoteIceParameters;\n            var remoteDtlsParameters;\n            if (!rejected) {\n              remoteIceParameters = SDPUtils.getIceParameters(mediaSection,\n                  sessionpart);\n              remoteDtlsParameters = SDPUtils.getDtlsParameters(mediaSection,\n                  sessionpart);\n              remoteDtlsParameters.role = 'client';\n            }\n            recvEncodingParameters =\n                SDPUtils.parseRtpEncodingParameters(mediaSection);\n\n            var cname;\n            // Gets the first SSRC. Note that with RTX there might be multiple\n            // SSRCs.\n            var remoteSsrc = SDPUtils.matchPrefix(mediaSection, 'a=ssrc:')\n                .map(function(line) {\n                  return SDPUtils.parseSsrcMedia(line);\n                })\n                .filter(function(obj) {\n                  return obj.attribute === 'cname';\n                })[0];\n            if (remoteSsrc) {\n              cname = remoteSsrc.value;\n            }\n\n            var isComplete = SDPUtils.matchPrefix(mediaSection,\n                'a=end-of-candidates', sessionpart).length > 0;\n            var cands = SDPUtils.matchPrefix(mediaSection, 'a=candidate:')\n                .map(function(cand) {\n                  return SDPUtils.parseCandidate(cand);\n                })\n                .filter(function(cand) {\n                  return cand.component === '1';\n                });\n            if (description.type === 'offer' && !rejected) {\n              var transports = self.usingBundle && sdpMLineIndex > 0 ? {\n                iceGatherer: self.transceivers[0].iceGatherer,\n                iceTransport: self.transceivers[0].iceTransport,\n                dtlsTransport: self.transceivers[0].dtlsTransport\n              } : self._createIceAndDtlsTransports(mid, sdpMLineIndex);\n\n              if (isComplete) {\n                transports.iceTransport.setRemoteCandidates(cands);\n              }\n\n              localCapabilities = RTCRtpReceiver.getCapabilities(kind);\n\n              // filter RTX until additional stuff needed for RTX is implemented\n              // in adapter.js\n              localCapabilities.codecs = localCapabilities.codecs.filter(\n                  function(codec) {\n                    return codec.name !== 'rtx';\n                  });\n\n              sendEncodingParameters = [{\n                ssrc: (2 * sdpMLineIndex + 2) * 1001\n              }];\n\n              rtpReceiver = new RTCRtpReceiver(transports.dtlsTransport, kind);\n\n              track = rtpReceiver.track;\n              receiverList.push([track, rtpReceiver]);\n              // FIXME: not correct when there are multiple streams but that is\n              // not currently supported in this shim.\n              stream.addTrack(track);\n\n              // FIXME: look at direction.\n              if (self.localStreams.length > 0 &&\n                  self.localStreams[0].getTracks().length >= sdpMLineIndex) {\n                var localTrack;\n                if (kind === 'audio') {\n                  localTrack = self.localStreams[0].getAudioTracks()[0];\n                } else if (kind === 'video') {\n                  localTrack = self.localStreams[0].getVideoTracks()[0];\n                }\n                if (localTrack) {\n                  rtpSender = new RTCRtpSender(localTrack,\n                      transports.dtlsTransport);\n                }\n              }\n\n              self.transceivers[sdpMLineIndex] = {\n                iceGatherer: transports.iceGatherer,\n                iceTransport: transports.iceTransport,\n                dtlsTransport: transports.dtlsTransport,\n                localCapabilities: localCapabilities,\n                remoteCapabilities: remoteCapabilities,\n                rtpSender: rtpSender,\n                rtpReceiver: rtpReceiver,\n                kind: kind,\n                mid: mid,\n                cname: cname,\n                sendEncodingParameters: sendEncodingParameters,\n                recvEncodingParameters: recvEncodingParameters\n              };\n              // Start the RTCRtpReceiver now. The RTPSender is started in\n              // setLocalDescription.\n              self._transceive(self.transceivers[sdpMLineIndex],\n                  false,\n                  direction === 'sendrecv' || direction === 'sendonly');\n            } else if (description.type === 'answer' && !rejected) {\n              transceiver = self.transceivers[sdpMLineIndex];\n              iceGatherer = transceiver.iceGatherer;\n              iceTransport = transceiver.iceTransport;\n              dtlsTransport = transceiver.dtlsTransport;\n              rtpSender = transceiver.rtpSender;\n              rtpReceiver = transceiver.rtpReceiver;\n              sendEncodingParameters = transceiver.sendEncodingParameters;\n              localCapabilities = transceiver.localCapabilities;\n\n              self.transceivers[sdpMLineIndex].recvEncodingParameters =\n                  recvEncodingParameters;\n              self.transceivers[sdpMLineIndex].remoteCapabilities =\n                  remoteCapabilities;\n              self.transceivers[sdpMLineIndex].cname = cname;\n\n              if ((isIceLite || isComplete) && cands.length) {\n                iceTransport.setRemoteCandidates(cands);\n              }\n              if (!self.usingBundle || sdpMLineIndex === 0) {\n                iceTransport.start(iceGatherer, remoteIceParameters,\n                    'controlling');\n                dtlsTransport.start(remoteDtlsParameters);\n              }\n\n              self._transceive(transceiver,\n                  direction === 'sendrecv' || direction === 'recvonly',\n                  direction === 'sendrecv' || direction === 'sendonly');\n\n              if (rtpReceiver &&\n                  (direction === 'sendrecv' || direction === 'sendonly')) {\n                track = rtpReceiver.track;\n                receiverList.push([track, rtpReceiver]);\n                stream.addTrack(track);\n              } else {\n                // FIXME: actually the receiver should be created later.\n                delete transceiver.rtpReceiver;\n              }\n            }\n          });\n\n          this.remoteDescription = {\n            type: description.type,\n            sdp: description.sdp\n          };\n          switch (description.type) {\n            case 'offer':\n              this._updateSignalingState('have-remote-offer');\n              break;\n            case 'answer':\n              this._updateSignalingState('stable');\n              break;\n            default:\n              throw new TypeError('unsupported type \"' + description.type +\n                  '\"');\n          }\n          if (stream.getTracks().length) {\n            self.remoteStreams.push(stream);\n            window.setTimeout(function() {\n              var event = new Event('addstream');\n              event.stream = stream;\n              self.dispatchEvent(event);\n              if (self.onaddstream !== null) {\n                window.setTimeout(function() {\n                  self.onaddstream(event);\n                }, 0);\n              }\n\n              receiverList.forEach(function(item) {\n                var track = item[0];\n                var receiver = item[1];\n                var trackEvent = new Event('track');\n                trackEvent.track = track;\n                trackEvent.receiver = receiver;\n                trackEvent.streams = [stream];\n                self.dispatchEvent(event);\n                if (self.ontrack !== null) {\n                  window.setTimeout(function() {\n                    self.ontrack(trackEvent);\n                  }, 0);\n                }\n              });\n            }, 0);\n          }\n          if (arguments.length > 1 && typeof arguments[1] === 'function') {\n            window.setTimeout(arguments[1], 0);\n          }\n          return Promise.resolve();\n        };\n\n    window.RTCPeerConnection.prototype.close = function() {\n      this.transceivers.forEach(function(transceiver) {\n        /* not yet\n        if (transceiver.iceGatherer) {\n          transceiver.iceGatherer.close();\n        }\n        */\n        if (transceiver.iceTransport) {\n          transceiver.iceTransport.stop();\n        }\n        if (transceiver.dtlsTransport) {\n          transceiver.dtlsTransport.stop();\n        }\n        if (transceiver.rtpSender) {\n          transceiver.rtpSender.stop();\n        }\n        if (transceiver.rtpReceiver) {\n          transceiver.rtpReceiver.stop();\n        }\n      });\n      // FIXME: clean up tracks, local streams, remote streams, etc\n      this._updateSignalingState('closed');\n    };\n\n    // Update the signaling state.\n    window.RTCPeerConnection.prototype._updateSignalingState =\n        function(newState) {\n          this.signalingState = newState;\n          var event = new Event('signalingstatechange');\n          this.dispatchEvent(event);\n          if (this.onsignalingstatechange !== null) {\n            this.onsignalingstatechange(event);\n          }\n        };\n\n    // Determine whether to fire the negotiationneeded event.\n    window.RTCPeerConnection.prototype._maybeFireNegotiationNeeded =\n        function() {\n          // Fire away (for now).\n          var event = new Event('negotiationneeded');\n          this.dispatchEvent(event);\n          if (this.onnegotiationneeded !== null) {\n            this.onnegotiationneeded(event);\n          }\n        };\n\n    // Update the connection state.\n    window.RTCPeerConnection.prototype._updateConnectionState = function() {\n      var self = this;\n      var newState;\n      var states = {\n        'new': 0,\n        closed: 0,\n        connecting: 0,\n        checking: 0,\n        connected: 0,\n        completed: 0,\n        failed: 0\n      };\n      this.transceivers.forEach(function(transceiver) {\n        states[transceiver.iceTransport.state]++;\n        states[transceiver.dtlsTransport.state]++;\n      });\n      // ICETransport.completed and connected are the same for this purpose.\n      states.connected += states.completed;\n\n      newState = 'new';\n      if (states.failed > 0) {\n        newState = 'failed';\n      } else if (states.connecting > 0 || states.checking > 0) {\n        newState = 'connecting';\n      } else if (states.disconnected > 0) {\n        newState = 'disconnected';\n      } else if (states.new > 0) {\n        newState = 'new';\n      } else if (states.connected > 0 || states.completed > 0) {\n        newState = 'connected';\n      }\n\n      if (newState !== self.iceConnectionState) {\n        self.iceConnectionState = newState;\n        var event = new Event('iceconnectionstatechange');\n        this.dispatchEvent(event);\n        if (this.oniceconnectionstatechange !== null) {\n          this.oniceconnectionstatechange(event);\n        }\n      }\n    };\n\n    window.RTCPeerConnection.prototype.createOffer = function() {\n      var self = this;\n      if (this._pendingOffer) {\n        throw new Error('createOffer called while there is a pending offer.');\n      }\n      var offerOptions;\n      if (arguments.length === 1 && typeof arguments[0] !== 'function') {\n        offerOptions = arguments[0];\n      } else if (arguments.length === 3) {\n        offerOptions = arguments[2];\n      }\n\n      var tracks = [];\n      var numAudioTracks = 0;\n      var numVideoTracks = 0;\n      // Default to sendrecv.\n      if (this.localStreams.length) {\n        numAudioTracks = this.localStreams[0].getAudioTracks().length;\n        numVideoTracks = this.localStreams[0].getVideoTracks().length;\n      }\n      // Determine number of audio and video tracks we need to send/recv.\n      if (offerOptions) {\n        // Reject Chrome legacy constraints.\n        if (offerOptions.mandatory || offerOptions.optional) {\n          throw new TypeError(\n              'Legacy mandatory/optional constraints not supported.');\n        }\n        if (offerOptions.offerToReceiveAudio !== undefined) {\n          numAudioTracks = offerOptions.offerToReceiveAudio;\n        }\n        if (offerOptions.offerToReceiveVideo !== undefined) {\n          numVideoTracks = offerOptions.offerToReceiveVideo;\n        }\n      }\n      if (this.localStreams.length) {\n        // Push local streams.\n        this.localStreams[0].getTracks().forEach(function(track) {\n          tracks.push({\n            kind: track.kind,\n            track: track,\n            wantReceive: track.kind === 'audio' ?\n                numAudioTracks > 0 : numVideoTracks > 0\n          });\n          if (track.kind === 'audio') {\n            numAudioTracks--;\n          } else if (track.kind === 'video') {\n            numVideoTracks--;\n          }\n        });\n      }\n      // Create M-lines for recvonly streams.\n      while (numAudioTracks > 0 || numVideoTracks > 0) {\n        if (numAudioTracks > 0) {\n          tracks.push({\n            kind: 'audio',\n            wantReceive: true\n          });\n          numAudioTracks--;\n        }\n        if (numVideoTracks > 0) {\n          tracks.push({\n            kind: 'video',\n            wantReceive: true\n          });\n          numVideoTracks--;\n        }\n      }\n\n      var sdp = SDPUtils.writeSessionBoilerplate();\n      var transceivers = [];\n      tracks.forEach(function(mline, sdpMLineIndex) {\n        // For each track, create an ice gatherer, ice transport,\n        // dtls transport, potentially rtpsender and rtpreceiver.\n        var track = mline.track;\n        var kind = mline.kind;\n        var mid = SDPUtils.generateIdentifier();\n\n        var transports = self.usingBundle && sdpMLineIndex > 0 ? {\n          iceGatherer: transceivers[0].iceGatherer,\n          iceTransport: transceivers[0].iceTransport,\n          dtlsTransport: transceivers[0].dtlsTransport\n        } : self._createIceAndDtlsTransports(mid, sdpMLineIndex);\n\n        var localCapabilities = RTCRtpSender.getCapabilities(kind);\n        // filter RTX until additional stuff needed for RTX is implemented\n        // in adapter.js\n        localCapabilities.codecs = localCapabilities.codecs.filter(\n            function(codec) {\n              return codec.name !== 'rtx';\n            });\n        localCapabilities.codecs.forEach(function(codec) {\n          // work around https://bugs.chromium.org/p/webrtc/issues/detail?id=6552\n          // by adding level-asymmetry-allowed=1\n          if (codec.name === 'H264' &&\n              codec.parameters['level-asymmetry-allowed'] === undefined) {\n            codec.parameters['level-asymmetry-allowed'] = '1';\n          }\n        });\n\n        var rtpSender;\n        var rtpReceiver;\n\n        // generate an ssrc now, to be used later in rtpSender.send\n        var sendEncodingParameters = [{\n          ssrc: (2 * sdpMLineIndex + 1) * 1001\n        }];\n        if (track) {\n          rtpSender = new RTCRtpSender(track, transports.dtlsTransport);\n        }\n\n        if (mline.wantReceive) {\n          rtpReceiver = new RTCRtpReceiver(transports.dtlsTransport, kind);\n        }\n\n        transceivers[sdpMLineIndex] = {\n          iceGatherer: transports.iceGatherer,\n          iceTransport: transports.iceTransport,\n          dtlsTransport: transports.dtlsTransport,\n          localCapabilities: localCapabilities,\n          remoteCapabilities: null,\n          rtpSender: rtpSender,\n          rtpReceiver: rtpReceiver,\n          kind: kind,\n          mid: mid,\n          sendEncodingParameters: sendEncodingParameters,\n          recvEncodingParameters: null\n        };\n      });\n      if (this.usingBundle) {\n        sdp += 'a=group:BUNDLE ' + transceivers.map(function(t) {\n          return t.mid;\n        }).join(' ') + '\\r\\n';\n      }\n      tracks.forEach(function(mline, sdpMLineIndex) {\n        var transceiver = transceivers[sdpMLineIndex];\n        sdp += SDPUtils.writeMediaSection(transceiver,\n            transceiver.localCapabilities, 'offer', self.localStreams[0]);\n      });\n\n      this._pendingOffer = transceivers;\n      var desc = new RTCSessionDescription({\n        type: 'offer',\n        sdp: sdp\n      });\n      if (arguments.length && typeof arguments[0] === 'function') {\n        window.setTimeout(arguments[0], 0, desc);\n      }\n      return Promise.resolve(desc);\n    };\n\n    window.RTCPeerConnection.prototype.createAnswer = function() {\n      var self = this;\n\n      var sdp = SDPUtils.writeSessionBoilerplate();\n      if (this.usingBundle) {\n        sdp += 'a=group:BUNDLE ' + this.transceivers.map(function(t) {\n          return t.mid;\n        }).join(' ') + '\\r\\n';\n      }\n      this.transceivers.forEach(function(transceiver) {\n        if (transceiver.isDatachannel) {\n          sdp += 'm=application 0 DTLS/SCTP 5000\\r\\n' +\n              'c=IN IP4 0.0.0.0\\r\\n' +\n              'a=mid:' + transceiver.mid + '\\r\\n';\n          return;\n        }\n        // Calculate intersection of capabilities.\n        var commonCapabilities = self._getCommonCapabilities(\n            transceiver.localCapabilities,\n            transceiver.remoteCapabilities);\n\n        sdp += SDPUtils.writeMediaSection(transceiver, commonCapabilities,\n            'answer', self.localStreams[0]);\n      });\n\n      var desc = new RTCSessionDescription({\n        type: 'answer',\n        sdp: sdp\n      });\n      if (arguments.length && typeof arguments[0] === 'function') {\n        window.setTimeout(arguments[0], 0, desc);\n      }\n      return Promise.resolve(desc);\n    };\n\n    window.RTCPeerConnection.prototype.addIceCandidate = function(candidate) {\n      if (!candidate) {\n        this.transceivers.forEach(function(transceiver) {\n          transceiver.iceTransport.addRemoteCandidate({});\n        });\n      } else {\n        var mLineIndex = candidate.sdpMLineIndex;\n        if (candidate.sdpMid) {\n          for (var i = 0; i < this.transceivers.length; i++) {\n            if (this.transceivers[i].mid === candidate.sdpMid) {\n              mLineIndex = i;\n              break;\n            }\n          }\n        }\n        var transceiver = this.transceivers[mLineIndex];\n        if (transceiver) {\n          var cand = Object.keys(candidate.candidate).length > 0 ?\n              SDPUtils.parseCandidate(candidate.candidate) : {};\n          // Ignore Chrome's invalid candidates since Edge does not like them.\n          if (cand.protocol === 'tcp' && (cand.port === 0 || cand.port === 9)) {\n            return;\n          }\n          // Ignore RTCP candidates, we assume RTCP-MUX.\n          if (cand.component !== '1') {\n            return;\n          }\n          // A dirty hack to make samples work.\n          if (cand.type === 'endOfCandidates') {\n            cand = {};\n          }\n          transceiver.iceTransport.addRemoteCandidate(cand);\n\n          // update the remoteDescription.\n          var sections = SDPUtils.splitSections(this.remoteDescription.sdp);\n          sections[mLineIndex + 1] += (cand.type ? candidate.candidate.trim()\n              : 'a=end-of-candidates') + '\\r\\n';\n          this.remoteDescription.sdp = sections.join('');\n        }\n      }\n      if (arguments.length > 1 && typeof arguments[1] === 'function') {\n        window.setTimeout(arguments[1], 0);\n      }\n      return Promise.resolve();\n    };\n\n    window.RTCPeerConnection.prototype.getStats = function() {\n      var promises = [];\n      this.transceivers.forEach(function(transceiver) {\n        ['rtpSender', 'rtpReceiver', 'iceGatherer', 'iceTransport',\n            'dtlsTransport'].forEach(function(method) {\n              if (transceiver[method]) {\n                promises.push(transceiver[method].getStats());\n              }\n            });\n      });\n      var cb = arguments.length > 1 && typeof arguments[1] === 'function' &&\n          arguments[1];\n      return new Promise(function(resolve) {\n        // shim getStats with maplike support\n        var results = new Map();\n        Promise.all(promises).then(function(res) {\n          res.forEach(function(result) {\n            Object.keys(result).forEach(function(id) {\n              results.set(id, result[id]);\n              results[id] = result[id];\n            });\n          });\n          if (cb) {\n            window.setTimeout(cb, 0, results);\n          }\n          resolve(results);\n        });\n      });\n    };\n  }\n};\n\n// Expose public methods.\nmodule.exports = {\n  shimPeerConnection: edgeShim.shimPeerConnection,\n  shimGetUserMedia: require('./getusermedia')\n};\n"," /* eslint-env node */\n'use strict';\n\n// SDP helpers.\nvar SDPUtils = {};\n\n// Generate an alphanumeric identifier for cname or mids.\n// TODO: use UUIDs instead? https://gist.github.com/jed/982883\nSDPUtils.generateIdentifier = function() {\n  return Math.random().toString(36).substr(2, 10);\n};\n\n// The RTCP CNAME used by all peerconnections from the same JS.\nSDPUtils.localCName = SDPUtils.generateIdentifier();\n\n// Splits SDP into lines, dealing with both CRLF and LF.\nSDPUtils.splitLines = function(blob) {\n  return blob.trim().split('\\n').map(function(line) {\n    return line.trim();\n  });\n};\n// Splits SDP into sessionpart and mediasections. Ensures CRLF.\nSDPUtils.splitSections = function(blob) {\n  var parts = blob.split('\\nm=');\n  return parts.map(function(part, index) {\n    return (index > 0 ? 'm=' + part : part).trim() + '\\r\\n';\n  });\n};\n\n// Returns lines that start with a certain prefix.\nSDPUtils.matchPrefix = function(blob, prefix) {\n  return SDPUtils.splitLines(blob).filter(function(line) {\n    return line.indexOf(prefix) === 0;\n  });\n};\n\n// Parses an ICE candidate line. Sample input:\n// candidate:702786350 2 udp 41819902 8.8.8.8 60769 typ relay raddr 8.8.8.8\n// rport 55996\"\nSDPUtils.parseCandidate = function(line) {\n  var parts;\n  // Parse both variants.\n  if (line.indexOf('a=candidate:') === 0) {\n    parts = line.substring(12).split(' ');\n  } else {\n    parts = line.substring(10).split(' ');\n  }\n\n  var candidate = {\n    foundation: parts[0],\n    component: parts[1],\n    protocol: parts[2].toLowerCase(),\n    priority: parseInt(parts[3], 10),\n    ip: parts[4],\n    port: parseInt(parts[5], 10),\n    // skip parts[6] == 'typ'\n    type: parts[7]\n  };\n\n  for (var i = 8; i < parts.length; i += 2) {\n    switch (parts[i]) {\n      case 'raddr':\n        candidate.relatedAddress = parts[i + 1];\n        break;\n      case 'rport':\n        candidate.relatedPort = parseInt(parts[i + 1], 10);\n        break;\n      case 'tcptype':\n        candidate.tcpType = parts[i + 1];\n        break;\n      default: // extension handling, in particular ufrag\n        candidate[parts[i]] = parts[i + 1];\n        break;\n    }\n  }\n  return candidate;\n};\n\n// Translates a candidate object into SDP candidate attribute.\nSDPUtils.writeCandidate = function(candidate) {\n  var sdp = [];\n  sdp.push(candidate.foundation);\n  sdp.push(candidate.component);\n  sdp.push(candidate.protocol.toUpperCase());\n  sdp.push(candidate.priority);\n  sdp.push(candidate.ip);\n  sdp.push(candidate.port);\n\n  var type = candidate.type;\n  sdp.push('typ');\n  sdp.push(type);\n  if (type !== 'host' && candidate.relatedAddress &&\n      candidate.relatedPort) {\n    sdp.push('raddr');\n    sdp.push(candidate.relatedAddress); // was: relAddr\n    sdp.push('rport');\n    sdp.push(candidate.relatedPort); // was: relPort\n  }\n  if (candidate.tcpType && candidate.protocol.toLowerCase() === 'tcp') {\n    sdp.push('tcptype');\n    sdp.push(candidate.tcpType);\n  }\n  return 'candidate:' + sdp.join(' ');\n};\n\n// Parses an ice-options line, returns an array of option tags.\n// a=ice-options:foo bar\nSDPUtils.parseIceOptions = function(line) {\n  return line.substr(14).split(' ');\n}\n\n// Parses an rtpmap line, returns RTCRtpCoddecParameters. Sample input:\n// a=rtpmap:111 opus/48000/2\nSDPUtils.parseRtpMap = function(line) {\n  var parts = line.substr(9).split(' ');\n  var parsed = {\n    payloadType: parseInt(parts.shift(), 10) // was: id\n  };\n\n  parts = parts[0].split('/');\n\n  parsed.name = parts[0];\n  parsed.clockRate = parseInt(parts[1], 10); // was: clockrate\n  // was: channels\n  parsed.numChannels = parts.length === 3 ? parseInt(parts[2], 10) : 1;\n  return parsed;\n};\n\n// Generate an a=rtpmap line from RTCRtpCodecCapability or\n// RTCRtpCodecParameters.\nSDPUtils.writeRtpMap = function(codec) {\n  var pt = codec.payloadType;\n  if (codec.preferredPayloadType !== undefined) {\n    pt = codec.preferredPayloadType;\n  }\n  return 'a=rtpmap:' + pt + ' ' + codec.name + '/' + codec.clockRate +\n      (codec.numChannels !== 1 ? '/' + codec.numChannels : '') + '\\r\\n';\n};\n\n// Parses an a=extmap line (headerextension from RFC 5285). Sample input:\n// a=extmap:2 urn:ietf:params:rtp-hdrext:toffset\n// a=extmap:2/sendonly urn:ietf:params:rtp-hdrext:toffset\nSDPUtils.parseExtmap = function(line) {\n  var parts = line.substr(9).split(' ');\n  return {\n    id: parseInt(parts[0], 10),\n    direction: parts[0].indexOf('/') > 0 ? parts[0].split('/')[1] : 'sendrecv',\n    uri: parts[1]\n  };\n};\n\n// Generates a=extmap line from RTCRtpHeaderExtensionParameters or\n// RTCRtpHeaderExtension.\nSDPUtils.writeExtmap = function(headerExtension) {\n  return 'a=extmap:' + (headerExtension.id || headerExtension.preferredId) +\n      (headerExtension.direction && headerExtension.direction !== 'sendrecv'\n          ? '/' + headerExtension.direction\n          : '') +\n      ' ' + headerExtension.uri + '\\r\\n';\n};\n\n// Parses an ftmp line, returns dictionary. Sample input:\n// a=fmtp:96 vbr=on;cng=on\n// Also deals with vbr=on; cng=on\nSDPUtils.parseFmtp = function(line) {\n  var parsed = {};\n  var kv;\n  var parts = line.substr(line.indexOf(' ') + 1).split(';');\n  for (var j = 0; j < parts.length; j++) {\n    kv = parts[j].trim().split('=');\n    parsed[kv[0].trim()] = kv[1];\n  }\n  return parsed;\n};\n\n// Generates an a=ftmp line from RTCRtpCodecCapability or RTCRtpCodecParameters.\nSDPUtils.writeFmtp = function(codec) {\n  var line = '';\n  var pt = codec.payloadType;\n  if (codec.preferredPayloadType !== undefined) {\n    pt = codec.preferredPayloadType;\n  }\n  if (codec.parameters && Object.keys(codec.parameters).length) {\n    var params = [];\n    Object.keys(codec.parameters).forEach(function(param) {\n      params.push(param + '=' + codec.parameters[param]);\n    });\n    line += 'a=fmtp:' + pt + ' ' + params.join(';') + '\\r\\n';\n  }\n  return line;\n};\n\n// Parses an rtcp-fb line, returns RTCPRtcpFeedback object. Sample input:\n// a=rtcp-fb:98 nack rpsi\nSDPUtils.parseRtcpFb = function(line) {\n  var parts = line.substr(line.indexOf(' ') + 1).split(' ');\n  return {\n    type: parts.shift(),\n    parameter: parts.join(' ')\n  };\n};\n// Generate a=rtcp-fb lines from RTCRtpCodecCapability or RTCRtpCodecParameters.\nSDPUtils.writeRtcpFb = function(codec) {\n  var lines = '';\n  var pt = codec.payloadType;\n  if (codec.preferredPayloadType !== undefined) {\n    pt = codec.preferredPayloadType;\n  }\n  if (codec.rtcpFeedback && codec.rtcpFeedback.length) {\n    // FIXME: special handling for trr-int?\n    codec.rtcpFeedback.forEach(function(fb) {\n      lines += 'a=rtcp-fb:' + pt + ' ' + fb.type +\n      (fb.parameter && fb.parameter.length ? ' ' + fb.parameter : '') +\n          '\\r\\n';\n    });\n  }\n  return lines;\n};\n\n// Parses an RFC 5576 ssrc media attribute. Sample input:\n// a=ssrc:3735928559 cname:something\nSDPUtils.parseSsrcMedia = function(line) {\n  var sp = line.indexOf(' ');\n  var parts = {\n    ssrc: parseInt(line.substr(7, sp - 7), 10)\n  };\n  var colon = line.indexOf(':', sp);\n  if (colon > -1) {\n    parts.attribute = line.substr(sp + 1, colon - sp - 1);\n    parts.value = line.substr(colon + 1);\n  } else {\n    parts.attribute = line.substr(sp + 1);\n  }\n  return parts;\n};\n\n// Extracts the MID (RFC 5888) from a media section.\n// returns the MID or undefined if no mid line was found.\nSDPUtils.getMid = function(mediaSection) {\n  var mid = SDPUtils.matchPrefix(mediaSection, 'a=mid:')[0];\n  if (mid) {\n    return mid.substr(6);\n  }\n}\n\nSDPUtils.parseFingerprint = function(line) {\n  var parts = line.substr(14).split(' ');\n  return {\n    algorithm: parts[0].toLowerCase(), // algorithm is case-sensitive in Edge.\n    value: parts[1]\n  };\n};\n\n// Extracts DTLS parameters from SDP media section or sessionpart.\n// FIXME: for consistency with other functions this should only\n//   get the fingerprint line as input. See also getIceParameters.\nSDPUtils.getDtlsParameters = function(mediaSection, sessionpart) {\n  var lines = SDPUtils.matchPrefix(mediaSection + sessionpart,\n      'a=fingerprint:');\n  // Note: a=setup line is ignored since we use the 'auto' role.\n  // Note2: 'algorithm' is not case sensitive except in Edge.\n  return {\n    role: 'auto',\n    fingerprints: lines.map(SDPUtils.parseFingerprint)\n  };\n};\n\n// Serializes DTLS parameters to SDP.\nSDPUtils.writeDtlsParameters = function(params, setupType) {\n  var sdp = 'a=setup:' + setupType + '\\r\\n';\n  params.fingerprints.forEach(function(fp) {\n    sdp += 'a=fingerprint:' + fp.algorithm + ' ' + fp.value + '\\r\\n';\n  });\n  return sdp;\n};\n// Parses ICE information from SDP media section or sessionpart.\n// FIXME: for consistency with other functions this should only\n//   get the ice-ufrag and ice-pwd lines as input.\nSDPUtils.getIceParameters = function(mediaSection, sessionpart) {\n  var lines = SDPUtils.splitLines(mediaSection);\n  // Search in session part, too.\n  lines = lines.concat(SDPUtils.splitLines(sessionpart));\n  var iceParameters = {\n    usernameFragment: lines.filter(function(line) {\n      return line.indexOf('a=ice-ufrag:') === 0;\n    })[0].substr(12),\n    password: lines.filter(function(line) {\n      return line.indexOf('a=ice-pwd:') === 0;\n    })[0].substr(10)\n  };\n  return iceParameters;\n};\n\n// Serializes ICE parameters to SDP.\nSDPUtils.writeIceParameters = function(params) {\n  return 'a=ice-ufrag:' + params.usernameFragment + '\\r\\n' +\n      'a=ice-pwd:' + params.password + '\\r\\n';\n};\n\n// Parses the SDP media section and returns RTCRtpParameters.\nSDPUtils.parseRtpParameters = function(mediaSection) {\n  var description = {\n    codecs: [],\n    headerExtensions: [],\n    fecMechanisms: [],\n    rtcp: []\n  };\n  var lines = SDPUtils.splitLines(mediaSection);\n  var mline = lines[0].split(' ');\n  for (var i = 3; i < mline.length; i++) { // find all codecs from mline[3..]\n    var pt = mline[i];\n    var rtpmapline = SDPUtils.matchPrefix(\n        mediaSection, 'a=rtpmap:' + pt + ' ')[0];\n    if (rtpmapline) {\n      var codec = SDPUtils.parseRtpMap(rtpmapline);\n      var fmtps = SDPUtils.matchPrefix(\n          mediaSection, 'a=fmtp:' + pt + ' ');\n      // Only the first a=fmtp:<pt> is considered.\n      codec.parameters = fmtps.length ? SDPUtils.parseFmtp(fmtps[0]) : {};\n      codec.rtcpFeedback = SDPUtils.matchPrefix(\n          mediaSection, 'a=rtcp-fb:' + pt + ' ')\n        .map(SDPUtils.parseRtcpFb);\n      description.codecs.push(codec);\n      // parse FEC mechanisms from rtpmap lines.\n      switch (codec.name.toUpperCase()) {\n        case 'RED':\n        case 'ULPFEC':\n          description.fecMechanisms.push(codec.name.toUpperCase());\n          break;\n        default: // only RED and ULPFEC are recognized as FEC mechanisms.\n          break;\n      }\n    }\n  }\n  SDPUtils.matchPrefix(mediaSection, 'a=extmap:').forEach(function(line) {\n    description.headerExtensions.push(SDPUtils.parseExtmap(line));\n  });\n  // FIXME: parse rtcp.\n  return description;\n};\n\n// Generates parts of the SDP media section describing the capabilities /\n// parameters.\nSDPUtils.writeRtpDescription = function(kind, caps) {\n  var sdp = '';\n\n  // Build the mline.\n  sdp += 'm=' + kind + ' ';\n  sdp += caps.codecs.length > 0 ? '9' : '0'; // reject if no codecs.\n  sdp += ' UDP/TLS/RTP/SAVPF ';\n  sdp += caps.codecs.map(function(codec) {\n    if (codec.preferredPayloadType !== undefined) {\n      return codec.preferredPayloadType;\n    }\n    return codec.payloadType;\n  }).join(' ') + '\\r\\n';\n\n  sdp += 'c=IN IP4 0.0.0.0\\r\\n';\n  sdp += 'a=rtcp:9 IN IP4 0.0.0.0\\r\\n';\n\n  // Add a=rtpmap lines for each codec. Also fmtp and rtcp-fb.\n  caps.codecs.forEach(function(codec) {\n    sdp += SDPUtils.writeRtpMap(codec);\n    sdp += SDPUtils.writeFmtp(codec);\n    sdp += SDPUtils.writeRtcpFb(codec);\n  });\n  var maxptime = 0;\n  caps.codecs.forEach(function(codec) {\n    if (codec.maxptime > maxptime) {\n      maxptime = codec.maxptime;\n    }\n  });\n  if (maxptime > 0) {\n    sdp += 'a=maxptime:' + maxptime + '\\r\\n';\n  }\n  sdp += 'a=rtcp-mux\\r\\n';\n\n  caps.headerExtensions.forEach(function(extension) {\n    sdp += SDPUtils.writeExtmap(extension);\n  });\n  // FIXME: write fecMechanisms.\n  return sdp;\n};\n\n// Parses the SDP media section and returns an array of\n// RTCRtpEncodingParameters.\nSDPUtils.parseRtpEncodingParameters = function(mediaSection) {\n  var encodingParameters = [];\n  var description = SDPUtils.parseRtpParameters(mediaSection);\n  var hasRed = description.fecMechanisms.indexOf('RED') !== -1;\n  var hasUlpfec = description.fecMechanisms.indexOf('ULPFEC') !== -1;\n\n  // filter a=ssrc:... cname:, ignore PlanB-msid\n  var ssrcs = SDPUtils.matchPrefix(mediaSection, 'a=ssrc:')\n  .map(function(line) {\n    return SDPUtils.parseSsrcMedia(line);\n  })\n  .filter(function(parts) {\n    return parts.attribute === 'cname';\n  });\n  var primarySsrc = ssrcs.length > 0 && ssrcs[0].ssrc;\n  var secondarySsrc;\n\n  var flows = SDPUtils.matchPrefix(mediaSection, 'a=ssrc-group:FID')\n  .map(function(line) {\n    var parts = line.split(' ');\n    parts.shift();\n    return parts.map(function(part) {\n      return parseInt(part, 10);\n    });\n  });\n  if (flows.length > 0 && flows[0].length > 1 && flows[0][0] === primarySsrc) {\n    secondarySsrc = flows[0][1];\n  }\n\n  description.codecs.forEach(function(codec) {\n    if (codec.name.toUpperCase() === 'RTX' && codec.parameters.apt) {\n      var encParam = {\n        ssrc: primarySsrc,\n        codecPayloadType: parseInt(codec.parameters.apt, 10),\n        rtx: {\n          ssrc: secondarySsrc\n        }\n      };\n      encodingParameters.push(encParam);\n      if (hasRed) {\n        encParam = JSON.parse(JSON.stringify(encParam));\n        encParam.fec = {\n          ssrc: secondarySsrc,\n          mechanism: hasUlpfec ? 'red+ulpfec' : 'red'\n        };\n        encodingParameters.push(encParam);\n      }\n    }\n  });\n  if (encodingParameters.length === 0 && primarySsrc) {\n    encodingParameters.push({\n      ssrc: primarySsrc\n    });\n  }\n\n  // we support both b=AS and b=TIAS but interpret AS as TIAS.\n  var bandwidth = SDPUtils.matchPrefix(mediaSection, 'b=');\n  if (bandwidth.length) {\n    if (bandwidth[0].indexOf('b=TIAS:') === 0) {\n      bandwidth = parseInt(bandwidth[0].substr(7), 10);\n    } else if (bandwidth[0].indexOf('b=AS:') === 0) {\n      bandwidth = parseInt(bandwidth[0].substr(5), 10);\n    }\n    encodingParameters.forEach(function(params) {\n      params.maxBitrate = bandwidth;\n    });\n  }\n  return encodingParameters;\n};\n\n// parses http://draft.ortc.org/#rtcrtcpparameters*\nSDPUtils.parseRtcpParameters = function(mediaSection) {\n  var rtcpParameters = {};\n\n  var cname;\n  // Gets the first SSRC. Note that with RTX there might be multiple\n  // SSRCs.\n  var remoteSsrc = SDPUtils.matchPrefix(mediaSection, 'a=ssrc:')\n      .map(function(line) {\n        return SDPUtils.parseSsrcMedia(line);\n      })\n      .filter(function(obj) {\n        return obj.attribute === 'cname';\n      })[0];\n  if (remoteSsrc) {\n    rtcpParameters.cname = remoteSsrc.value;\n    rtcpParameters.ssrc = remoteSsrc.ssrc;\n  }\n\n  // Edge uses the compound attribute instead of reducedSize\n  // compound is !reducedSize\n  var rsize = SDPUtils.matchPrefix(mediaSection, 'a=rtcp-rsize');\n  rtcpParameters.reducedSize = rsize.length > 0;\n  rtcpParameters.compound = rsize.length === 0;\n\n  // parses the rtcp-mux attrbute.\n  // Note that Edge does not support unmuxed RTCP.\n  var mux = SDPUtils.matchPrefix(mediaSection, 'a=rtcp-mux');\n  rtcpParameters.mux = mux.length > 0;\n\n  return rtcpParameters;\n};\n\n// parses either a=msid: or a=ssrc:... msid lines and returns\n// the id of the MediaStream and MediaStreamTrack.\nSDPUtils.parseMsid = function(mediaSection) {\n  var parts;\n  var spec = SDPUtils.matchPrefix(mediaSection, 'a=msid:');\n  if (spec.length === 1) {\n    parts = spec[0].substr(7).split(' ');\n    return {stream: parts[0], track: parts[1]};\n  }\n  var planB = SDPUtils.matchPrefix(mediaSection, 'a=ssrc:')\n  .map(function(line) {\n    return SDPUtils.parseSsrcMedia(line);\n  })\n  .filter(function(parts) {\n    return parts.attribute === 'msid';\n  });\n  if (planB.length > 0) {\n    parts = planB[0].value.split(' ');\n    return {stream: parts[0], track: parts[1]};\n  }\n};\n\nSDPUtils.writeSessionBoilerplate = function() {\n  // FIXME: sess-id should be an NTP timestamp.\n  return 'v=0\\r\\n' +\n      'o=thisisadapterortc 8169639915646943137 2 IN IP4 127.0.0.1\\r\\n' +\n      's=-\\r\\n' +\n      't=0 0\\r\\n';\n};\n\nSDPUtils.writeMediaSection = function(transceiver, caps, type, stream) {\n  var sdp = SDPUtils.writeRtpDescription(transceiver.kind, caps);\n\n  // Map ICE parameters (ufrag, pwd) to SDP.\n  sdp += SDPUtils.writeIceParameters(\n      transceiver.iceGatherer.getLocalParameters());\n\n  // Map DTLS parameters to SDP.\n  sdp += SDPUtils.writeDtlsParameters(\n      transceiver.dtlsTransport.getLocalParameters(),\n      type === 'offer' ? 'actpass' : 'active');\n\n  sdp += 'a=mid:' + transceiver.mid + '\\r\\n';\n\n  if (transceiver.direction) {\n    sdp += 'a=' + transceiver.direction + '\\r\\n';\n  } else if (transceiver.rtpSender && transceiver.rtpReceiver) {\n    sdp += 'a=sendrecv\\r\\n';\n  } else if (transceiver.rtpSender) {\n    sdp += 'a=sendonly\\r\\n';\n  } else if (transceiver.rtpReceiver) {\n    sdp += 'a=recvonly\\r\\n';\n  } else {\n    sdp += 'a=inactive\\r\\n';\n  }\n\n  if (transceiver.rtpSender) {\n    // spec.\n    var msid = 'msid:' + stream.id + ' ' +\n        transceiver.rtpSender.track.id + '\\r\\n';\n    sdp += 'a=' + msid;\n\n    // for Chrome.\n    sdp += 'a=ssrc:' + transceiver.sendEncodingParameters[0].ssrc +\n        ' ' + msid;\n    if (transceiver.sendEncodingParameters[0].rtx) {\n      sdp += 'a=ssrc:' + transceiver.sendEncodingParameters[0].rtx.ssrc +\n          ' ' + msid;\n      sdp += 'a=ssrc-group:FID ' +\n          transceiver.sendEncodingParameters[0].ssrc + ' ' +\n          transceiver.sendEncodingParameters[0].rtx.ssrc +\n          '\\r\\n';\n    }\n  }\n  // FIXME: this should be written by writeRtpDescription.\n  sdp += 'a=ssrc:' + transceiver.sendEncodingParameters[0].ssrc +\n      ' cname:' + SDPUtils.localCName + '\\r\\n';\n  if (transceiver.rtpSender && transceiver.sendEncodingParameters[0].rtx) {\n    sdp += 'a=ssrc:' + transceiver.sendEncodingParameters[0].rtx.ssrc +\n        ' cname:' + SDPUtils.localCName + '\\r\\n';\n  }\n  return sdp;\n};\n\n// Gets the direction from the mediaSection or the sessionpart.\nSDPUtils.getDirection = function(mediaSection, sessionpart) {\n  // Look for sendrecv, sendonly, recvonly, inactive, default to sendrecv.\n  var lines = SDPUtils.splitLines(mediaSection);\n  for (var i = 0; i < lines.length; i++) {\n    switch (lines[i]) {\n      case 'a=sendrecv':\n      case 'a=sendonly':\n      case 'a=recvonly':\n      case 'a=inactive':\n        return lines[i].substr(2);\n      default:\n        // FIXME: What should happen here?\n    }\n  }\n  if (sessionpart) {\n    return SDPUtils.getDirection(sessionpart);\n  }\n  return 'sendrecv';\n};\n\nSDPUtils.getKind = function(mediaSection) {\n  var lines = SDPUtils.splitLines(mediaSection);\n  var mline = lines[0].split(' ');\n  return mline[0].substr(2);\n};\n\nSDPUtils.isRejected = function(mediaSection) {\n  return mediaSection.split(' ', 2)[1] === '0';\n};\n\n// Expose public methods.\nmodule.exports = SDPUtils;\n","/*\n *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n /* eslint-env node */\n'use strict';\n\n// Expose public methods.\nmodule.exports = function() {\n  var shimError_ = function(e) {\n    return {\n      name: {PermissionDeniedError: 'NotAllowedError'}[e.name] || e.name,\n      message: e.message,\n      constraint: e.constraint,\n      toString: function() {\n        return this.name;\n      }\n    };\n  };\n\n  // getUserMedia error shim.\n  var origGetUserMedia = navigator.mediaDevices.getUserMedia.\n      bind(navigator.mediaDevices);\n  navigator.mediaDevices.getUserMedia = function(c) {\n    return origGetUserMedia(c).catch(function(e) {\n      return Promise.reject(shimError_(e));\n    });\n  };\n};\n","/*\n *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n /* eslint-env node */\n'use strict';\n\nvar browserDetails = require('../utils').browserDetails;\n\nvar firefoxShim = {\n  shimOnTrack: function() {\n    if (typeof window === 'object' && window.RTCPeerConnection && !('ontrack' in\n        window.RTCPeerConnection.prototype)) {\n      Object.defineProperty(window.RTCPeerConnection.prototype, 'ontrack', {\n        get: function() {\n          return this._ontrack;\n        },\n        set: function(f) {\n          if (this._ontrack) {\n            this.removeEventListener('track', this._ontrack);\n            this.removeEventListener('addstream', this._ontrackpoly);\n          }\n          this.addEventListener('track', this._ontrack = f);\n          this.addEventListener('addstream', this._ontrackpoly = function(e) {\n            e.stream.getTracks().forEach(function(track) {\n              var event = new Event('track');\n              event.track = track;\n              event.receiver = {track: track};\n              event.streams = [e.stream];\n              this.dispatchEvent(event);\n            }.bind(this));\n          }.bind(this));\n        }\n      });\n    }\n  },\n\n  shimSourceObject: function() {\n    // Firefox has supported mozSrcObject since FF22, unprefixed in 42.\n    if (typeof window === 'object') {\n      if (window.HTMLMediaElement &&\n        !('srcObject' in window.HTMLMediaElement.prototype)) {\n        // Shim the srcObject property, once, when HTMLMediaElement is found.\n        Object.defineProperty(window.HTMLMediaElement.prototype, 'srcObject', {\n          get: function() {\n            return this.mozSrcObject;\n          },\n          set: function(stream) {\n            this.mozSrcObject = stream;\n          }\n        });\n      }\n    }\n  },\n\n  shimPeerConnection: function() {\n    if (typeof window !== 'object' || !(window.RTCPeerConnection ||\n        window.mozRTCPeerConnection)) {\n      return; // probably media.peerconnection.enabled=false in about:config\n    }\n    // The RTCPeerConnection object.\n    if (!window.RTCPeerConnection) {\n      window.RTCPeerConnection = function(pcConfig, pcConstraints) {\n        if (browserDetails.version < 38) {\n          // .urls is not supported in FF < 38.\n          // create RTCIceServers with a single url.\n          if (pcConfig && pcConfig.iceServers) {\n            var newIceServers = [];\n            for (var i = 0; i < pcConfig.iceServers.length; i++) {\n              var server = pcConfig.iceServers[i];\n              if (server.hasOwnProperty('urls')) {\n                for (var j = 0; j < server.urls.length; j++) {\n                  var newServer = {\n                    url: server.urls[j]\n                  };\n                  if (server.urls[j].indexOf('turn') === 0) {\n                    newServer.username = server.username;\n                    newServer.credential = server.credential;\n                  }\n                  newIceServers.push(newServer);\n                }\n              } else {\n                newIceServers.push(pcConfig.iceServers[i]);\n              }\n            }\n            pcConfig.iceServers = newIceServers;\n          }\n        }\n        return new mozRTCPeerConnection(pcConfig, pcConstraints);\n      };\n      window.RTCPeerConnection.prototype = mozRTCPeerConnection.prototype;\n\n      // wrap static methods. Currently just generateCertificate.\n      if (mozRTCPeerConnection.generateCertificate) {\n        Object.defineProperty(window.RTCPeerConnection, 'generateCertificate', {\n          get: function() {\n            return mozRTCPeerConnection.generateCertificate;\n          }\n        });\n      }\n\n      window.RTCSessionDescription = mozRTCSessionDescription;\n      window.RTCIceCandidate = mozRTCIceCandidate;\n    }\n\n    // shim away need for obsolete RTCIceCandidate/RTCSessionDescription.\n    ['setLocalDescription', 'setRemoteDescription', 'addIceCandidate']\n        .forEach(function(method) {\n          var nativeMethod = RTCPeerConnection.prototype[method];\n          RTCPeerConnection.prototype[method] = function() {\n            arguments[0] = new ((method === 'addIceCandidate') ?\n                RTCIceCandidate : RTCSessionDescription)(arguments[0]);\n            return nativeMethod.apply(this, arguments);\n          };\n        });\n\n    // support for addIceCandidate(null or undefined)\n    var nativeAddIceCandidate =\n        RTCPeerConnection.prototype.addIceCandidate;\n    RTCPeerConnection.prototype.addIceCandidate = function() {\n      if (!arguments[0]) {\n        if (arguments[1]) {\n          arguments[1].apply(null);\n        }\n        return Promise.resolve();\n      }\n      return nativeAddIceCandidate.apply(this, arguments);\n    };\n\n    if (browserDetails.version < 48) {\n      // shim getStats with maplike support\n      var makeMapStats = function(stats) {\n        var map = new Map();\n        Object.keys(stats).forEach(function(key) {\n          map.set(key, stats[key]);\n          map[key] = stats[key];\n        });\n        return map;\n      };\n\n      var nativeGetStats = RTCPeerConnection.prototype.getStats;\n      RTCPeerConnection.prototype.getStats = function(selector, onSucc, onErr) {\n        return nativeGetStats.apply(this, [selector || null])\n          .then(function(stats) {\n            return makeMapStats(stats);\n          })\n          .then(onSucc, onErr);\n      };\n    }\n  }\n};\n\n// Expose public methods.\nmodule.exports = {\n  shimOnTrack: firefoxShim.shimOnTrack,\n  shimSourceObject: firefoxShim.shimSourceObject,\n  shimPeerConnection: firefoxShim.shimPeerConnection,\n  shimGetUserMedia: require('./getusermedia')\n};\n","/*\n *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n /* eslint-env node */\n'use strict';\n\nvar logging = require('../utils').log;\nvar browserDetails = require('../utils').browserDetails;\n\n// Expose public methods.\nmodule.exports = function() {\n  var shimError_ = function(e) {\n    return {\n      name: {\n        SecurityError: 'NotAllowedError',\n        PermissionDeniedError: 'NotAllowedError'\n      }[e.name] || e.name,\n      message: {\n        'The operation is insecure.': 'The request is not allowed by the ' +\n        'user agent or the platform in the current context.'\n      }[e.message] || e.message,\n      constraint: e.constraint,\n      toString: function() {\n        return this.name + (this.message && ': ') + this.message;\n      }\n    };\n  };\n\n  // getUserMedia constraints shim.\n  var getUserMedia_ = function(constraints, onSuccess, onError) {\n    var constraintsToFF37_ = function(c) {\n      if (typeof c !== 'object' || c.require) {\n        return c;\n      }\n      var require = [];\n      Object.keys(c).forEach(function(key) {\n        if (key === 'require' || key === 'advanced' || key === 'mediaSource') {\n          return;\n        }\n        var r = c[key] = (typeof c[key] === 'object') ?\n            c[key] : {ideal: c[key]};\n        if (r.min !== undefined ||\n            r.max !== undefined || r.exact !== undefined) {\n          require.push(key);\n        }\n        if (r.exact !== undefined) {\n          if (typeof r.exact === 'number') {\n            r. min = r.max = r.exact;\n          } else {\n            c[key] = r.exact;\n          }\n          delete r.exact;\n        }\n        if (r.ideal !== undefined) {\n          c.advanced = c.advanced || [];\n          var oc = {};\n          if (typeof r.ideal === 'number') {\n            oc[key] = {min: r.ideal, max: r.ideal};\n          } else {\n            oc[key] = r.ideal;\n          }\n          c.advanced.push(oc);\n          delete r.ideal;\n          if (!Object.keys(r).length) {\n            delete c[key];\n          }\n        }\n      });\n      if (require.length) {\n        c.require = require;\n      }\n      return c;\n    };\n    constraints = JSON.parse(JSON.stringify(constraints));\n    if (browserDetails.version < 38) {\n      logging('spec: ' + JSON.stringify(constraints));\n      if (constraints.audio) {\n        constraints.audio = constraintsToFF37_(constraints.audio);\n      }\n      if (constraints.video) {\n        constraints.video = constraintsToFF37_(constraints.video);\n      }\n      logging('ff37: ' + JSON.stringify(constraints));\n    }\n    return navigator.mozGetUserMedia(constraints, onSuccess, function(e) {\n      onError(shimError_(e));\n    });\n  };\n\n  // Returns the result of getUserMedia as a Promise.\n  var getUserMediaPromise_ = function(constraints) {\n    return new Promise(function(resolve, reject) {\n      getUserMedia_(constraints, resolve, reject);\n    });\n  };\n\n  // Shim for mediaDevices on older versions.\n  if (!navigator.mediaDevices) {\n    navigator.mediaDevices = {getUserMedia: getUserMediaPromise_,\n      addEventListener: function() { },\n      removeEventListener: function() { }\n    };\n  }\n  navigator.mediaDevices.enumerateDevices =\n      navigator.mediaDevices.enumerateDevices || function() {\n        return new Promise(function(resolve) {\n          var infos = [\n            {kind: 'audioinput', deviceId: 'default', label: '', groupId: ''},\n            {kind: 'videoinput', deviceId: 'default', label: '', groupId: ''}\n          ];\n          resolve(infos);\n        });\n      };\n\n  if (browserDetails.version < 41) {\n    // Work around http://bugzil.la/1169665\n    var orgEnumerateDevices =\n        navigator.mediaDevices.enumerateDevices.bind(navigator.mediaDevices);\n    navigator.mediaDevices.enumerateDevices = function() {\n      return orgEnumerateDevices().then(undefined, function(e) {\n        if (e.name === 'NotFoundError') {\n          return [];\n        }\n        throw e;\n      });\n    };\n  }\n  if (browserDetails.version < 49) {\n    var origGetUserMedia = navigator.mediaDevices.getUserMedia.\n        bind(navigator.mediaDevices);\n    navigator.mediaDevices.getUserMedia = function(c) {\n      return origGetUserMedia(c).then(function(stream) {\n        // Work around https://bugzil.la/802326\n        if (c.audio && !stream.getAudioTracks().length ||\n            c.video && !stream.getVideoTracks().length) {\n          stream.getTracks().forEach(function(track) {\n            track.stop();\n          });\n          throw new DOMException('The object can not be found here.',\n                                 'NotFoundError');\n        }\n        return stream;\n      }, function(e) {\n        return Promise.reject(shimError_(e));\n      });\n    };\n  }\n  navigator.getUserMedia = function(constraints, onSuccess, onError) {\n    if (browserDetails.version < 44) {\n      return getUserMedia_(constraints, onSuccess, onError);\n    }\n    // Replace Firefox 44+'s deprecation warning with unprefixed version.\n    console.warn('navigator.getUserMedia has been replaced by ' +\n                 'navigator.mediaDevices.getUserMedia');\n    navigator.mediaDevices.getUserMedia(constraints).then(onSuccess, onError);\n  };\n};\n","/*\n *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n'use strict';\nvar safariShim = {\n  // TODO: DrAlex, should be here, double check against LayoutTests\n  // shimOnTrack: function() { },\n\n  // TODO: once the back-end for the mac port is done, add.\n  // TODO: check for webkitGTK+\n  // shimPeerConnection: function() { },\n\n  shimGetUserMedia: function() {\n    navigator.getUserMedia = navigator.webkitGetUserMedia;\n  }\n};\n\n// Expose public methods.\nmodule.exports = {\n  shimGetUserMedia: safariShim.shimGetUserMedia\n  // TODO\n  // shimOnTrack: safariShim.shimOnTrack,\n  // shimPeerConnection: safariShim.shimPeerConnection\n};\n","/*\n *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n /* eslint-env node */\n\n'use strict';\n\n// Shimming starts here.\n(function() {\n  // Utils.\n  var logging = require('./utils').log;\n  var browserDetails = require('./utils').browserDetails;\n  // Export to the adapter global object visible in the browser.\n  module.exports.browserDetails = browserDetails;\n  module.exports.extractVersion = require('./utils').extractVersion;\n  module.exports.disableLog = require('./utils').disableLog;\n\n  // Uncomment the line below if you want logging to occur, including logging\n  // for the switch statement below. Can also be turned on in the browser via\n  // adapter.disableLog(false), but then logging from the switch statement below\n  // will not appear.\n  // require('./utils').disableLog(false);\n\n  // Browser shims.\n  var chromeShim = require('./chrome/chrome_shim') || null;\n  var edgeShim = require('./edge/edge_shim') || null;\n  var firefoxShim = require('./firefox/firefox_shim') || null;\n  var safariShim = require('./safari/safari_shim') || null;\n\n  // Shim browser if found.\n  switch (browserDetails.browser) {\n    case 'opera': // fallthrough as it uses chrome shims\n    case 'chrome':\n      if (!chromeShim || !chromeShim.shimPeerConnection) {\n        logging('Chrome shim is not included in this adapter release.');\n        return;\n      }\n      logging('adapter.js shimming chrome.');\n      // Export to the adapter global object visible in the browser.\n      module.exports.browserShim = chromeShim;\n\n      chromeShim.shimGetUserMedia();\n      chromeShim.shimMediaStream();\n      chromeShim.shimSourceObject();\n      chromeShim.shimPeerConnection();\n      chromeShim.shimOnTrack();\n      break;\n    case 'firefox':\n      if (!firefoxShim || !firefoxShim.shimPeerConnection) {\n        logging('Firefox shim is not included in this adapter release.');\n        return;\n      }\n      logging('adapter.js shimming firefox.');\n      // Export to the adapter global object visible in the browser.\n      module.exports.browserShim = firefoxShim;\n\n      firefoxShim.shimGetUserMedia();\n      firefoxShim.shimSourceObject();\n      firefoxShim.shimPeerConnection();\n      firefoxShim.shimOnTrack();\n      break;\n    case 'edge':\n      if (!edgeShim || !edgeShim.shimPeerConnection) {\n        logging('MS edge shim is not included in this adapter release.');\n        return;\n      }\n      logging('adapter.js shimming edge.');\n      // Export to the adapter global object visible in the browser.\n      module.exports.browserShim = edgeShim;\n\n      edgeShim.shimGetUserMedia();\n      edgeShim.shimPeerConnection();\n      break;\n    case 'safari':\n      if (!safariShim) {\n        logging('Safari shim is not included in this adapter release.');\n        return;\n      }\n      logging('adapter.js shimming safari.');\n      // Export to the adapter global object visible in the browser.\n      module.exports.browserShim = safariShim;\n\n      safariShim.shimGetUserMedia();\n      break;\n    default:\n      logging('Unsupported browser!');\n  }\n})();\n","// getUserMedia helper by @HenrikJoreteg used for navigator.getUserMedia shim\nvar adapter = require('webrtc-adapter');\n\nmodule.exports = function (constraints, cb) {\n    var error;\n    var haveOpts = arguments.length === 2;\n    var defaultOpts = {video: true, audio: true};\n\n    var denied = 'PermissionDeniedError';\n    var altDenied = 'PERMISSION_DENIED';\n    var notSatisfied = 'ConstraintNotSatisfiedError';\n\n    // make constraints optional\n    if (!haveOpts) {\n        cb = constraints;\n        constraints = defaultOpts;\n    }\n\n    // treat lack of browser support like an error\n    if (typeof navigator === 'undefined' || !navigator.getUserMedia) {\n        // throw proper error per spec\n        error = new Error('MediaStreamError');\n        error.name = 'NotSupportedError';\n\n        // keep all callbacks async\n        return setTimeout(function () {\n            cb(error);\n        }, 0);\n    }\n\n    // normalize error handling when no media types are requested\n    if (!constraints.audio && !constraints.video) {\n        error = new Error('MediaStreamError');\n        error.name = 'NoMediaRequestedError';\n\n        // keep all callbacks async\n        return setTimeout(function () {\n            cb(error);\n        }, 0);\n    }\n\n    navigator.mediaDevices.getUserMedia(constraints)\n    .then(function (stream) {\n        cb(null, stream);\n    }).catch(function (err) {\n        var error;\n        // coerce into an error object since FF gives us a string\n        // there are only two valid names according to the spec\n        // we coerce all non-denied to \"constraint not satisfied\".\n        if (typeof err === 'string') {\n            error = new Error('MediaStreamError');\n            if (err === denied || err === altDenied) {\n                error.name = denied;\n            } else {\n                error.name = notSatisfied;\n            }\n        } else {\n            // if we get an error object make sure '.name' property is set\n            // according to spec: http://dev.w3.org/2011/webrtc/editor/getusermedia.html#navigatorusermediaerror-and-navigatorusermediaerrorcallback\n            error = err;\n            if (!error.name) {\n                // this is likely chrome which\n                // sets a property called \"ERROR_DENIED\" on the error object\n                // if so we make sure to set a name\n                if (error[denied]) {\n                    err.name = denied;\n                } else {\n                    err.name = notSatisfied;\n                }\n            }\n        }\n\n        cb(error);\n    });\n};\n","/**\n * The 3 vertices of a 2D triangle covering the viewport in NDC coordinates ([-1, 1]).\n *\n * @export\n * @type {array.<array.<number>>}\n */\nexport const vertices = [[-1, -1], [-1, 4], [4, -1]];\n\nexport const count = vertices.length;\nexport const dim = 2;\n\n/**\n * The flat array of the above triangle, to be bound as a WebGL attribute buffer for\n * rendering the triangle in the vertex shader.\n * These positions will result in clipped NDC coordinates ([-1, 1]) over the\n * viewport's width and height.\n *\n * @export\n * @type {array.<number>}\n */\nexport const positions = vertices.flat();\n\nexport default positions;\n","/**\n * Creates an iterable array of the given length of empty entries, or\n * those given by optional arguments to `Array.fill`.\n *\n * @see Array.fill\n *\n * @param {number} n The number of elements to create.\n * @param {*} [value] A value to fill the array with; for `Array.fill`.\n * @param {number} [start=0] Start index, inclusive; for `Array.fill`.\n * @param {number} [end=n] End index, exclusive; for `Array.fill`.\n *\n * @returns {array} An array of the given number of empty elements.\n */\nexport const range = (n, value, start, end) => Array(n).fill(value, start, end);\n\nexport default range;\n","const r = Array.prototype.reduce;\n\n/**\n * Reduce an array-like object.\n * Similar to native, but with iteratee-first arguments.\n * Supports the native single-argument behaviour.\n *\n * @param {function} f The iteratee function, given standard arguments, plus the\n *     `out` argument.\n * @param {array} a The list to reduce over (array or array-like object).\n * @param {*} [out] The initial accumulator, if given; otherwise, uses standard\n *     `Array.reduce` behaviour.\n *\n * @returns {*} The result of running the reducer iteratee function over all\n *     elements of the list.\n */\nexport const reduce = (f, a, out) =>\n    // Needs separate `call` because native detects even `undefined` parameter.\n    ((out === undefined)? r.call(a, f) : r.call(a, f, out));\n\nexport default reduce;\n","import { reduce } from './reduce';\n\n/**\n * Map an array-like object.\n * Similar to native, but with iteratee-first arguments; and allows the object\n * into which properties will be mapped to be defined (a new array, by default),\n * avoiding always creating new arrays.\n *\n * @param {function} f The iteratee function, given standard `Array.map`\n *     arguments, plus the output object.\n * @param {array} a The list to map over (array or array-like object).\n * @param {*} [out=[]] The initial accumulator, if given; `a` if falsey given;\n *     or a new array if not given.\n *\n * @returns {*} The result of mapping `out` through the iteratee function over\n *     the `a` list.\n */\nexport const map = (f, a, out = []) => reduce((out, v, i) => {\n        out[i] = f(v, i, a, out);\n\n        return out;\n    },\n    a, (out || a));\n\nexport default map;\n","const e = Array.prototype.forEach;\n\n/**\n * Iterates a function over every element of a list, returning the list.\n *\n * @param {function} f The iteratee function.\n * @param {array} a A list to iterate over (array or array-like object).\n *\n * @returns {array} The given list.\n */\nexport const each = (f, a) => {\n    e.call(a, f);\n\n    return a;\n}\n\nexport default each;\n","/**\n * Wraps an index within a given length, so that indexes greater than the length\n * loop back past 0, and indexes less than 0 loop backward from the length.\n * Similar to the indexing behaviour of `Array.slice`.\n *\n * @param {number} i The index to wrap.\n * @param {number} l The length to wrap the index within.\n *\n * @returns {number} The index wrapped within the length.\n */\nexport const wrapIndex = (i, l) => ((i%l)+l)%l;\n\n/**\n * Gives the entry at a wrapped index of a given list, never exceeds its bounds.\n *\n * @see wrapIndex\n *\n * @param {number} i The index to wrap.\n * @param {array} a A list to index (array or array-like object).\n * @param {number} a.length The length property of the given list.\n *\n * @returns {*} The entry at the wrapped index of the given list.\n */\nexport const wrapGet = (i, a) => a[wrapIndex(i, a.length)];\n\nexport const wrap = { index: wrapIndex, get: wrapGet };\n\nexport default wrap;\n","// Perform a `blur`.\n// #define opticalFlowSpreadBlur\n\n// Scale values output by a `tint`.\n// #define opticalFlowSpreadTint\n\n// Shift the sample lookup by a `flow` lookup.\n#define opticalFlowSpreadShift_none 0\n#define opticalFlowSpreadShift_frame 1\n#define opticalFlowSpreadShift_flow 2\n#ifndef opticalFlowSpreadShift\n    #define opticalFlowSpreadShift opticalFlowSpreadShift_none\n#endif\n\n// Map any flow values.\n// #define opticalFlowSpreadMap\n\n// Blend with past frame.\n// #define opticalFlowSpreadBlend\n\nprecision highp float;\n\nuniform sampler2D frame;\n\n// Perform a `blur`.\n#ifdef opticalFlowSpreadBlur\n    uniform vec2 axis;\n    uniform float width;\n    uniform float height;\n#endif\n\n// Alter the values output, scaling by a `tint`.\n#ifdef opticalFlowSpreadTint\n    uniform vec4 tint;\n#endif\n\n#if opticalFlowSpreadShift != opticalFlowSpreadShift_none\n    // Shift the sample lookup by a `flow` lookup.\n    uniform vec2 speed;\n\n    // Use a separate `flow` input.\n    #if opticalFlowSpreadShift == opticalFlowSpreadShift_flow\n        uniform sampler2D flow;\n    #endif\n\n    // Map any flow values.\n    #ifdef opticalFlowSpreadMap\n        uniform vec4 inRange;\n        uniform vec4 outRange;\n\n        #pragma glslify: map = require(glsl-map)\n    #endif\n#endif\n\n#ifdef opticalFlowSpreadBlend\n    uniform sampler2D other;\n    uniform float blend;\n#endif\n\nvarying vec2 uv;\n\n#pragma glslify: blur = require(glsl-fast-gaussian-blur/5)\n\n#if opticalFlowSpreadShift != opticalFlowSpreadShift_none\n    vec2 shift(vec2 uv, sampler2D flow) {\n        vec2 f = texture2D(flow, uv).xy;\n\n        // Reverse any mapping of the flow values.\n        #ifdef opticalFlowSpreadMap\n            f = map(f, outRange.xy, outRange.zw, inRange.xy, inRange.zw);\n        #endif\n\n        return uv+(f*speed);\n    }\n#endif\n\nvoid main() {\n    vec2 st = uv;\n\n    // Shift the sample lookup by a `flow` lookup.\n    #if opticalFlowSpreadShift == opticalFlowSpreadShift_flow\n        // Use the given `flow` input.\n        st = shift(st, flow);\n    #elif opticalFlowSpreadShift == opticalFlowSpreadShift_frame\n        // Use the `frame` itself as `flow` input.\n        st = shift(st, frame);\n    #endif\n\n    // Perform a `blur`.\n    #ifdef opticalFlowSpreadBlur\n        vec4 c = blur(frame, st, vec2(width, height), axis);\n    #else\n        vec4 c = texture2D(frame, st);\n    #endif\n\n    // Map back to any given range.\n    #ifdef opticalFlowSpreadMap\n        c.xy = map(c.xy, outRange.xy, outRange.zw, inRange.xy, inRange.zw);\n    #endif\n\n    // Scale values output by `tint`.\n    #ifdef opticalFlowSpreadTint\n        c *= tint;\n    #endif\n\n    // Reverse any mapping.\n    #ifdef opticalFlowSpreadMap\n        c.xy = map(c.xy, inRange.xy, inRange.zw, outRange.xy, outRange.zw);\n    #endif\n\n    #ifdef opticalFlowSpreadBlend\n        vec4 o = texture2D(other, uv);\n\n        c = mix(c, o, mix(1.0-c.a, o.a, blend));\n    #endif\n\n    gl_FragColor = c;\n}\n","// Any rendering library, but made with `regl` in mind.\nimport getRegl from 'regl';\nimport getUserMedia from 'getusermedia';\nimport { positions, count } from '@epok.tech/gl-screen-triangle';\nimport range from '@epok.tech/fn-lists/range';\nimport map from '@epok.tech/fn-lists/map';\nimport each from '@epok.tech/fn-lists/each';\nimport { wrapIndex, wrapGet } from '@epok.tech/fn-lists/wrap-index';\n\nimport vert from '@epok.tech/gl-screen-triangle/uv-texture.vert.glsl';\nimport flowFrag from '../index.frag.glsl';\nimport spreadFrag from './spread.frag.glsl';\nimport viewFrag from './view.frag.glsl';\n\nconst demo = document.querySelector('.demo');\nconst video = demo.querySelector('.webcam');\nconst canvas = demo.querySelector('.output');\n\nconst regl = getRegl({\n    canvas,\n    optionalExtensions: [\n        'oes_texture_half_float', 'oes_texture_float',\n        'oes_texture_float_linear'\n    ]\n});\n\nconst float = (regl.hasExtension('oes_texture_float_linear') &&\n    ((regl.hasExtension('oes_texture_float'))? 'float'\n    :   (regl.hasExtension('oes_texture_half_float') && 'half float')));\n\n// Whether to remap values between `float`/`int` in textures.\nconst remap = !float;\nconst mapProps = { type: (float || 'uint8'), min: 'linear', mag: 'linear' };\nconst getMap = () => regl.texture(mapProps);\nconst getFrame = (color = getMap()) => regl.framebuffer({ color });\n\n// Each blur axis of spread.\nconst spreadMaps = map(getMap, range(2), 0);\nconst spreadFrames = map(getFrame, spreadMaps);\n\n// Past and next `video` frames for optical-flow.\nconst flowFrames = map(() => getFrame(), range(2), 0);\nconst flowTo = getFrame();\n\n// Past and next optical-flow frames to blend.\nconst blendFrames = map(() => getFrame(), range(2), 0);\n\nconst resizers = [...spreadFrames, ...flowFrames, flowTo, ...blendFrames];\n\nconst inRange = [-1, -1, 1, 1];\nconst outRange = [0, 0, 1, 1];\n\nconst props = self.opticalFlow = {\n    videoFrame: { data: video, flipY: true },\n    spreadVideo: {\n        /**\n         * Blur the video.\n         *\n         * @see drawSpreadVideoProps\n         */\n        frag: '#define opticalFlowSpreadBlur\\n'+spreadFrag,\n\n        /**\n         * The `passes` props array spreads blur one axis after the other.\n         * Blurs the first axis of the first frame into the next frame, then\n         * the last axis of that frame into the first frame.\n         *\n         * @see drawSpreadProps\n         */\n        passes: map((a, p) => ({ axis: a, pass: p }), [[1.4, 0], [0, 1.4]],\n            0)\n    },\n    flow: {\n        // Pixels units; will divide `offset` by the video resolution later.\n        offset: 3,\n        lambda: 1e-3,\n        speed: range(2, 1),\n        alpha: 100,\n        inRange, outRange\n    },\n    spreadFlow: {\n        /**\n         * Blur the past flow frames along each `axis`, shift/advect along\n         * the `flow` by `speed`, `tint` to weaken the past flow, `blend` in\n         * the next optical-flow frame.\n         *\n         * @see drawSpreadFlowProps\n         */\n        frag: '#define opticalFlowSpreadBlur\\n'+\n            '#define opticalFlowSpreadTint\\n'+\n            '#define opticalFlowSpreadShift opticalFlowSpreadShift_flow\\n'+\n            ((remap)? '#define opticalFlowSpreadMap\\n' : '')+\n            '#define opticalFlowSpreadBlend\\n'+\n            spreadFrag,\n\n        other: flowTo, blend: 1,\n        inRange, outRange,\n\n        /**\n         * Bear in mind each of the `passes` per-`axis` also apply the other\n         * `spread` inputs; some may be better to control per-`pass`, others\n         * across both.\n         *\n         * @see props.spreadVideo.passes\n         */\n        passes: map((o, p) => {\n                o.pass = p;\n\n                return o;\n            },\n            [\n                {\n                    axis: [3, 0], tint: range(4, 1),\n                    speed: range(2, 0)\n                },\n                {\n                    axis: [0, 3], tint: range(4, 0.99),\n                    speed: range(2, 1)\n                }\n            ],\n            0)\n    },\n    view: { inRange, outRange }\n};\n\nconst clearView = { color: [0, 0, 0, 1], depth: 1, stencil: 0 };\nconst clearFlow = { ...clearView, framebuffer: flowTo };\n\nconst clearFlows = map((f) => ({ ...clearView, framebuffer: f }),\n    flowFrames);\n\nconst clearSpreads = map((f) => ({ ...clearView, framebuffer: f }),\n    spreadFrames);\n\nconst clearBlends = map((f) => ({ ...clearView, framebuffer: f }),\n    blendFrames);\n\nconst drawScreen = regl({\n    vert, attributes: { position: positions }, count,\n    depth: { enable: false }\n});\n\n// Spread a frame `pass`; blur along an `axis`, shift by a `flow`, `blend`\n// with an `other` map; if given.\nconst drawSpread = regl({\n    frag: (c, { frag: f = spreadFrag }) => f,\n    uniforms: {\n        // Swap by `pass`; allow `frame` to override if given.\n        frame: (c, { pass: p = 0, frame: f }) =>\n            (f ?? wrapGet(p+1, spreadFrames)),\n\n        axis: regl.prop('axis'),\n        tint: regl.prop('tint'),\n        speed: regl.prop('speed'),\n        flow: regl.prop('flow'),\n        inRange: regl.prop('inRange'),\n        outRange: regl.prop('outRange'),\n        other: regl.prop('other'),\n        blend: regl.prop('blend'),\n        width: regl.context('drawingBufferWidth'),\n        height: regl.context('drawingBufferHeight')\n    },\n    // Swap by `pass`; allow `to` to  override `framebuffer` if given.\n    framebuffer: (c, { pass: p = 0, to = wrapGet(p, spreadFrames) }) => to\n});\n\n// Draws the 2 spread blur `passes` across both axes one after the other.\nfunction drawSpreadProps(props) {\n    // Merge any common `props` into each of `props.passes`.\n    return drawSpread(map((pass) => Object.assign(pass, props, pass),\n        props.passes, 0));\n}\n\n// Blur the input video's current frame, into the next flow input frame.\nfunction drawSpreadVideoProps(tick) {\n    const { videoFrame, spreadVideo } = props;\n    const f = wrapIndex(tick, flowFrames.length);\n\n    each(regl.clear, clearSpreads);\n    spreadMaps[1](videoFrame);\n\n    regl.clear(clearFlows[f]);\n    spreadVideo.passes[1].to = flowFrames[f];\n\n    return drawSpreadProps(spreadVideo);\n}\n\n// The main function of concern - optical flow of the last 2 `video` frames.\nconst drawFlow = regl({\n    frag: ((remap)? '#define opticalFlowMap\\n' : '')+flowFrag,\n    uniforms: {\n        next: ({ tick: t }) => wrapGet(t, flowFrames),\n        past: ({ tick: t }) => wrapGet(t+1, flowFrames),\n        offset: regl.prop('offset'),\n        lambda: regl.prop('lambda'),\n        speed: regl.prop('speed'),\n        alpha: regl.prop('alpha'),\n        inRange: regl.prop('inRange'),\n        outRange: regl.prop('outRange')\n    },\n    framebuffer: flowTo\n});\n\nfunction drawFlowProps() {\n    regl.clear(clearFlow);\n\n    return drawFlow(props.flow);\n}\n\n/**\n * Blur the past flow frames along each `axis`, shift/advect along the\n * `flow` by `speed`, `tint` to weaken the past flow, `blend` in the next\n * optical-flow frame.\n *\n * @see props.spreadFlow\n */\nfunction drawSpreadFlowProps(tick) {\n    const { spreadFlow } = props;\n    const { passes } = spreadFlow;\n\n    each(regl.clear, clearSpreads);\n    spreadFlow.flow = passes[0].frame = wrapGet(tick+1, blendFrames);\n\n    const b = wrapIndex(tick, blendFrames.length);\n\n    regl.clear(clearBlends[b]);\n    passes[1].to = blendFrames[b];\n\n    return drawSpreadProps(spreadFlow);\n}\n\n// Draw to the screen.\nconst drawView = regl({\n    frag: ((remap)? '#define opticalFlowViewMap\\n' : '')+viewFrag,\n    uniforms: {\n        frame: ({ tick: t }) => wrapGet(t, blendFrames),\n        inRange: regl.prop('inRange'),\n        outRange: regl.prop('outRange')\n    }\n});\n\nfunction drawViewProps() {\n    regl.clear(clearView);\n\n    return drawView(props.view);\n}\n\n// All together now.\nfunction draw({ tick: t }) {\n    // Blur the input video's current frame.\n    drawSpreadVideoProps(t);\n    // Get the optical flow from the last 2 `video` frames.\n    drawFlowProps();\n    // Spread the past flow frame and blend with the next one.\n    drawSpreadFlowProps(t);\n    // Draw to the screen.\n    drawViewProps();\n}\n\nvideo.addEventListener('canplay', () => {\n    const { videoWidth: w, videoHeight: h } = video;\n\n    video.width = canvas.width = w;\n    video.height = canvas.height = h;\n    each((v) => v.resize(w, video.videoHeight), resizers);\n    // Pixels units; divide `offset` by the video resolution.\n    props.flow.offset /= Math.max(w, h, 1e3);\n    video.play();\n\n    // Fill the flow frames with the first frame.\n    drawScreen(() => {\n        drawSpreadVideoProps(0);\n        drawSpreadVideoProps(1);\n    });\n\n    // Start the main loop.\n    regl.frame(() => drawScreen(draw));\n});\n\ndemo.addEventListener('click', () => {\n    const c = demo.classList;\n\n    c[(c.contains('overlay'))? 'remove' : 'add']('overlay');\n});\n\ngetUserMedia({ video: true }, (e, stream) => {\n    if(e) { console.warn(e); }\n    else if('srcObject' in video) { video.srcObject = stream; }\n    else { video.src = self.URL.createObjectURL(stream); }\n});\n","precision highp float;\n\nattribute vec2 position;\n\nvarying vec2 uv;\n\n// Translation for UV NDC to texture coordinates.\nconst vec2 offset = vec2(0.5);\n\nvoid main() {\n    uv = (position*0.5)+offset;\n    gl_Position = vec4(position, 0, 1);\n}\n","/**\n * Optical flow fragment shader, for convenience.\n *\n * @see ./index.frag\n */\n\n// #define opticalFlowMap\n\nprecision highp float;\n\nuniform sampler2D next;\nuniform sampler2D past;\nuniform float offset;\nuniform float lambda;\nuniform float alpha;\nuniform vec2 speed;\n\n// Optionally map the flow ([-1, 1]) to a different range (e.g: [0, 1]).\n#ifdef opticalFlowMap\n    uniform vec4 inRange;\n    uniform vec4 outRange;\n\n    #pragma glslify: map = require(glsl-map)\n#endif\n\nvarying vec2 uv;\n\n#pragma glslify: opticalFlow = require(./index)\n\nvoid main() {\n    vec2 flow = opticalFlow(uv, next, past, offset, lambda);\n    float power = dot(flow, flow);\n\n    flow *= speed;\n\n    // Optionally map the flow ([-1, 1]) to a different range (e.g: [0, 1]).\n    #ifdef opticalFlowMap\n        flow = map(flow, inRange.xy, inRange.zw, outRange.xy, outRange.zw);\n    #endif\n\n    gl_FragColor = vec4(flow, power, clamp(power*alpha, 0.0, 1.0));\n}\n","// Map any flow values.\n// #define opticalFlowViewMap\n\nprecision highp float;\n\nuniform sampler2D frame;\n\n// Map any flow values.\n#ifdef opticalFlowViewMap\n    uniform vec4 inRange;\n    uniform vec4 outRange;\n\n    #pragma glslify: map = require(glsl-map)\n#endif\n\nvarying vec2 uv;\n\n#pragma glslify: tau = require(glsl-constants/TWO_PI)\n#pragma glslify: hslToRGB = require(glsl-hsl2rgb)\n#pragma glslify: map = require(glsl-map)\n\nvoid main() {\n    vec4 data = texture2D(frame, uv);\n    float a = clamp(data.a, 0.0, 1.0);\n    vec2 flow = data.xy;\n\n    // Map any flow values.\n    #ifdef opticalFlowViewMap\n        flow = map(flow, outRange.xy, outRange.zw, inRange.xy, inRange.zw);\n    #endif\n\n    // Angle to hue - red right, green up, cyan left, magenta down.\n    vec3 color = hslToRGB(atan(flow.y, flow.x)/tau, 0.9*a, 0.6*a);\n\n    gl_FragColor = vec4(color, a);\n}\n"],"names":["obj","key","value","Object","defineProperty","enumerable","configurable","writable","target","i","arguments","length","source","ownKeys","keys","getOwnPropertySymbols","concat","filter","sym","getOwnPropertyDescriptor","forEach","$c29af7d59dca4181$export$2e2bcd8739ae039","arr","Array","isArray","arr2","$f16c756dc4c6fcab$export$2e2bcd8739ae039","iter","Symbol","iterator","prototype","toString","call","from","$2830bf695bfc577b$export$2e2bcd8739ae039","TypeError","$af1ae7be731ea2e6$export$2e2bcd8739ae039","$d97f85cd64715388$var$logDisabled_","$d97f85cd64715388$var$utils","disableLog","bool","Error","log","window","console","apply","extractVersion","uastring","expr","pos","match","parseInt","detectBrowser","result","navigator","browser","mozGetUserMedia","version","this","userAgent","webkitGetUserMedia","webkitRTCPeerConnection","mediaDevices","module","exports","browserDetails","$a0afa2162bbbca85$var$chromeShim","shimMediaStream","MediaStream","webkitMediaStream","shimOnTrack","RTCPeerConnection","get","_ontrack","set","f","self","removeEventListener","_ontrackpoly","addEventListener","e","stream","te","event","Event","track","receiver","streams","dispatchEvent","getTracks","bind","shimSourceObject","HTMLMediaElement","_srcObject","src","URL","revokeObjectURL","createObjectURL","shimPeerConnection","pcConfig","pcConstraints","iceTransportPolicy","iceTransports","pc","origGetStats","getStats","selector","successCallback","errorCallback","args","fixChromeStats_","response","standardReport","report","standardStats","id","timestamp","type","names","name","stat","makeMapStats","stats","legacyStats","map","Map","successCallbackWrapper_","Promise","resolve","reject","then","generateCertificate","method","nativeMethod","opts","undefined","$a0afa2162bbbca85$require$browserDetails","promise","err","RTCIceCandidate","RTCSessionDescription","nativeAddIceCandidate","addIceCandidate","shimGetUserMedia","parcelRequire","constraintsToChrome_","c","mandatory","optional","cc","r","ideal","exact","min","max","oldname_","prefix","charAt","toUpperCase","slice","oc","push","mix","advanced","shimConstraints_","constraints","func","JSON","parse","stringify","audio","video","face","facingMode","getSupportedConstraints","enumerateDevices","devices","back","d","kind","find","label","toLowerCase","indexOf","deviceId","shimError_","PermissionDeniedError","ConstraintNotSatisfiedError","message","constraint","constraintName","getUserMedia","onSuccess","onError","getUserMediaPromise_","kinds","MediaStreamTrack","getSources","device","groupId","origGetUserMedia","cs","getAudioTracks","getVideoTracks","stop","DOMException","$f5f014c156147a31$var$edgeShim","RTCIceGatherer","origMSTEnabled","ev","enabled","config","_eventTarget","document","createDocumentFragment","onicecandidate","onaddstream","ontrack","onremovestream","onsignalingstatechange","oniceconnectionstatechange","onnegotiationneeded","ondatachannel","localStreams","remoteStreams","getLocalStreams","getRemoteStreams","localDescription","sdp","remoteDescription","signalingState","iceConnectionState","iceGatheringState","iceOptions","gatherPolicy","iceServers","usingBundle","bundlePolicy","server","urls","url","$f5f014c156147a31$require$browserDetails","_config","transceivers","_localIceCandidatesBuffer","_emitBufferedCandidates","sections","$21dEp","splitSections","candidate","j","sdpMLineIndex","join","every","transceiver","iceGatherer","state","getConfiguration","addStream","clonedStream","clone","idx","clonedTrack","_maybeFireNegotiationNeeded","removeStream","splice","getSenders","rtpSender","getReceivers","rtpReceiver","_getCommonCapabilities","localCapabilities","remoteCapabilities","commonCapabilities","codecs","headerExtensions","fecMechanisms","lCodec","rCodec","clockRate","numChannels","Math","rtcpFeedback","fb","parameter","lHeaderExtension","rHeaderExtension","uri","_createIceAndDtlsTransports","mid","iceTransport","RTCIceTransport","onlocalcandidate","evt","sdpMid","cand","end","component","writeCandidate","complete","onicestatechange","_updateConnectionState","dtlsTransport","RTCDtlsTransport","ondtlsstatechange","onerror","_transceive","send","recv","params","encodings","sendEncodingParameters","rtcp","cname","localCName","recvEncodingParameters","ssrc","p","rtx","receive","setLocalDescription","description","sessionpart","_pendingOffer","shift","mediaSection","caps","parseRtpParameters","isIceLite","matchPrefix","split","isDatachannel","remoteIceParameters","getIceParameters","cands","parseCandidate","setRemoteCandidates","remoteDtlsParameters","getDtlsParameters","role","start","_updateSignalingState","hasCallback","cb","setTimeout","setRemoteDescription","receiverList","mline","splitLines","substr","rejected","direction","getDirection","generateIdentifier","parseRtpEncodingParameters","remoteSsrc","line","parseSsrcMedia","attribute","isComplete","addTrack","localTrack","transports","RTCRtpReceiver","getCapabilities","codec","RTCRtpSender","item","trackEvent","close","newState","states","new","closed","connecting","checking","connected","completed","failed","disconnected","createOffer","offerOptions","tracks","numAudioTracks","numVideoTracks","offerToReceiveAudio","offerToReceiveVideo","wantReceive","writeSessionBoilerplate","parameters","t","writeMediaSection","desc","createAnswer","mLineIndex","transceiver1","protocol","port","addRemoteCandidate","trim","promises","results","all","res","$17864388326fd8db$var$SDPUtils","random","blob","part","index","parts","foundation","substring","priority","ip","relatedAddress","relatedPort","tcpType","parseIceOptions","parseRtpMap","parsed","payloadType","writeRtpMap","pt","preferredPayloadType","parseExtmap","writeExtmap","headerExtension","preferredId","parseFmtp","kv","writeFmtp","param","parseRtcpFb","writeRtcpFb","lines","sp","colon","getMid","parseFingerprint","algorithm","fingerprints","writeDtlsParameters","setupType","fp","usernameFragment","password","writeIceParameters","rtpmapline","fmtps","writeRtpDescription","maxptime","extension","secondarySsrc","encodingParameters","hasRed","hasUlpfec","ssrcs","primarySsrc","flows","apt","encParam","codecPayloadType","fec","mechanism","bandwidth","maxBitrate","parseRtcpParameters","rtcpParameters","rsize","reducedSize","compound","mux","parseMsid","parts1","spec","planB","getLocalParameters","msid","getKind","isRejected","catch","$46aa6c15acb05f44$var$firefoxShim","mozSrcObject","mozRTCPeerConnection","$46aa6c15acb05f44$require$browserDetails","newIceServers","hasOwnProperty","newServer","username","credential","mozRTCSessionDescription","mozRTCIceCandidate","nativeGetStats","onSucc","onErr","SecurityError","getUserMedia_","constraintsToFF37_","require","$5a1682ac92d22a54$require$browserDetails","orgEnumerateDevices","warn","$4e924d11ed2beaa3$var$safariShim","logging","chromeShim","edgeShim","firefoxShim","safariShim","$bf5ff8173bd689b2$exports","error1","haveOpts","defaultOpts","denied","altDenied","notSatisfied","error","$097d2d6ba61fde6a$export$ba60520149d1328e","$097d2d6ba61fde6a$export$85b9a36db797e02b","$097d2d6ba61fde6a$export$878041e1e4cd4218","flat","$5ebc876929a0439f$export$2e2bcd8739ae039","n","fill","$ee5851911330bf41$var$r","reduce","$ee5851911330bf41$export$533b26079ad0b4b","a","out","$6d8e5906de1cf303$export$2e2bcd8739ae039","out1","v","$6f535731e26073af$var$e","$6f535731e26073af$export$2e2bcd8739ae039","$4ad49746d3e88695$export$acb6ab09ed1b7b8b","l","$4ad49746d3e88695$export$ea134dcc07e79c49","$572f4bc6c56e1449$exports","$e5e27940694a4f4d$var$demo","querySelector","$e5e27940694a4f4d$var$video","$e5e27940694a4f4d$var$canvas","$e5e27940694a4f4d$var$regl","$parcel$interopDefault","$2a263769c476450e$exports","canvas","optionalExtensions","$e5e27940694a4f4d$var$float","hasExtension","$e5e27940694a4f4d$var$remap","$e5e27940694a4f4d$var$mapProps","mag","$e5e27940694a4f4d$var$getMap","texture","$e5e27940694a4f4d$var$getFrame","color","framebuffer","$e5e27940694a4f4d$var$spreadMaps","$e5e27940694a4f4d$var$spreadFrames","$e5e27940694a4f4d$var$flowFrames","$e5e27940694a4f4d$var$flowTo","$e5e27940694a4f4d$var$blendFrames","$e5e27940694a4f4d$var$resizers","$ef466a0c186023fe$export$2e2bcd8739ae039","$e5e27940694a4f4d$var$inRange","$e5e27940694a4f4d$var$outRange","$e5e27940694a4f4d$var$props","opticalFlow","videoFrame","data","flipY","spreadVideo","frag","passes","axis","pass","flow","offset","lambda","speed","alpha","inRange","outRange","spreadFlow","other","blend","o","tint","view","$e5e27940694a4f4d$var$clearView","depth","stencil","$e5e27940694a4f4d$var$clearFlow","$6ff65e20dc745a42$export$2e2bcd8739ae039","$e5e27940694a4f4d$var$clearFlows","$e5e27940694a4f4d$var$clearSpreads","$e5e27940694a4f4d$var$clearBlends","$e5e27940694a4f4d$var$drawScreen","vert","attributes","position","count","enable","$e5e27940694a4f4d$var$drawSpread","tmp","uniforms","frame","prop","width","context","height","tmp1","to","$e5e27940694a4f4d$var$drawSpreadProps","props","assign","$e5e27940694a4f4d$var$drawSpreadVideoProps","tick","clear","$e5e27940694a4f4d$var$drawFlow","next","past","$e5e27940694a4f4d$var$drawView","$e5e27940694a4f4d$var$draw","b","$e5e27940694a4f4d$var$drawSpreadFlowProps","w","videoWidth","h","videoHeight","resize","play","classList","contains","srcObject"],"version":3,"file":"index.2d792da9.js.map"}